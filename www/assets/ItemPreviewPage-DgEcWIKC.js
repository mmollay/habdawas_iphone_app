import{R as ve,Y as Ce,H as Ie,f as ke,h as Be,r as t,j as e,B as i,a2 as ze,y as B,F as K,T as n,J as Q,a1 as We,w as F,ac as Ee,ag as we,a8 as Pe,O as Te,D as Me,i as Ae,l as Fe,ae as Ge,af as Ve,n as He,A as Le,G}from"./index-Cr_aSuNE.js";import{I as Ne,a,b as Oe,c as X,R as Re,W as Ke,B as Y,P as $e,H as Ze}from"./InlineImageGallery-CLCfNFu6.js";import{A as Ue}from"./arrow-left-DFM7ANa-.js";import{S as Je}from"./star-DmQVCCzy.js";import{S as q}from"./send-BePmK5Ja.js";import"./plus-DRI1QaFw.js";const rs=()=>{var Z,U;const b=ve(),D=Ce(),{user:z}=Ie(),V=ke(),H=Be(V.breakpoints.down("md")),s=D.state,[r,Qe]=t.useState(!0),[Xe,ee]=t.useState(!1),[_,W]=t.useState(!1),[se,L]=t.useState(!1),[N,te]=t.useState(""),[c,ie]=t.useState(!0),[$,j]=t.useState(null),[E,ne]=t.useState((s==null?void 0:s.title)||""),[w,le]=t.useState((s==null?void 0:s.description)||""),[P,re]=t.useState((s==null?void 0:s.price)||0),[T,ae]=t.useState((s==null?void 0:s.category)||""),[y,oe]=t.useState((s==null?void 0:s.brand)||""),[M,ce]=t.useState((s==null?void 0:s.condition)||"used_good"),[d,de]=t.useState((s==null?void 0:s.tags)||[]),[u,ue]=t.useState((s==null?void 0:s.size)||""),[h,he]=t.useState((s==null?void 0:s.weight)||""),[g,Ye]=t.useState((s==null?void 0:s.dimensions_length)||""),[S,qe]=t.useState((s==null?void 0:s.dimensions_width)||""),[v,De]=t.useState((s==null?void 0:s.dimensions_height)||""),[x,ge]=t.useState((s==null?void 0:s.material)||""),[o,xe]=t.useState((s==null?void 0:s.colors)||[]),[m,me]=t.useState((s==null?void 0:s.style)||""),[p,pe]=t.useState((s==null?void 0:s.serial_number)||""),[C,fe]=t.useState((s==null?void 0:s.images)||[]);t.useEffect(()=>{s||b("/items/create")},[s,b]),t.useEffect(()=>{ee(!0)},[E,w,P,T,y,M,d,u,h,g,S,v,x,o,m,p]);const be=async()=>{if(z){W(!0),j(null);try{const l={user_id:z.id,title:E,description:w,price:s.is_free?0:P,category:T,brand:y||null,condition:M,tags:d.length>0?d:null,size:u||null,weight:h||null,dimensions_length:g||null,dimensions_width:S||null,dimensions_height:v||null,material:x||null,colors:o.length>0?o:null,style:m||null,serial_number:p||null,shipping_enabled:s.shipping_enabled,shipping_cost_type:s.shipping_cost_type,shipping_cost_fixed:s.shipping_cost_fixed||null,shipping_description:s.shipping_description||null,pickup_enabled:s.pickup_enabled,pickup_address_id:s.pickup_address_id||null,show_location_publicly:s.show_location_publicly,location_description:s.location_description||null,price_negotiable:s.price_negotiable,is_free:s.is_free,status:"draft",duration_days:s.duration_days||30},{data:I,error:f}=await G.from("items").insert([l]).select().single();if(f)throw f;if(C.length>0){const O=C.map((A,R)=>({item_id:I.id,image_url:A,display_order:R})),{error:k}=await G.from("item_images").insert(O);if(k)throw k}b("/")}catch(l){console.error("Error saving draft:",l),j(l instanceof Error?l.message:"Fehler beim Speichern des Entwurfs")}finally{W(!1)}}},_e=async()=>{if(z){W(!0),j(null);try{const l=new Date,I=c?null:new Date(N),f=new Date(l);f.setDate(f.getDate()+(s.duration_days||30));const O={user_id:z.id,title:E,description:w,price:s.is_free?0:P,category:T,brand:y||null,condition:M,tags:d.length>0?d:null,size:u||null,weight:h||null,dimensions_length:g||null,dimensions_width:S||null,dimensions_height:v||null,material:x||null,colors:o.length>0?o:null,style:m||null,serial_number:p||null,shipping_enabled:s.shipping_enabled,shipping_cost_type:s.shipping_cost_type,shipping_cost_fixed:s.shipping_cost_fixed||null,shipping_description:s.shipping_description||null,pickup_enabled:s.pickup_enabled,pickup_address_id:s.pickup_address_id||null,show_location_publicly:s.show_location_publicly,location_description:s.location_description||null,price_negotiable:s.price_negotiable,is_free:s.is_free,status:c?"active":"scheduled",published_at:c?l.toISOString():I==null?void 0:I.toISOString(),expires_at:f.toISOString(),duration_days:s.duration_days||30},{data:k,error:A}=await G.from("items").insert([O]).select().single();if(A)throw A;if(C.length>0){const R=C.map((ye,Se)=>({item_id:k.id,image_url:ye,display_order:Se})),{error:J}=await G.from("item_images").insert(R);if(J)throw J}b(`/items/${k.id}`)}catch(l){console.error("Error publishing item:",l),j(l instanceof Error?l.message:"Fehler beim Veröffentlichen")}finally{W(!1)}}};if(!s)return null;const je=[{value:"new",label:"Neu"},{value:"used_like_new",label:"Gebraucht (wie neu)"},{value:"used_good",label:"Gebraucht (gut)"},{value:"used_acceptable",label:"Gebraucht (akzeptabel)"}];return e.jsxs(i,{sx:{minHeight:"100vh",bgcolor:"background.default",pb:10},children:[e.jsxs(ze,{maxWidth:"lg",sx:{py:3},children:[e.jsx(B,{startIcon:e.jsx(Ue,{size:20}),onClick:()=>b(-1),sx:{mb:3},children:"Zurück"}),$&&e.jsx(K,{severity:"error",sx:{mb:3},onClose:()=>j(null),children:$}),e.jsxs(K,{severity:"info",sx:{mb:3},children:[e.jsx(n,{variant:"body2",fontWeight:600,gutterBottom:!0,children:"Vorschau-Modus"}),e.jsx(n,{variant:"body2",children:'Fahre mit der Maus über Titel, Beschreibung, Preis oder Details, um sie zu bearbeiten. Klicke auf "Veröffentlichen" wenn alles bereit ist, oder speichere als Entwurf.'})]}),e.jsx(Q,{elevation:0,sx:{border:"1px solid",borderColor:"divider"},children:e.jsxs(i,{sx:{p:3},children:[e.jsxs(i,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",md:"1fr 1fr"},gap:4},children:[e.jsx(i,{children:e.jsx(Ne,{images:C,onImagesChange:fe,isEditMode:r,isMobile:H})}),e.jsxs(i,{children:[e.jsx(a,{value:E,onChange:ne,isEditMode:r,variant:"h4",fontWeight:700,placeholder:"Titel",multiline:!1}),e.jsx(a,{value:s.is_free?"0":P.toString(),onChange:l=>re(Number(l)),isEditMode:!s.is_free,variant:"h5",fontWeight:600,color:"primary.main",prefix:"€ ",placeholder:"0",multiline:!1,sx:{mt:2}}),s.price_negotiable&&e.jsx(We,{label:"VB",size:"small",sx:{mt:1,fontWeight:700,bgcolor:"warning.main",color:"white"}}),e.jsx(F,{sx:{my:3}}),e.jsx(n,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,children:"Beschreibung"}),e.jsx(a,{value:w,onChange:le,isEditMode:r,variant:"body1",placeholder:"Beschreibung",multiline:!0,minRows:4}),e.jsx(F,{sx:{my:3}}),e.jsxs(i,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsxs(i,{children:[e.jsx(n,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,children:"Kategorie"}),e.jsx(a,{value:T,onChange:ae,isEditMode:r,variant:"body2",placeholder:"Kategorie"})]}),e.jsxs(i,{children:[e.jsx(n,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,children:"Zustand"}),e.jsx(Oe,{value:M,onChange:ce,options:je,isEditMode:r})]}),y&&e.jsxs(i,{children:[e.jsx(n,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,children:"Marke"}),e.jsx(a,{value:y,onChange:oe,isEditMode:r,variant:"body2",placeholder:"Marke"})]}),d.length>0&&e.jsxs(i,{children:[e.jsxs(n,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(Ee,{size:16})," Tags"]}),e.jsx(X,{values:d,onChange:de,isEditMode:r})]})]}),e.jsx(F,{sx:{my:3}}),e.jsx(n,{variant:"subtitle1",fontWeight:600,gutterBottom:!0,children:"Versand & Abholung"}),e.jsxs(i,{sx:{display:"flex",flexDirection:"column",gap:1.5},children:[s.shipping_enabled&&e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(we,{size:20,color:V.palette.success.main}),e.jsxs(n,{variant:"body2",children:["Versand: ",s.shipping_cost_type==="free"?"Kostenlos":s.shipping_cost_type==="ai_calculated"?`€ ${((Z=s.shipping_cost_fixed)==null?void 0:Z.toFixed(2))||"0.00"}`:`€ ${((U=s.shipping_cost_fixed)==null?void 0:U.toFixed(2))||"0.00"}`]})]}),s.pickup_enabled&&e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Pe,{size:20,color:V.palette.primary.main}),e.jsx(n,{variant:"body2",children:"Abholung möglich"})]})]})]})]}),(u||h||g||x||o.length>0||m||p)&&e.jsxs(e.Fragment,{children:[e.jsx(F,{sx:{my:4}}),e.jsx(n,{variant:"h6",fontWeight:600,gutterBottom:!0,children:"Details"}),e.jsxs(i,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",sm:"1fr 1fr"},gap:2},children:[u&&e.jsxs(i,{children:[e.jsxs(n,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(Re,{size:16})," Größe"]}),e.jsx(a,{value:u,onChange:ue,isEditMode:r,variant:"body2",placeholder:"Größe"})]}),h&&e.jsxs(i,{children:[e.jsxs(n,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(Ke,{size:16})," Gewicht"]}),e.jsx(a,{value:h,onChange:he,isEditMode:r,variant:"body2",placeholder:"Gewicht"})]}),(g||S||v)&&e.jsxs(i,{children:[e.jsxs(n,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(Y,{size:16})," Maße"]}),e.jsxs(n,{variant:"body2",children:[g," × ",S," × ",v," cm"]})]}),x&&e.jsxs(i,{children:[e.jsxs(n,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(Y,{size:16})," Material"]}),e.jsx(a,{value:x,onChange:ge,isEditMode:r,variant:"body2",placeholder:"Material"})]}),o.length>0&&e.jsxs(i,{children:[e.jsxs(n,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx($e,{size:16})," Farben"]}),e.jsx(X,{values:o,onChange:xe,isEditMode:r})]}),m&&e.jsxs(i,{children:[e.jsxs(n,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(Te,{size:16})," Stil"]}),e.jsx(a,{value:m,onChange:me,isEditMode:r,variant:"body2",placeholder:"Stil"})]}),p&&e.jsxs(i,{children:[e.jsxs(n,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(Ze,{size:16})," Seriennummer"]}),e.jsx(a,{value:p,onChange:pe,isEditMode:r,variant:"body2",placeholder:"Seriennummer"})]})]})]})]})})]}),e.jsxs(Q,{elevation:8,sx:{position:"fixed",bottom:{xs:16,md:32},left:"50%",transform:"translateX(-50%)",zIndex:1300,p:2,display:"flex",alignItems:"center",gap:2,flexDirection:{xs:"column",sm:"row"},bgcolor:"background.paper",borderRadius:3,border:"2px solid",borderColor:"primary.main",boxShadow:"0 8px 32px rgba(0,0,0,0.12)",minWidth:{xs:"calc(100% - 32px)",sm:"auto"}},children:[e.jsx(B,{variant:"outlined",onClick:be,disabled:_,startIcon:e.jsx(Je,{size:18}),fullWidth:H,children:"Als Entwurf speichern"}),e.jsx(B,{variant:"contained",onClick:()=>L(!0),disabled:_,startIcon:e.jsx(q,{size:18}),fullWidth:H,children:_?"Wird veröffentlicht...":"Veröffentlichen"})]}),e.jsxs(Me,{open:se,onClose:()=>L(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(Ae,{children:"Inserat veröffentlichen"}),e.jsx(Fe,{children:e.jsxs(i,{sx:{display:"flex",flexDirection:"column",gap:2,pt:2},children:[e.jsx(Ge,{control:e.jsx(Ve,{checked:c,onChange:l=>ie(l.target.checked)}),label:"Sofort veröffentlichen"}),!c&&e.jsx(He,{fullWidth:!0,type:"datetime-local",label:"Veröffentlichungsdatum",value:N,onChange:l=>te(l.target.value),InputLabelProps:{shrink:!0},inputProps:{min:new Date().toISOString().slice(0,16)}}),e.jsx(K,{severity:"info",children:c?"Das Inserat wird sofort veröffentlicht und ist für alle sichtbar.":"Das Inserat wird zum gewählten Zeitpunkt automatisch veröffentlicht."})]})}),e.jsxs(Le,{children:[e.jsx(B,{onClick:()=>L(!1),children:"Abbrechen"}),e.jsx(B,{onClick:_e,variant:"contained",startIcon:e.jsx(q,{size:20}),disabled:_||!c&&!N,children:_?"Wird veröffentlicht...":"Veröffentlichen"})]})]})]})};export{rs as ItemPreviewPage};
