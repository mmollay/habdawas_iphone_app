import{e as pe,R as Ve,j as e,J as R,B as s,I as ce,L as He,q as Oe,t as je,v as _e,o as Ue,U as Ke,av as Me,a8 as ge,ad as Re,aF as ye,O as Ge,aG as ke,n as W,f as ne,h as te,r as c,T as n,V as Ze,$ as se,aC as qe,aE as Fe,ap as U,ay as $e,a6 as Je,a1 as Q,aH as ve,y as G,F,aI as Qe,G as D,aJ as xe,aK as Ce,w as oe,ae as S,ak as N,aL as Ye,aM as Xe,aN as es,aO as Ae,a4 as ss,ax as ns,an as ts,ao as is,aP as rs,aQ as as,H as Le,at as ls,a5 as Pe,aR as os,a2 as We,aS as ds,aT as cs,N as Ie,aU as hs}from"./index-Cr_aSuNE.js";import{u as us,G as P,T as xs,M as ps,A as gs}from"./AdminPage-DjeNVBg8.js";import{C as ms,a as fs,M as bs}from"./Modal-XlAZZroc.js";import{L as we,U as js}from"./user-check-CC_dig-g.js";import{A as _s}from"./alert-circle-BUd0o05b.js";import{searchCitiesByPostalCode as ys}from"./postalCodeLookup-Bx0v-AE9.js";import{P as vs}from"./plus-DRI1QaFw.js";import{R as Ne,a as de}from"./RadioGroup-BxuBdUxa.js";import{f as Te,S as ws}from"./formatNumber-bVP66vRH.js";import"./AccordionSummary-BTDKqR1i.js";import"./Collapse-DR9hVEqK.js";import"./calendar-CRxPvv7E.js";import"./credit-card-D1r_0m4J.js";import"./gift-C6oOSMs6.js";import"./zap-XLhLKX4D.js";import"./star-DmQVCCzy.js";import"./dollar-sign-CKip757d.js";import"./send-BePmK5Ja.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ks=pe("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zs=pe("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ss=pe("Hand",[["path",{d:"M18 11V6a2 2 0 0 0-2-2v0a2 2 0 0 0-2 2v0",key:"aigmz7"}],["path",{d:"M14 10V4a2 2 0 0 0-2-2v0a2 2 0 0 0-2 2v2",key:"1n6bmn"}],["path",{d:"M10 10.5V6a2 2 0 0 0-2-2v0a2 2 0 0 0-2 2v8",key:"a9iiix"}],["path",{d:"M18 8a2 2 0 1 1 4 0v6a8 8 0 0 1-8 8h-2c-2.8 0-4.5-.86-5.99-2.34l-3.6-3.6a2 2 0 0 1 2.83-2.82L7 15",key:"1s1gnw"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ee=pe("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]),Be=({currentSection:t,onSectionChange:l,collapsed:u,onToggleCollapse:p,isMobile:h=!1})=>{const{isAdmin:b}=us(),o=Ve(),E=[{id:"profile",label:"Persönliche Daten",icon:e.jsx(Ke,{size:20})},{id:"security",label:"Sicherheit",icon:e.jsx(we,{size:20})},{id:"tokens",label:"Mein Guthaben",icon:e.jsx(Me,{size:20})},{id:"addresses",label:"Adressen",icon:e.jsx(ge,{size:20})},{id:"shipping",label:"Versand & Abholung",icon:e.jsx(Re,{size:20})},{id:"display",label:"Anzeige",icon:e.jsx(ye,{size:20})},{id:"ai",label:"KI-Assistent",icon:e.jsx(Ge,{size:20})},{id:"notifications",label:"Benachrichtigungen",icon:e.jsx(zs,{size:20})}];return b&&E.push({id:"admin",label:"Administration",icon:e.jsx(ke,{size:20})}),e.jsxs(R,{elevation:0,sx:{width:h?"100%":u?72:260,transition:"width 0.3s ease",height:h?"100%":"100vh",borderRight:h?0:1,borderColor:"divider",borderRadius:0,overflow:"auto",display:"flex",flexDirection:"column",position:h?"relative":"sticky",top:0,left:0},children:[!h&&e.jsx(s,{sx:{display:"flex",justifyContent:u?"center":"flex-end",p:1.5,borderBottom:1,borderColor:"divider"},children:e.jsx(ce,{onClick:p,size:"small",sx:{bgcolor:"action.hover","&:hover":{bgcolor:"action.selected"}},children:u?e.jsx(ms,{size:18}):e.jsx(fs,{size:18})})}),e.jsx(He,{sx:{pt:2,pb:2},children:E.map(m=>{const f=e.jsxs(Oe,{onClick:()=>{m.id==="admin"?o("/admin"):l(m.id)},selected:t===m.id,sx:{mb:.5,mx:u&&!h?1:1.5,borderRadius:2,minHeight:48,justifyContent:u&&!h?"center":"flex-start",px:u&&!h?0:2,"&.Mui-selected":{bgcolor:"primary.main",color:"white","&:hover":{bgcolor:"primary.dark"},"& .MuiListItemIcon-root":{color:"white"}},"&:hover":{bgcolor:u&&!h?"action.hover":"action.selected"}},children:[e.jsx(je,{sx:{minWidth:u&&!h?"auto":40,justifyContent:"center",color:t===m.id?"inherit":"text.secondary"},children:m.icon}),(!u||h)&&e.jsx(_e,{primary:m.label,primaryTypographyProps:{fontWeight:t===m.id?600:400,fontSize:"0.95rem"}})]},m.id);return h?f:e.jsx(Ue,{title:u?m.label:"",placement:"right",arrow:!0,children:f},m.id)})})]})},ue=({fieldName:t,savedField:l,saveTimestamp:u,autoSaveStatus:p,showCheckmark:h,...b})=>e.jsx(W,{...b}),Cs=({profile:t,formData:l,onFormChange:u,userId:p,onProfileUpdate:h})=>{var q,w;const b=ne(),o=te(b.breakpoints.down("md")),[E,m]=c.useState(!1),[f,B]=c.useState(!1),[k,L]=c.useState("idle"),[i,y]=c.useState(""),[j,C]=c.useState(null),[M,H]=c.useState(null),a=c.useRef(null),[O,$]=c.useState(!1),[v,I]=c.useState(null),r=x=>{I(x.currentTarget)},g=()=>{I(null)},A=()=>{var x;g(),(x=a.current)==null||x.click()},K=()=>{g(),$(!0)},J=x=>new Promise(z=>{const ie=new FileReader;ie.onload=ze=>{var le;const Y=new Image;Y.onload=()=>{const re=document.createElement("canvas"),ae=re.getContext("2d"),fe=1200,be=1200;let X=Y.width,ee=Y.height;X>ee?X>fe&&(ee=ee*fe/X,X=fe):ee>be&&(X=X*be/ee,ee=be),re.width=X,re.height=ee,ae==null||ae.drawImage(Y,0,0,X,ee),re.toBlob(Se=>{if(Se){const De=new File([Se],x.name,{type:"image/jpeg",lastModified:Date.now()});z(De)}},"image/jpeg",.85)},Y.src=(le=ze.target)==null?void 0:le.result},ie.readAsDataURL(x)}),d=async x=>{if(!x.type.startsWith("image/")){alert("Bitte wähle eine Bilddatei aus");return}m(!0);try{const z=await J(x);if(z.size>5*1024*1024){alert("Die Datei ist zu groß. Maximal 5MB erlaubt."),m(!1);return}const ie=z.name.split(".").pop(),Y=`avatars/${`${p}-${Date.now()}.${ie}`}`,{error:le}=await D.storage.from("avatars").upload(Y,z);if(le)throw le;const{data:{publicUrl:re}}=D.storage.from("avatars").getPublicUrl(Y),{error:ae}=await D.from("profiles").update({avatar_url:re}).eq("id",p);if(ae)throw ae;h()}catch(z){console.error("Error uploading avatar:",z),alert("Fehler beim Hochladen des Bildes")}finally{m(!1)}},V=async x=>{var ie;const z=(ie=x.target.files)==null?void 0:ie[0];z&&await d(z)},Z=async x=>{await d(x)},he=async()=>{if(!l.phone||l.phone.trim()===""){C("Bitte gib zuerst eine Telefonnummer ein");return}B(!0),C(null);try{const{data:x,error:z}=await D.rpc("request_phone_verification",{p_phone:l.phone});if(z)throw z;x.success?(H(x.code),L("code-sent")):C(x.message)}catch(x){console.error("Verification request error:",x),C("Fehler beim Senden des Codes")}finally{B(!1)}},me=async()=>{if(!i||i.length!==6){C("Bitte gib den 6-stelligen Code ein");return}B(!0),C(null);try{const{data:x,error:z}=await D.rpc("verify_phone_code",{p_code:i});if(z)throw z;x.success?(L("verified"),h()):C(x.message)}catch(x){console.error("Verification error:",x),C("Ungültiger oder abgelaufener Code")}finally{B(!1)}},_=o?s:R,T=o?{}:{sx:{p:3}};return e.jsxs(s,{children:[e.jsx(n,{variant:"h5",fontWeight:700,gutterBottom:!0,sx:{mb:1,display:{xs:"none",md:"block"}},children:"Persönliche Daten"}),e.jsx(n,{variant:"body2",color:"text.secondary",sx:{mb:{xs:2,md:4},display:{xs:"none",md:"block"}},children:"Verwalte deine persönlichen Informationen"}),e.jsxs(_,{...T,children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",mb:4,flexDirection:{xs:"column",sm:"row"},textAlign:{xs:"center",sm:"left"}},children:[e.jsxs(s,{sx:{position:"relative",mb:{xs:2,sm:0}},children:[e.jsx(Ze,{src:(t==null?void 0:t.avatar_url)||void 0,sx:{width:100,height:100,fontSize:"2rem",bgcolor:"primary.main"},children:((w=(q=l.full_name)==null?void 0:q[0])==null?void 0:w.toUpperCase())||"U"}),e.jsx("input",{ref:a,type:"file",accept:"image/*",style:{display:"none"},onChange:V}),e.jsx(ce,{onClick:r,disabled:E,sx:{position:"absolute",bottom:0,right:0,bgcolor:"primary.main",color:"white","&:hover":{bgcolor:"primary.dark"},width:36,height:36},children:E?e.jsx(se,{size:18,color:"inherit"}):e.jsx(qe,{size:18})}),e.jsxs(Fe,{anchorEl:v,open:!!v,onClose:g,transformOrigin:{horizontal:"right",vertical:"top"},anchorOrigin:{horizontal:"right",vertical:"bottom"},children:[e.jsxs(U,{onClick:K,children:[e.jsx(je,{children:e.jsx($e,{size:18})}),e.jsx(_e,{children:"Foto aufnehmen"})]}),e.jsxs(U,{onClick:A,children:[e.jsx(je,{children:e.jsx(Je,{size:18})}),e.jsx(_e,{children:"Datei wählen"})]})]})]}),e.jsxs(s,{sx:{ml:{sm:3}},children:[e.jsx(n,{variant:"h6",fontWeight:600,children:l.full_name||"Kein Name"}),e.jsx(n,{variant:"body2",color:"text.secondary",children:l.email})]})]}),e.jsxs(P,{container:!0,spacing:{xs:2,md:3},children:[e.jsx(P,{size:{xs:12,md:6},children:e.jsx(ue,{fieldName:"full_name",fullWidth:!0,label:"Vollständiger Name",value:l.full_name,onChange:x=>u("full_name",x.target.value),helperText:"Dein voller Name wird anderen Nutzern angezeigt"})}),e.jsx(P,{size:{xs:12,md:6},children:e.jsx(W,{fullWidth:!0,label:"E-Mail-Adresse",value:l.email,disabled:!0,helperText:"Deine E-Mail-Adresse kann nicht geändert werden"})}),e.jsx(P,{size:{xs:12},children:e.jsxs(s,{children:[e.jsx(s,{sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:e.jsx(ue,{fieldName:"phone",fullWidth:!0,label:"Telefonnummer",value:l.phone,onChange:x=>u("phone",x.target.value),placeholder:"+43 650 123456",disabled:(t==null?void 0:t.phone_verified)||k==="code-sent",InputProps:{endAdornment:t!=null&&t.phone_verified?e.jsx(Q,{icon:e.jsx(ve,{size:16}),label:"Verifiziert",color:"success",size:"small",sx:{mr:-1}}):void 0}})}),!(t!=null&&t.phone_verified)&&k==="idle"&&e.jsxs(s,{sx:{mt:2},children:[e.jsx(G,{variant:"outlined",startIcon:e.jsx(ke,{size:18}),onClick:he,disabled:f||!l.phone,size:"small",children:f?"Sende Code...":"Telefonnummer verifizieren"}),e.jsx(n,{variant:"caption",display:"block",color:"text.secondary",sx:{mt:1},children:"Erhöhe das Vertrauen durch Verifizierung deiner Telefonnummer"})]}),k==="code-sent"&&e.jsxs(s,{sx:{mt:2},children:[e.jsxs(F,{severity:"info",sx:{mb:2},children:[e.jsxs(n,{variant:"body2",sx:{mb:1},children:[e.jsx("strong",{children:"Demo-Modus:"})," Der Verifizierungscode lautet: ",e.jsx("strong",{children:M})]}),e.jsx(n,{variant:"caption",color:"text.secondary",children:"In der Produktion würde dieser Code per SMS gesendet werden."})]}),e.jsxs(s,{sx:{display:"flex",gap:2,alignItems:"flex-start"},children:[e.jsx(W,{label:"6-stelliger Code",value:i,onChange:x=>{const z=x.target.value.replace(/\D/g,"").slice(0,6);y(z)},placeholder:"123456",inputProps:{maxLength:6},sx:{width:"200px"},error:!!j,helperText:j}),e.jsx(G,{variant:"contained",onClick:me,disabled:f||i.length!==6,children:f?"Prüfe...":"Verifizieren"}),e.jsx(G,{variant:"text",onClick:()=>{L("idle"),y(""),C(null)},children:"Abbrechen"})]})]}),k==="verified"&&e.jsx(F,{severity:"success",sx:{mt:2},children:"Deine Telefonnummer wurde erfolgreich verifiziert!"}),j&&k==="idle"&&e.jsx(F,{severity:"error",sx:{mt:2},children:j})]})}),e.jsx(P,{size:{xs:12,md:6},children:e.jsxs(ue,{fieldName:"language",fullWidth:!0,select:!0,label:"Sprache",value:l.language,onChange:x=>u("language",x.target.value),helperText:"Bevorzugte Sprache für die App",SelectProps:{native:!0},children:[e.jsx("option",{value:"de",children:"Deutsch"}),e.jsx("option",{value:"en",children:"English"})]})}),e.jsx(P,{size:{xs:12},children:e.jsx(ue,{fieldName:"bio",fullWidth:!0,label:"Über mich",value:l.bio,onChange:x=>u("bio",x.target.value),multiline:!0,rows:4,helperText:"Erzähle anderen Nutzern etwas über dich (optional)",placeholder:"Ich verkaufe gerne gebrauchte Artikel und bin immer auf der Suche nach guten Deals..."})})]})]}),e.jsx(Qe,{open:O,onClose:()=>$(!1),onCapture:Z})]})},As=({userId:t})=>{const l=ne(),u=te(l.breakpoints.down("md")),[p,h]=c.useState(!1),[b,o]=c.useState(!0),[E,m]=c.useState(!1),[f,B]=c.useState(!1),[k,L]=c.useState(!1),[i,y]=c.useState(!1),[j,C]=c.useState(""),[M,H]=c.useState(""),[a,O]=c.useState(null),[$,v]=c.useState(null),[I,r]=c.useState(null);c.useEffect(()=>{g()},[t]),c.useEffect(()=>{r(j?A(j):null)},[j]);const g=async()=>{try{o(!0);const{data:{user:_},error:T}=await D.auth.getUser();if(T)throw T;if(!_)return;const q=_.app_metadata.providers||[],w=q.some(z=>z!=="email"),x=q.includes("email");m(w),B(x&&!w)}catch(_){console.error("Error checking user auth:",_)}finally{o(!1)}},A=_=>{let T=0;return _.length>=8&&T++,_.length>=12&&T++,/[a-z]/.test(_)&&/[A-Z]/.test(_)&&T++,/\d/.test(_)&&T++,/[^a-zA-Z\d]/.test(_)&&T++,T<=2?"weak":T<=3?"medium":"strong"},K=()=>!j||j.length<8?"Passwort muss mindestens 8 Zeichen lang sein":j!==M?"Passwörter stimmen nicht überein":I==="weak"?"Passwort ist zu schwach. Verwende Groß- und Kleinbuchstaben, Zahlen und Sonderzeichen":null,J=async()=>{var T,q;v(null),O(null);const _=K();if(_){v(_);return}h(!0);try{const{error:w}=await D.auth.updateUser({password:j});if(w)throw w;O("Passwort erfolgreich gesetzt! Du kannst dich jetzt mit deiner E-Mail und diesem Passwort anmelden."),C(""),H(""),B(!0),await g()}catch(w){console.error("Error setting password:",w),(T=w.message)!=null&&T.includes("should be different from the old password")?v("Das neue Passwort muss sich vom aktuellen Passwort unterscheiden."):(q=w.message)!=null&&q.includes("Password is too weak")?v("Passwort ist zu schwach. Verwende ein stärkeres Passwort."):v(w.message||"Fehler beim Setzen des Passworts")}finally{h(!1)}},d=async()=>{var T,q;v(null),O(null);const _=K();if(_){v(_);return}h(!0);try{const{error:w}=await D.auth.updateUser({password:j});if(w)throw w;O("Passwort erfolgreich geändert!"),C(""),H("")}catch(w){console.error("Error changing password:",w),(T=w.message)!=null&&T.includes("should be different from the old password")?v("Das neue Passwort muss sich vom aktuellen Passwort unterscheiden."):(q=w.message)!=null&&q.includes("Password is too weak")?v("Passwort ist zu schwach. Verwende ein stärkeres Passwort."):v(w.message||"Fehler beim Ändern des Passworts")}finally{h(!1)}},V=()=>I?I==="weak"?"error":I==="medium"?"warning":"success":"default",Z=()=>I?I==="weak"?"Schwach":I==="medium"?"Mittel":"Stark":"",he=u?s:R,me=u?{}:{sx:{p:3}};return b?e.jsx(s,{sx:{display:"flex",justifyContent:"center",py:8},children:e.jsx(se,{})}):e.jsxs(s,{children:[e.jsx(n,{variant:"h5",fontWeight:700,gutterBottom:!0,sx:{mb:1,display:{xs:"none",md:"block"}},children:"Sicherheit"}),e.jsx(n,{variant:"body2",color:"text.secondary",sx:{mb:{xs:2,md:4},display:{xs:"none",md:"block"}},children:"Verwalte deine Anmeldemethoden und Passwort-Einstellungen"}),e.jsxs(he,{...me,children:[e.jsxs(s,{sx:{mb:4},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",gap:1.5,mb:2},children:[e.jsx(ke,{size:24,color:"#1976d2"}),e.jsx(n,{variant:"h6",fontWeight:600,children:"Anmeldemethoden"})]}),e.jsxs(s,{sx:{display:"flex",flexDirection:"column",gap:1.5},children:[E&&e.jsx(Q,{icon:e.jsx(ve,{size:16}),label:"Google OAuth",color:"success",sx:{alignSelf:"flex-start"}}),f?e.jsx(Q,{icon:e.jsx(ve,{size:16}),label:"E-Mail & Passwort",color:"success",sx:{alignSelf:"flex-start"}}):e.jsx(Q,{icon:e.jsx(_s,{size:16}),label:"Kein Passwort gesetzt",color:"warning",sx:{alignSelf:"flex-start"}})]})]}),!f&&E&&e.jsxs(F,{severity:"info",sx:{mb:3},children:[e.jsxs(n,{variant:"body2",sx:{mb:1},children:[e.jsx("strong",{children:"Hinweis:"})," Du hast dich mit Google angemeldet und hast noch kein Passwort gesetzt."]}),e.jsx(n,{variant:"body2",children:"Setze ein Passwort, um dich alternativ auch mit E-Mail und Passwort anmelden zu können."})]}),e.jsxs(s,{sx:{display:"flex",alignItems:"center",gap:1.5,mb:3},children:[e.jsx(we,{size:24,color:"#1976d2"}),e.jsx(n,{variant:"h6",fontWeight:600,children:f?"Passwort ändern":"Passwort setzen"})]}),a&&e.jsx(F,{severity:"success",sx:{mb:3},onClose:()=>O(null),children:a}),$&&e.jsx(F,{severity:"error",sx:{mb:3},onClose:()=>v(null),children:$}),e.jsxs(s,{sx:{display:"flex",flexDirection:"column",gap:3},children:[e.jsx(W,{fullWidth:!0,label:"Neues Passwort",type:k?"text":"password",value:j,onChange:_=>C(_.target.value),placeholder:"Mindestens 8 Zeichen",InputProps:{endAdornment:e.jsx(xe,{position:"end",children:e.jsx(ce,{onClick:()=>L(!k),edge:"end",children:k?e.jsx(Ce,{size:20}):e.jsx(ye,{size:20})})})},helperText:I&&e.jsxs(s,{sx:{display:"flex",alignItems:"center",gap:.5,mt:.5},children:[e.jsx(n,{variant:"caption",color:"text.secondary",children:"Passwortstärke:"}),e.jsx(Q,{label:Z(),color:V(),size:"small",sx:{height:18,fontSize:"0.7rem"}})]})}),e.jsx(W,{fullWidth:!0,label:"Passwort bestätigen",type:i?"text":"password",value:M,onChange:_=>H(_.target.value),placeholder:"Passwort wiederholen",InputProps:{endAdornment:e.jsx(xe,{position:"end",children:e.jsx(ce,{onClick:()=>y(!i),edge:"end",children:i?e.jsx(Ce,{size:20}):e.jsx(ye,{size:20})})})},error:M.length>0&&j!==M,helperText:M.length>0&&j!==M?"Passwörter stimmen nicht überein":""}),e.jsxs(s,{children:[e.jsx(G,{variant:"contained",onClick:f?d:J,disabled:p||!j||!M||j!==M,startIcon:p?e.jsx(se,{size:18}):e.jsx(we,{size:18}),sx:{mr:2},children:p?"Wird gespeichert...":f?"Passwort ändern":"Passwort setzen"}),(j||M)&&e.jsx(G,{variant:"text",onClick:()=>{C(""),H(""),v(null),O(null)},children:"Abbrechen"})]}),e.jsxs(F,{severity:"info",sx:{mt:2},children:[e.jsx(n,{variant:"body2",fontWeight:600,sx:{mb:1},children:"Passwort-Anforderungen:"}),e.jsxs(s,{component:"ul",sx:{m:0,pl:2},children:[e.jsx(n,{component:"li",variant:"body2",children:"Mindestens 8 Zeichen"}),e.jsx(n,{component:"li",variant:"body2",children:"Groß- und Kleinbuchstaben"}),e.jsx(n,{component:"li",variant:"body2",children:"Mindestens eine Zahl"}),e.jsx(n,{component:"li",variant:"body2",children:"Empfohlen: Sonderzeichen (!@#$%^&*)"})]})]})]})]})]})},Ps=({formData:t,onFormChange:l})=>{const u=ne(),p=te(u.breakpoints.down("md")),h=p?s:R,b=p?{}:{sx:{p:3}};return e.jsxs(s,{children:[e.jsx(n,{variant:"h5",fontWeight:700,gutterBottom:!0,sx:{mb:1,display:{xs:"none",md:"block"}},children:"KI-Assistent"}),e.jsx(n,{variant:"body2",color:"text.secondary",sx:{mb:4,display:{xs:"none",md:"block"}},children:"Passe an, wie die KI deine Inseratentexte erstellen soll"}),e.jsxs(h,{...b,children:[e.jsx(n,{variant:"h6",fontWeight:600,gutterBottom:!0,sx:{mb:2},children:"Textgenerierung"}),e.jsxs(s,{sx:{display:"flex",flexDirection:"column",gap:2,mb:3},children:[e.jsxs(W,{fullWidth:!0,select:!0,label:"Schreibstil",value:t.ai_text_style,onChange:o=>l("ai_text_style",o.target.value),helperText:"Der Ton und die Art der generierten Texte",children:[e.jsx(U,{value:"formal",children:"Förmlich - Professionell und sachlich"}),e.jsx(U,{value:"casual",children:"Locker - Freundlich und ungezwungen"}),e.jsx(U,{value:"detailed",children:"Detailreich - Ausführlich und informativ"}),e.jsx(U,{value:"concise",children:"Prägnant - Kurz und auf den Punkt"}),e.jsx(U,{value:"balanced",children:"Ausgewogen - Gute Balance (empfohlen)"})]}),e.jsxs(W,{fullWidth:!0,select:!0,label:"Textlänge",value:t.ai_text_length,onChange:o=>l("ai_text_length",o.target.value),helperText:"Bevorzugte Länge der Beschreibungen",children:[e.jsx(U,{value:"short",children:"Kurz - Ca. 2-3 Sätze"}),e.jsx(U,{value:"medium",children:"Mittel - Ca. 4-6 Sätze (empfohlen)"}),e.jsx(U,{value:"long",children:"Lang - Ca. 7-10 Sätze"})]})]}),e.jsx(oe,{sx:{my:3}}),e.jsx(n,{variant:"h6",fontWeight:600,gutterBottom:!0,sx:{mb:2},children:"Erweiterte Optionen"}),e.jsxs(s,{sx:{display:"flex",flexDirection:"column",gap:1.5},children:[e.jsx(S,{control:e.jsx(N,{checked:t.ai_include_emoji,onChange:o=>l("ai_include_emoji",o.target.checked)}),label:e.jsxs(s,{children:[e.jsx(n,{variant:"body2",fontWeight:600,children:"Emojis verwenden"}),e.jsx(n,{variant:"caption",color:"text.secondary",children:"Die KI fügt passende Emojis in die Beschreibungen ein"})]}),sx:{alignItems:"flex-start",m:0}}),e.jsx(s,{sx:{height:1,bgcolor:"divider",my:.5}}),e.jsx(S,{control:e.jsx(N,{checked:t.ai_allow_line_breaks,onChange:o=>l("ai_allow_line_breaks",o.target.checked)}),label:e.jsxs(s,{children:[e.jsx(n,{variant:"body2",fontWeight:600,children:"Zeilenumbrüche erlauben"}),e.jsx(n,{variant:"caption",color:"text.secondary",children:"Die KI strukturiert Texte mit Absätzen für bessere Lesbarkeit"})]}),sx:{alignItems:"flex-start",m:0}}),e.jsx(s,{sx:{height:1,bgcolor:"divider",my:.5}}),e.jsx(S,{control:e.jsx(N,{checked:t.ai_auto_publish,onChange:o=>l("ai_auto_publish",o.target.checked)}),label:e.jsxs(s,{children:[e.jsx(n,{variant:"body2",fontWeight:600,children:"Automatisch veröffentlichen"}),e.jsx(n,{variant:"caption",color:"text.secondary",children:"Inserate werden direkt nach der KI-Generierung veröffentlicht"})]}),sx:{alignItems:"flex-start",m:0}}),e.jsx(s,{sx:{height:1,bgcolor:"divider",my:.5}}),e.jsx(S,{control:e.jsx(N,{checked:t.ai_analyze_all_images,onChange:o=>l("ai_analyze_all_images",o.target.checked)}),label:e.jsxs(s,{children:[e.jsx(n,{variant:"body2",fontWeight:600,children:"Alle Bilder analysieren"}),e.jsx(n,{variant:"caption",color:"text.secondary",children:"Bei mehreren Bildern werden alle analysiert (teurer, aber detaillierter)"})]}),sx:{alignItems:"flex-start",m:0}})]})]})]})},Ws=({formData:t,onFormChange:l})=>{const u=ne(),p=te(u.breakpoints.down("md")),h=p?s:R,b=p?{}:{sx:{p:3}};return e.jsxs(s,{children:[e.jsx(n,{variant:"h5",fontWeight:700,gutterBottom:!0,sx:{mb:1,display:{xs:"none",md:"block"}},children:"Benachrichtigungen"}),e.jsx(n,{variant:"body2",color:"text.secondary",sx:{mb:4,display:{xs:"none",md:"block"}},children:"Wähle aus, wie du über Neuigkeiten informiert werden möchtest"}),e.jsx(h,{...b,children:e.jsxs(s,{sx:{display:"flex",flexDirection:"column",gap:1.5},children:[e.jsx(S,{control:e.jsx(N,{checked:t.notifications_enabled,onChange:o=>l("notifications_enabled",o.target.checked)}),label:e.jsxs(s,{children:[e.jsx(n,{variant:"body2",fontWeight:600,children:"Push-Benachrichtigungen"}),e.jsx(n,{variant:"caption",color:"text.secondary",children:"Erhalte Benachrichtigungen über neue Nachrichten und Aktivitäten"})]}),sx:{alignItems:"flex-start",m:0}}),e.jsx(s,{sx:{height:1,bgcolor:"divider",my:.5}}),e.jsx(S,{control:e.jsx(N,{checked:t.email_notifications,onChange:o=>l("email_notifications",o.target.checked)}),label:e.jsxs(s,{children:[e.jsx(n,{variant:"body2",fontWeight:600,children:"E-Mail-Benachrichtigungen"}),e.jsx(n,{variant:"caption",color:"text.secondary",children:"Erhalte wichtige Updates und Neuigkeiten per E-Mail"})]}),sx:{alignItems:"flex-start",m:0}}),e.jsx(s,{sx:{height:1,bgcolor:"divider",my:.5}}),e.jsx(S,{control:e.jsx(N,{checked:t.newsletter_subscribed,onChange:o=>l("newsletter_subscribed",o.target.checked)}),label:e.jsxs(s,{children:[e.jsx(n,{variant:"body2",fontWeight:600,children:"Newsletter abonnieren"}),e.jsx(n,{variant:"caption",color:"text.secondary",children:"Erhalte regelmäßig Angebote, Tipps und Neuigkeiten per E-Mail"})]}),sx:{alignItems:"flex-start",m:0}})]})})]})},Is=({userId:t})=>{const l=ne(),u=te(l.breakpoints.down("md")),[p,h]=c.useState([]),[b,o]=c.useState(!0),[E,m]=c.useState(!1),[f,B]=c.useState(null),[k,L]=c.useState(!1),[i,y]=c.useState({name:"",address:"",postal_code:"",city:"",country:"AT",phone:"",show_phone_publicly:!1,is_default:!1,address_type:"both",is_default_shipping:!1}),[j,C]=c.useState([]),[M,H]=c.useState(!1);c.useEffect(()=>{const g=setTimeout(async()=>{if(i.postal_code.length>=4){H(!0);try{const K=(await ys(i.postal_code,i.country)).map(J=>J.city);console.log("AddressesSection: Found cities for",i.postal_code,i.country,":",K),C(K),K.length===1&&!i.city&&y(J=>({...J,city:K[0]}))}catch(A){console.error("Error fetching cities:",A)}finally{H(!1)}}else C([])},500);return()=>clearTimeout(g)},[i.postal_code,i.country]);const a=async()=>{o(!0);try{const{data:r,error:g}=await D.from("addresses").select("*").eq("user_id",t).order("is_default",{ascending:!1}).order("created_at",{ascending:!1});if(g)throw g;h(r||[])}catch(r){console.error("Error loading addresses:",r)}finally{o(!1)}};c.useEffect(()=>{a()},[t]);const O=()=>{B(null),y({name:"",address:"",postal_code:"",city:"",country:"AT",phone:"",show_phone_publicly:!1,is_default:!1,address_type:"both",is_default_shipping:!1}),m(!0)},$=r=>{B(r),y({name:r.name||"",address:r.address,postal_code:r.postal_code,city:r.city,country:r.country,phone:r.phone||"",show_phone_publicly:r.show_phone_publicly||!1,is_default:r.is_default,address_type:r.address_type||"both",is_default_shipping:r.is_default_shipping||!1}),m(!0)},v=async()=>{var r,g;if(!(!i.address.trim()||!i.postal_code.trim()||!i.city.trim())){L(!0);try{if(f){const{error:A}=await D.from("addresses").update({name:i.name.trim()||"Meine Adresse",address:i.address.trim(),postal_code:i.postal_code.trim(),city:i.city.trim(),country:i.country,phone:((r=i.phone)==null?void 0:r.trim())||null,show_phone_publicly:i.show_phone_publicly,is_default:i.is_default,address_type:i.address_type,is_default_shipping:i.is_default_shipping}).eq("id",f.id);if(A)throw A}else{const{error:A}=await D.from("addresses").insert({user_id:t,name:i.name.trim()||"Meine Adresse",address:i.address.trim(),postal_code:i.postal_code.trim(),city:i.city.trim(),country:i.country,phone:((g=i.phone)==null?void 0:g.trim())||null,show_phone_publicly:i.show_phone_publicly,is_default:i.is_default,address_type:i.address_type,is_default_shipping:i.is_default_shipping});if(A)throw A}await a(),m(!1)}catch(A){console.error("Error saving address:",A)}finally{L(!1)}}},I=async r=>{if(window.confirm("Möchtest du diese Adresse wirklich löschen?"))try{const{error:g}=await D.from("addresses").delete().eq("id",r);if(g)throw g;await a()}catch(g){console.error("Error deleting address:",g)}};return b?e.jsx(s,{sx:{display:"flex",justifyContent:"center",py:8},children:e.jsx(se,{})}):e.jsxs(s,{children:[e.jsxs(s,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:4},children:[e.jsxs(s,{sx:{display:{xs:"none",md:"block"}},children:[e.jsx(n,{variant:"h5",fontWeight:700,gutterBottom:!0,sx:{mb:1},children:"Adressen"}),e.jsx(n,{variant:"body2",color:"text.secondary",children:"Verwalte deine Adressen für Abholung und Versand"})]}),e.jsx(G,{variant:"contained",startIcon:e.jsx(vs,{size:20}),onClick:O,sx:{ml:{xs:"auto",md:"auto"},mr:{xs:"auto",md:0}},children:p.length===0?"Adresse hinzufügen":u?"+ Adresse":"Neue Adresse"})]}),p.length===0?e.jsxs(R,{sx:{p:{xs:3,md:6},textAlign:"center"},children:[e.jsx(ge,{size:48,style:{margin:"0 auto 16px",color:"#999"}}),e.jsx(n,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"Keine Adressen vorhanden"}),e.jsx(n,{variant:"body2",color:"text.secondary",children:"Füge deine erste Adresse über den Button oben hinzu"})]}):e.jsx(P,{container:!0,spacing:2,children:p.map(r=>{var g;return e.jsx(P,{size:{xs:12,md:6},children:e.jsx(Ye,{sx:{height:"100%",border:r.is_default?2:1,borderColor:r.is_default?"primary.main":"divider"},children:e.jsxs(Xe,{children:[e.jsxs(s,{sx:{display:"flex",justifyContent:"space-between",alignItems:"start",mb:2},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(es,{size:20,color:r.is_default?"#1976d2":"#666"}),e.jsx(n,{variant:"h6",fontWeight:600,children:r.name||"Unbenannte Adresse"})]}),r.is_default&&e.jsx(n,{variant:"caption",sx:{bgcolor:"primary.main",color:"white",px:1.5,py:.5,borderRadius:1,fontWeight:600},children:"Standard"})]}),e.jsx(n,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:r.address}),e.jsxs(n,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:[r.postal_code," ",r.city]}),e.jsx(n,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:((g=Ae.find(A=>A.code===r.country))==null?void 0:g.name)||r.country}),r.phone&&e.jsxs(n,{variant:"body2",color:"text.secondary",children:["Tel: ",r.phone]}),e.jsxs(s,{sx:{mt:2,display:"flex",gap:1,flexWrap:"wrap"},children:[(r.address_type==="both"||r.address_type==="pickup_only")&&e.jsx(s,{sx:{display:"flex",alignItems:"center",px:1.5,py:.75,bgcolor:"rgba(25, 118, 210, 0.08)",borderRadius:1.5,border:"1px solid",borderColor:"primary.main"},children:e.jsx(n,{variant:"caption",color:"primary.main",fontWeight:600,sx:{fontSize:"0.75rem",lineHeight:1},children:"Abholung"})}),(r.address_type==="both"||r.address_type==="shipping_only")&&e.jsx(s,{sx:{display:"flex",alignItems:"center",px:1.5,py:.75,bgcolor:"rgba(46, 125, 50, 0.08)",borderRadius:1.5,border:"1px solid",borderColor:"success.main"},children:e.jsx(n,{variant:"caption",color:"success.main",fontWeight:600,sx:{fontSize:"0.75rem",lineHeight:1},children:"Versand"})}),r.is_default_shipping&&e.jsx(s,{sx:{display:"flex",alignItems:"center",px:1.5,py:.75,bgcolor:"rgba(237, 108, 2, 0.08)",borderRadius:1.5,border:"1px solid",borderColor:"warning.main"},children:e.jsx(n,{variant:"caption",color:"warning.main",fontWeight:600,sx:{fontSize:"0.75rem",lineHeight:1},children:"Standard-Versand"})})]}),e.jsxs(s,{sx:{display:"flex",gap:1,mt:3},children:[e.jsx(G,{variant:"outlined",size:"medium",onClick:()=>$(r),fullWidth:!0,sx:{fontWeight:600,textTransform:"none",borderWidth:1.5,"&:hover":{borderWidth:1.5}},children:"Bearbeiten"}),e.jsx(G,{variant:"outlined",color:"error",size:"medium",onClick:()=>I(r.id),sx:{minWidth:48,px:1.5,fontWeight:600,borderWidth:1.5,"&:hover":{borderWidth:1.5}},children:e.jsx(ss,{size:18,strokeWidth:2})})]})]})})},r.id)})}),e.jsx(bs,{open:E,onClose:()=>m(!1),title:f?"Adresse bearbeiten":"Neue Adresse hinzufügen",maxWidth:"md",fullScreen:u,children:e.jsxs(P,{container:!0,spacing:3,children:[e.jsx(P,{size:{xs:12},children:e.jsx(W,{fullWidth:!0,label:"Name (optional)",value:i.name,onChange:r=>y({...i,name:r.target.value}),placeholder:"z.B. Zuhause, Arbeit"})}),e.jsx(P,{size:{xs:12},children:e.jsx(W,{fullWidth:!0,required:!0,label:"Straße und Hausnummer",value:i.address,onChange:r=>y({...i,address:r.target.value})})}),e.jsx(P,{size:{xs:12,sm:4},children:e.jsx(W,{fullWidth:!0,label:"PLZ",required:!0,value:i.postal_code,onChange:r=>y({...i,postal_code:r.target.value}),helperText:M?"Suche Orte...":j.length>0?`${j.length} Ort(e) gefunden`:""})}),e.jsx(P,{size:{xs:12,sm:8},children:e.jsx(ns,{fullWidth:!0,freeSolo:!0,loading:M,options:j,value:i.city,onInputChange:(r,g)=>{y({...i,city:g||""})},renderInput:r=>e.jsx(W,{...r,label:"Ort",required:!0})})}),e.jsx(P,{size:{xs:12,sm:6},children:e.jsx(W,{fullWidth:!0,select:!0,label:"Land",value:i.country,onChange:r=>y({...i,country:r.target.value}),SelectProps:{native:!0},children:Ae.map(r=>e.jsx("option",{value:r.code,children:r.name},r.code))})}),e.jsx(P,{size:{xs:12,sm:6},children:e.jsx(W,{fullWidth:!0,label:"Telefon (optional)",value:i.phone,onChange:r=>y({...i,phone:r.target.value}),helperText:"Wird für Artikeldetails verwendet, falls freigegeben"})}),i.phone&&e.jsx(P,{size:{xs:12},children:e.jsx(S,{control:e.jsx(N,{checked:i.show_phone_publicly,onChange:r=>y({...i,show_phone_publicly:r.target.checked})}),label:e.jsxs(s,{children:[e.jsx(n,{variant:"body2",children:"Telefonnummer öffentlich anzeigen"}),e.jsx(n,{variant:"caption",color:"text.secondary",children:"Wenn aktiviert, wird deine Telefonnummer bei Artikeln mit dieser Adresse angezeigt"})]})})}),e.jsx(P,{size:{xs:12},children:e.jsxs(W,{fullWidth:!0,select:!0,label:"Adresstyp",value:i.address_type,onChange:r=>y({...i,address_type:r.target.value}),helperText:"Wähle aus, wofür diese Adresse verwendet werden soll",children:[e.jsx(U,{value:"both",children:"Abholung & Versand"}),e.jsx(U,{value:"pickup_only",children:"Nur Abholung"}),e.jsx(U,{value:"shipping_only",children:"Nur Versand"})]})}),e.jsx(P,{size:{xs:12},children:e.jsxs(s,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsx(S,{control:e.jsx(N,{checked:i.is_default,onChange:r=>y({...i,is_default:r.target.checked})}),label:"Als Standard-Adresse für Abholung festlegen"}),(i.address_type==="both"||i.address_type==="shipping_only")&&e.jsx(S,{control:e.jsx(N,{checked:i.is_default_shipping,onChange:r=>y({...i,is_default_shipping:r.target.checked})}),label:"Als Standard-Versandadresse festlegen"})]})}),e.jsx(P,{size:{xs:12},children:e.jsxs(s,{sx:{display:"flex",gap:2,justifyContent:"flex-end",pt:3,mt:2,borderTop:1,borderColor:"divider"},children:[e.jsx(G,{onClick:()=>m(!1),size:"large",sx:{minWidth:120},children:"ABBRECHEN"}),e.jsx(G,{variant:"contained",onClick:v,disabled:k||!i.address||!i.postal_code||!i.city,size:"large",sx:{minWidth:120},children:k?e.jsx(se,{size:24}):"SPEICHERN"})]})})]})})]})},Ts=({formData:t,onFormChange:l})=>{const u=ne(),p=te(u.breakpoints.down("md")),h=p?s:R,b=p?{}:{sx:{p:3,mb:3}};return e.jsxs(s,{children:[e.jsx(n,{variant:"h5",fontWeight:700,gutterBottom:!0,sx:{mb:1,display:{xs:"none",md:"block"}},children:"Versand & Abholung"}),e.jsx(n,{variant:"body2",color:"text.secondary",sx:{mb:4,display:{xs:"none",md:"block"}},children:"Lege fest, wie Käufer deine Artikel erhalten können"}),e.jsx(F,{severity:"info",sx:{mb:3},children:"Diese Einstellungen gelten als Standard für alle deine Artikel."}),e.jsxs(h,{...b,children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",gap:1.5,mb:3},children:[e.jsx(Re,{size:20,color:"#1976d2"}),e.jsx(n,{variant:"h6",fontWeight:600,children:"Versandoptionen"})]}),e.jsx(S,{control:e.jsx(N,{checked:t.shipping_enabled,onChange:o=>l("shipping_enabled",o.target.checked)}),label:e.jsxs(s,{children:[e.jsx(n,{variant:"body2",fontWeight:600,children:"Versand anbieten"}),e.jsx(n,{variant:"caption",color:"text.secondary",children:"Biete Versand für deine Artikel an"})]}),sx:{alignItems:"flex-start",m:0,mb:3}}),t.shipping_enabled&&e.jsxs(s,{sx:{pl:{xs:0,sm:2},display:"flex",flexDirection:"column",gap:2.5},children:[e.jsxs(ts,{component:"fieldset",children:[e.jsx(is,{component:"legend",sx:{mb:1.5,fontWeight:600,fontSize:"0.875rem"},children:"Versandkostenberechnung"}),e.jsxs(Ne,{value:t.shipping_cost_type,onChange:o=>l("shipping_cost_type",o.target.value),children:[e.jsx(S,{value:"free",control:e.jsx(de,{size:"small"}),label:"Kostenloser Versand",sx:{mb:1}}),e.jsx(S,{value:"fixed",control:e.jsx(de,{size:"small"}),label:"Feste Versandkosten",sx:{mb:1}}),e.jsx(S,{value:"ai_calculated",control:e.jsx(de,{size:"small"}),label:"KI-berechnet (automatisch)"})]})]}),t.shipping_cost_type==="fixed"&&e.jsx(W,{label:"Versandkosten",type:"number",size:"small",value:t.shipping_cost,onChange:o=>l("shipping_cost",parseFloat(o.target.value)||0),InputProps:{endAdornment:e.jsx(xe,{position:"end",children:"€"}),inputProps:{min:0,step:.5}},helperText:"Standard-Versandkosten pro Artikel",sx:{maxWidth:280}}),e.jsx(W,{fullWidth:!0,multiline:!0,rows:2,size:"small",label:"Versandbeschreibung (optional)",placeholder:"z.B. Versand mit DHL, Lieferzeit 2-3 Werktage",value:t.shipping_description||"",onChange:o=>l("shipping_description",o.target.value||null),helperText:"Zusätzliche Informationen zum Versand"})]})]}),e.jsxs(h,{...b,children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",gap:1.5,mb:3},children:[e.jsx(ge,{size:20,color:"#1976d2"}),e.jsx(n,{variant:"h6",fontWeight:600,children:"Abholoptionen"})]}),e.jsx(S,{control:e.jsx(N,{checked:t.pickup_enabled,onChange:o=>l("pickup_enabled",o.target.checked)}),label:e.jsxs(s,{children:[e.jsx(n,{variant:"body2",fontWeight:600,children:"Abholung ermöglichen"}),e.jsx(n,{variant:"caption",color:"text.secondary",children:"Käufer können Artikel bei dir abholen"})]}),sx:{alignItems:"flex-start",m:0,mb:3}}),t.pickup_enabled&&e.jsxs(s,{sx:{pl:{xs:0,sm:2},display:"flex",flexDirection:"column",gap:2.5},children:[e.jsx(S,{control:e.jsx(N,{size:"small",checked:t.show_location_publicly,onChange:o=>l("show_location_publicly",o.target.checked)}),label:e.jsxs(s,{children:[e.jsx(n,{variant:"body2",fontWeight:500,children:"Standort öffentlich anzeigen"}),e.jsx(n,{variant:"caption",color:"text.secondary",sx:{display:"block",mt:.5},children:t.show_location_publicly?"Vollständige Adresse wird angezeigt":"Nur PLZ und Ort sichtbar"})]}),sx:{alignItems:"flex-start",m:0}}),e.jsx(W,{fullWidth:!0,multiline:!0,rows:2,size:"small",label:"Abholbeschreibung (optional)",placeholder:"z.B. Abholung nach Vereinbarung, Parkplätze vorhanden",value:t.location_description||"",onChange:o=>l("location_description",o.target.value||null),helperText:"Zusätzliche Informationen zur Abholung"})]})]})]})},Es=({formData:t,onFormChange:l})=>{const u=ne(),p=te(u.breakpoints.down("md")),h=p?s:R,b=p?{}:{sx:{p:3}};return e.jsxs(s,{children:[e.jsx(n,{variant:"h5",fontWeight:700,gutterBottom:!0,sx:{mb:1,display:{xs:"none",md:"block"}},children:"Anzeige-Einstellungen"}),e.jsx(n,{variant:"body2",color:"text.secondary",sx:{mb:4,display:{xs:"none",md:"block"}},children:"Passe die Darstellung der Anwendung an deine Bedürfnisse an"}),e.jsx(h,{...b,children:e.jsxs(s,{sx:{display:"flex",flexDirection:"column",gap:3},children:[e.jsxs(s,{children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",gap:1.5,mb:1.5},children:[e.jsx(rs,{size:20,color:"#1976d2"}),e.jsx(n,{variant:"h6",fontWeight:600,children:"Sprache"})]}),e.jsx(n,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Wähle die Sprache der Benutzeroberfläche"}),e.jsxs(W,{fullWidth:!0,select:!0,value:t.language,onChange:o=>l("language",o.target.value),SelectProps:{native:!0},children:[e.jsx("option",{value:"de",children:"Deutsch"}),e.jsx("option",{value:"en",children:"English"})]})]}),e.jsx(oe,{sx:{my:2}}),e.jsxs(s,{children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",gap:1.5,mb:1.5},children:[e.jsx(ge,{size:20,color:"#1976d2"}),e.jsx(n,{variant:"h6",fontWeight:600,children:"Standort-Sichtbarkeit"})]}),e.jsx(n,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Steuere, wer deinen Standort (Ort & Land) bei deinen Artikeln sehen kann"}),e.jsx(R,{elevation:0,sx:{p:2,border:1,borderColor:"divider",borderRadius:1,bgcolor:"grey.50"},children:e.jsx(S,{control:e.jsx(N,{checked:t.show_location_to_public,onChange:o=>l("show_location_to_public",o.target.checked)}),label:e.jsxs(s,{children:[e.jsx(n,{variant:"body2",fontWeight:500,children:"Standort für Besucher sichtbar"}),e.jsx(n,{variant:"caption",color:"text.secondary",children:t.show_location_to_public?"Ort und Land sind für alle sichtbar (auch nicht angemeldete Besucher)":"Ort und Land sind nur für angemeldete Nutzer sichtbar"})]}),sx:{alignItems:"flex-start",m:0}})}),e.jsx(n,{variant:"caption",color:"text.secondary",sx:{display:"block",mt:1.5,fontStyle:"italic"},children:"ℹ️ Vollständige Adressen sind nur für angemeldete Nutzer sichtbar, wenn du dies in den Abholoptionen aktiviert hast."})]}),e.jsx(oe,{sx:{my:2}}),e.jsxs(s,{children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",gap:1.5,mb:1.5},children:[e.jsx(Ss,{size:20,color:"#1976d2"}),e.jsx(n,{variant:"h6",fontWeight:600,children:"Händigkeit"})]}),e.jsx(n,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Optimiere die Button-Position für deine bevorzugte Hand bei der Ein-Hand-Bedienung"}),e.jsx(Ne,{value:t.hand_preference,onChange:o=>l("hand_preference",o.target.value),children:e.jsxs(s,{sx:{display:"flex",flexDirection:"column",gap:1.5},children:[e.jsx(R,{elevation:0,sx:{p:2,border:1,borderColor:t.hand_preference==="right"?"primary.main":"divider",borderRadius:1,cursor:"pointer","&:hover":{borderColor:"primary.main"}},onClick:()=>l("hand_preference","right"),children:e.jsx(S,{value:"right",control:e.jsx(de,{checked:t.hand_preference==="right"}),label:e.jsx(s,{sx:{display:"flex",alignItems:"center",gap:1.5},children:e.jsxs(s,{children:[e.jsx(n,{variant:"body2",fontWeight:600,children:"Rechtshänder"}),e.jsx(n,{variant:"caption",color:"text.secondary",children:"Navigation links, Aktionen rechts"})]})}),sx:{m:0,width:"100%"}})}),e.jsx(R,{elevation:0,sx:{p:2,border:1,borderColor:t.hand_preference==="left"?"primary.main":"divider",borderRadius:1,cursor:"pointer","&:hover":{borderColor:"primary.main"}},onClick:()=>l("hand_preference","left"),children:e.jsx(S,{value:"left",control:e.jsx(de,{checked:t.hand_preference==="left"}),label:e.jsx(s,{sx:{display:"flex",alignItems:"center",gap:1.5},children:e.jsxs(s,{children:[e.jsx(n,{variant:"body2",fontWeight:600,children:"Linkshänder"}),e.jsx(n,{variant:"caption",color:"text.secondary",children:"Navigation rechts, Aktionen links"})]})}),sx:{m:0,width:"100%"}})})]})})]}),e.jsx(oe,{sx:{my:2}}),e.jsxs(s,{children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",gap:1.5,mb:1.5},children:[e.jsx(js,{size:20,color:"#1976d2"}),e.jsx(n,{variant:"h6",fontWeight:600,children:"Verkäuferprofil-Sichtbarkeit"})]}),e.jsx(n,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Zeige dein Profil in deinen Inseraten an, um Vertrauen aufzubauen"}),e.jsx(R,{elevation:0,sx:{p:2,border:1,borderColor:"divider",borderRadius:1,bgcolor:"grey.50"},children:e.jsx(S,{control:e.jsx(N,{checked:t.show_seller_profile,onChange:o=>l("show_seller_profile",o.target.checked)}),label:e.jsxs(s,{children:[e.jsx(n,{variant:"body2",fontWeight:500,children:"Verkäuferprofil in Inseraten anzeigen"}),e.jsx(n,{variant:"caption",color:"text.secondary",children:t.show_seller_profile?"Dein Name, Avatar und andere Inserate werden in deinen Artikeln angezeigt":'Nur "Privater Verkäufer" wird angezeigt, keine persönlichen Infos'})]}),sx:{alignItems:"flex-start",m:0}})}),!t.show_seller_profile&&e.jsx(R,{elevation:0,sx:{p:2,mt:2,border:1,borderColor:"warning.main",borderRadius:1,bgcolor:"warning.50"},children:e.jsxs(s,{sx:{display:"flex",gap:1.5,alignItems:"flex-start"},children:[e.jsx(ks,{size:18,color:"#ed6c02",style:{flexShrink:0,marginTop:2}}),e.jsxs(s,{children:[e.jsx(n,{variant:"body2",fontWeight:600,color:"warning.dark",sx:{mb:.5},children:"Hinweis zur Sichtbarkeit"}),e.jsx(n,{variant:"caption",color:"text.secondary",children:"Inserate mit sichtbarem Verkäuferprofil wirken seriöser und erhalten durchschnittlich 40% mehr Anfragen. Dein Name und Avatar helfen Interessenten, Vertrauen aufzubauen."})]})]})}),e.jsx(n,{variant:"caption",color:"text.secondary",sx:{display:"block",mt:1.5,fontStyle:"italic"},children:"ℹ️ Du kannst dein Profilbild und deinen Namen jederzeit in den persönlichen Daten ändern."})]}),e.jsx(oe,{sx:{my:2}}),e.jsxs(s,{children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",gap:1.5,mb:1.5},children:[e.jsx(as,{size:20,color:"#1976d2"}),e.jsx(n,{variant:"h6",fontWeight:600,children:"Standard-Schaltdauer"})]}),e.jsx(n,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Lege fest, wie lange deine Inserate standardmäßig online bleiben. Diese Dauer wird bei jedem neuen Inserat verwendet."}),e.jsx(W,{fullWidth:!0,type:"number",value:t.default_listing_duration,onChange:o=>{const E=parseInt(o.target.value);E>=10&&E<=30&&l("default_listing_duration",E)},inputProps:{min:10,max:30,step:1},helperText:"Zwischen 10 und 30 Tagen",InputProps:{endAdornment:e.jsx(xe,{position:"end",children:e.jsx(n,{variant:"body2",color:"text.secondary",children:"Tage"})})}}),e.jsx(R,{elevation:0,sx:{p:2,mt:2,border:1,borderColor:"divider",borderRadius:1,bgcolor:"grey.50"},children:e.jsx(n,{variant:"caption",color:"text.secondary",children:'📅 Deine Inserate werden nach Ablauf dieser Dauer automatisch als "abgelaufen" markiert und sind nicht mehr öffentlich sichtbar. Du kannst sie jederzeit wieder aktivieren.'})})]})]})})]})},Bs=()=>{const t=Ve(),{user:l}=Le(),{personalCredits:u,communityPotBalance:p,loading:h}=ls();return e.jsxs(s,{children:[e.jsx(n,{variant:"h6",gutterBottom:!0,sx:{fontWeight:700,mb:3,display:{xs:"none",md:"block"}},children:"Mein Guthaben"}),e.jsxs(s,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",md:"repeat(2, 1fr)"},gap:{xs:2,md:3},mb:{xs:3,md:4}},children:[e.jsxs(R,{elevation:0,sx:{p:{xs:2,sm:2.5,md:3},borderRadius:{xs:2,md:3},bgcolor:"#f8f9fa",border:"1px solid #e8eaed",position:"relative",overflow:"hidden",transition:"all 0.2s ease","&:hover":{boxShadow:"0 1px 3px 0 rgba(60, 64, 67, 0.3), 0 4px 8px 3px rgba(60, 64, 67, 0.15)",transform:"translateY(-2px)"}},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"flex-start",gap:{xs:1.5,md:2},mb:{xs:2,md:2.5}},children:[e.jsx(s,{sx:{width:{xs:40,md:48},height:{xs:40,md:48},borderRadius:2,bgcolor:"#e8f0fe",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:e.jsx(Me,{size:24,color:"#1a73e8"})}),e.jsxs(s,{sx:{flex:1,minWidth:0},children:[e.jsx(n,{variant:"body2",color:"text.secondary",sx:{fontSize:{xs:"0.75rem",md:"0.875rem"},mb:.25,fontWeight:500},children:"Personal Inserate"}),e.jsx(n,{variant:"h3",sx:{fontWeight:600,color:"#202124",fontSize:{xs:"1.75rem",sm:"2rem",md:"2.5rem"},lineHeight:1.2},children:h?e.jsx(se,{size:28}):Te(u)})]})]}),e.jsxs(G,{fullWidth:!0,variant:"contained",startIcon:e.jsx(ws,{size:16}),onClick:()=>t("/tokens"),sx:{textTransform:"none",fontWeight:600,py:{xs:1,md:1.25},bgcolor:"#1a73e8",color:"white",borderRadius:2,boxShadow:"none",fontSize:{xs:"0.875rem",md:"1rem"},"&:hover":{bgcolor:"#1557b0",boxShadow:"0 1px 2px 0 rgba(60, 64, 67, 0.3), 0 1px 3px 1px rgba(60, 64, 67, 0.15)"}},children:[e.jsx(s,{component:"span",sx:{display:{xs:"none",sm:"inline"}},children:"Inserate kaufen"}),e.jsx(s,{component:"span",sx:{display:{xs:"inline",sm:"none"}},children:"Kaufen"})]})]}),e.jsxs(R,{elevation:0,sx:{p:{xs:2,sm:2.5,md:3},borderRadius:{xs:2,md:3},bgcolor:"#fef7ff",border:"1px solid #f3e8fd",position:"relative",overflow:"hidden",transition:"all 0.2s ease","&:hover":{boxShadow:"0 1px 3px 0 rgba(60, 64, 67, 0.3), 0 4px 8px 3px rgba(60, 64, 67, 0.15)",transform:"translateY(-2px)"}},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"flex-start",gap:{xs:1.5,md:2},mb:{xs:2,md:2.5}},children:[e.jsx(s,{sx:{width:{xs:40,md:48},height:{xs:40,md:48},borderRadius:2,bgcolor:"#fce8f3",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:e.jsx(Pe,{size:24,color:"#c51162",fill:"#c51162"})}),e.jsxs(s,{sx:{flex:1,minWidth:0},children:[e.jsx(n,{variant:"body2",color:"text.secondary",sx:{fontSize:{xs:"0.75rem",md:"0.875rem"},mb:.25,fontWeight:500},children:"Community-Topf"}),e.jsx(n,{variant:"h3",sx:{fontWeight:600,color:"#c51162",fontSize:{xs:"1.75rem",sm:"2rem",md:"2.5rem"},lineHeight:1.2},children:h?e.jsx(se,{size:28}):Te(p)})]})]}),e.jsxs(G,{fullWidth:!0,variant:"outlined",startIcon:e.jsx(Pe,{size:16}),onClick:()=>t("/tokens?tab=community"),sx:{textTransform:"none",fontWeight:600,py:{xs:1,md:1.25},borderColor:"#c51162",color:"#c51162",borderRadius:2,borderWidth:1.5,fontSize:{xs:"0.875rem",md:"1rem"},"&:hover":{borderColor:"#a00037",bgcolor:"rgba(197, 17, 98, 0.04)",borderWidth:1.5}},children:[e.jsx(s,{component:"span",sx:{display:{xs:"none",sm:"inline"}},children:"Jetzt spenden"}),e.jsx(s,{component:"span",sx:{display:{xs:"inline",sm:"none"}},children:"Spenden"})]})]})]}),e.jsx(xs,{mode:"user",userId:l==null?void 0:l.id,showUserColumn:!1,showFilters:!0,showStats:!1,showRefresh:!1,limit:50})]})},Vs=({userId:t,data:l,enabled:u,debounceMs:p=1e3})=>{const[h,b]=c.useState("idle"),[o,E]=c.useState(null),m=c.useRef(null),f=c.useRef(null),B=c.useRef(""),k=c.useRef(!0);return c.useEffect(()=>{if(!u||!t){console.log("⏸️ AutoSave disabled:",{enabled:u,userId:t});return}if(k.current){k.current=!1,B.current=JSON.stringify(l),console.log("🎬 AutoSave initialized");return}const L=JSON.stringify(l);if(L!==B.current)return console.log("📝 Data changed, scheduling save..."),B.current=L,m.current&&clearTimeout(m.current),b("idle"),m.current=setTimeout(async()=>{console.log("💾 Saving to database...",l),b("saving");try{const{error:i}=await D.from("profiles").update(l).eq("id",t);if(i)throw i;console.log("✅ Saved successfully!"),b("saved"),E(new Date),f.current&&clearTimeout(f.current),f.current=setTimeout(()=>{b("idle")},3e3)}catch(i){console.error("❌ Auto-save error:",i),b("error"),f.current&&clearTimeout(f.current),f.current=setTimeout(()=>{b("idle")},5e3)}},p),()=>{m.current&&clearTimeout(m.current),f.current&&clearTimeout(f.current)}},[t,l,u,p]),{status:h,lastSaved:o}},en=()=>{const{user:t}=Le(),l=ne(),u=te(l.breakpoints.down("md")),[p,h]=os(),[b,o]=c.useState(null),[E,m]=c.useState([]),[f,B]=c.useState(!0),[k,L]=c.useState(null),[i,y]=c.useState(()=>{const d=p.get("section");if(d)return d;const V=localStorage.getItem("settings-last-section");return V&&["overview","profile","security","addresses","shipping","display","ai","notifications","tokens","admin"].includes(V)?V:"profile"}),[j,C]=c.useState(!1),[M,H]=c.useState(!1),[a,O]=c.useState({full_name:"",email:"",phone:"",bio:"",language:"de",notifications_enabled:!0,email_notifications:!0,newsletter_subscribed:!1,show_phone_publicly:!1,ai_text_style:"balanced",ai_text_length:"medium",ai_include_emoji:!1,ai_allow_line_breaks:!1,ai_auto_publish:!1,ai_analyze_all_images:!1,shipping_enabled:!1,shipping_cost:5,shipping_cost_type:"fixed",shipping_description:null,pickup_enabled:!0,show_location_publicly:!1,show_location_to_public:!0,location_description:null,default_listing_duration:30,hand_preference:"right",show_seller_profile:!0}),$=t?{full_name:a.full_name||null,phone:a.phone||null,bio:a.bio||null,language:a.language||null,notifications_enabled:a.notifications_enabled,email_notifications:a.email_notifications,newsletter_subscribed:a.newsletter_subscribed,show_phone_publicly:a.show_phone_publicly,ai_text_style:a.ai_text_style,ai_text_length:a.ai_text_length,ai_include_emoji:a.ai_include_emoji,ai_auto_publish:a.ai_auto_publish,ai_allow_line_breaks:a.ai_allow_line_breaks,ai_analyze_all_images:a.ai_analyze_all_images,shipping_enabled:a.shipping_enabled,shipping_cost:a.shipping_cost,shipping_cost_type:a.shipping_cost_type,shipping_description:a.shipping_description,pickup_enabled:a.pickup_enabled,show_location_publicly:a.show_location_publicly,location_description:a.location_description,default_listing_duration:a.default_listing_duration,show_location_to_public:a.show_location_to_public,hand_preference:a.hand_preference,show_seller_profile:a.show_seller_profile}:{},{status:v,lastSaved:I}=Vs({userId:(t==null?void 0:t.id)||"",data:$,enabled:!!t,debounceMs:1e3}),r=async()=>{if(t){B(!0);try{const{data:d,error:V}=await D.from("profiles").select("*").eq("id",t.id).maybeSingle();if(V)throw V;if(d){o(d);const Z={full_name:d.full_name||"",email:d.email||"",phone:d.phone||"",bio:d.bio||"",language:d.language||"de",notifications_enabled:d.notifications_enabled??!0,email_notifications:d.email_notifications??!0,newsletter_subscribed:d.newsletter_subscribed??!1,show_phone_publicly:d.show_phone_publicly??!1,ai_text_style:d.ai_text_style||"balanced",ai_text_length:d.ai_text_length||"medium",ai_include_emoji:d.ai_include_emoji??!1,ai_allow_line_breaks:d.ai_allow_line_breaks??!1,ai_auto_publish:d.ai_auto_publish??!1,ai_analyze_all_images:d.ai_analyze_all_images??!1,shipping_enabled:d.shipping_enabled??!1,shipping_cost:d.shipping_cost??0,shipping_cost_type:d.shipping_cost_type||"fixed",shipping_description:d.shipping_description||null,pickup_enabled:d.pickup_enabled??!0,show_location_publicly:d.show_location_publicly??!1,show_location_to_public:d.show_location_to_public??!0,location_description:d.location_description||null,default_listing_duration:d.default_listing_duration??30,hand_preference:d.hand_preference||"right",show_seller_profile:d.show_seller_profile??!0};O(Z)}}catch(d){console.error("Error loading profile:",d),L("Fehler beim Laden des Profils")}finally{B(!1)}}},g=(d,V)=>{O(Z=>({...Z,[d]:V}))},A=d=>{const V=Math.floor((new Date().getTime()-d.getTime())/1e3);if(V<10)return"gerade eben";if(V<60)return`vor ${V}s`;const Z=Math.floor(V/60);return Z<60?`vor ${Z}min`:`vor ${Math.floor(Z/60)}h`};if(c.useEffect(()=>{r()},[t]),c.useEffect(()=>{const d=p.get("section");d&&["overview","profile","security","addresses","shipping","display","ai","notifications","tokens","admin"].includes(d)&&(y(d),localStorage.setItem("settings-last-section",d))},[p]),c.useEffect(()=>{localStorage.setItem("settings-last-section",i),(!p.get("section")||p.get("section")!==i)&&h({section:i})},[i]),f)return e.jsx(We,{maxWidth:"xl",sx:{py:4},children:e.jsx(s,{sx:{display:"flex",justifyContent:"center",py:8},children:e.jsx(se,{size:60})})});const K=()=>{switch(i){case"profile":return e.jsx(Cs,{profile:b,formData:{full_name:a.full_name,email:a.email,phone:a.phone,bio:a.bio,language:a.language},onFormChange:g,userId:(t==null?void 0:t.id)||"",onProfileUpdate:r});case"security":return t?e.jsx(As,{userId:t.id}):null;case"addresses":return t?e.jsx(Is,{userId:t.id}):null;case"shipping":return e.jsx(Ts,{formData:{shipping_enabled:a.shipping_enabled,shipping_cost:a.shipping_cost,shipping_cost_type:a.shipping_cost_type,shipping_description:a.shipping_description,pickup_enabled:a.pickup_enabled,show_location_publicly:a.show_location_publicly,location_description:a.location_description,show_ai_shipping_costs:!1},onFormChange:g});case"display":return e.jsx(Es,{formData:{language:a.language,show_location_to_public:a.show_location_to_public,default_listing_duration:a.default_listing_duration,hand_preference:a.hand_preference,show_seller_profile:a.show_seller_profile},onFormChange:g});case"ai":return e.jsx(Ps,{formData:{ai_text_style:a.ai_text_style,ai_text_length:a.ai_text_length,ai_include_emoji:a.ai_include_emoji,ai_auto_publish:a.ai_auto_publish,ai_allow_line_breaks:a.ai_allow_line_breaks,ai_analyze_all_images:a.ai_analyze_all_images},onFormChange:g});case"tokens":return e.jsx(Bs,{});case"notifications":return e.jsx(Ws,{formData:{notifications_enabled:a.notifications_enabled,email_notifications:a.email_notifications,newsletter_subscribed:a.newsletter_subscribed},onFormChange:g});case"admin":return e.jsx(gs,{});default:return null}},J=()=>({overview:"Übersicht",profile:"Persönliche Daten",security:"Sicherheit",addresses:"Adressen",shipping:"Versand & Abholung",display:"Anzeige",ai:"KI-Assistent",notifications:"Benachrichtigungen",tokens:"Mein Guthaben",admin:"Administration"})[i];return u?e.jsxs(s,{children:[e.jsx(ds,{position:"sticky",elevation:1,sx:{bgcolor:"background.paper",color:"text.primary"},children:e.jsxs(cs,{children:[e.jsx(ce,{edge:"start",onClick:()=>H(!0),sx:{mr:2},children:e.jsx(ps,{size:24})}),e.jsx(n,{variant:"h6",fontWeight:600,children:J()}),e.jsxs(s,{sx:{ml:"auto"},children:[v==="saving"&&e.jsx(Q,{icon:e.jsx(Ee,{size:14,style:{animation:"spin 1s linear infinite"}}),label:"Speichert...",size:"small",sx:{height:28}}),v==="saved"&&I&&e.jsx(Q,{icon:e.jsx(Ie,{size:14}),label:`Gespeichert ${A(I)}`,size:"small",color:"success",sx:{height:28}})]})]})}),e.jsx(hs,{anchor:"left",open:M,onClose:()=>H(!1),sx:{"& .MuiDrawer-paper":{width:280}},children:e.jsx(Be,{currentSection:i,onSectionChange:d=>{y(d),H(!1)},collapsed:!1,onToggleCollapse:()=>{},isMobile:!0})}),e.jsxs(s,{sx:{py:2,px:2},children:[k&&e.jsx(F,{severity:"error",sx:{mb:2},onClose:()=>L(null),children:k}),K()]})]}):e.jsxs(s,{sx:{display:"flex",minHeight:"calc(100vh - 200px)"},children:[e.jsx(Be,{currentSection:i,onSectionChange:y,collapsed:j,onToggleCollapse:()=>C(!j)}),e.jsxs(s,{sx:{flex:1,pl:4,pr:4,py:4,position:"relative"},children:[e.jsxs(s,{sx:{position:"fixed",top:80,right:24,zIndex:1e3},children:[v==="saving"&&e.jsx(Q,{icon:e.jsx(Ee,{size:14,style:{animation:"spin 1s linear infinite"}}),label:"Speichert...",size:"small",sx:{height:28}}),v==="saved"&&I&&e.jsx(Q,{icon:e.jsx(Ie,{size:14}),label:`Gespeichert ${A(I)}`,size:"small",color:"success",sx:{height:28}})]}),e.jsxs(We,{maxWidth:"lg",disableGutters:!0,children:[k&&e.jsx(F,{severity:"error",sx:{mb:3},onClose:()=>L(null),children:k}),K()]})]})]})};export{en as SettingsPage};
