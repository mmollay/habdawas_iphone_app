import{R as Ie,Z as ke,H as Be,f as ze,h as we,r as t,j as e,B as i,a3 as We,y as w,F as Z,T as n,J as Q,a2 as Ee,w as G,ac as Te,aj as Me,a9 as Pe,ad as Ae,O as Fe,D as Ge,i as Ve,l as He,ah as Ke,ai as Le,n as Ne,A as Oe,am as X,G as V}from"./index-DGPOwJJr.js";import{I as Re,a,c as Ze,b as Y,R as $e,W as Ue,B as D,H as qe}from"./InlineImageGallery-OtEn59I-.js";import{C as Je}from"./CategoryDropdown-C5_L9UJB.js";import{A as Qe}from"./arrow-left-Dg_Vpcc7.js";import{S as Xe}from"./star-CCnGXB6K.js";import{S as ee}from"./send-Dsz_AqS5.js";import"./plus-B36wF7R5.js";import"./Search-B8gagK-N.js";const us=()=>{var U,q;const y=Ie(),se=ke(),{user:W}=Be(),H=ze(),K=we(H.breakpoints.down("md")),s=se.state,[r,Ye]=t.useState(!0),[De,te]=t.useState(!1),[S,g]=t.useState(!1),[ie,L]=t.useState(!1),[N,ne]=t.useState(""),[d,le]=t.useState(!0),[$,u]=t.useState(null),[E,re]=t.useState((s==null?void 0:s.title)||""),[T,ae]=t.useState((s==null?void 0:s.description)||""),[M,oe]=t.useState((s==null?void 0:s.price)||0),[o,ce]=t.useState((s==null?void 0:s.category)||{}),[v,de]=t.useState((s==null?void 0:s.brand)||""),[P,ue]=t.useState((s==null?void 0:s.condition)||"used_good"),[h,he]=t.useState((s==null?void 0:s.tags)||[]),[x,ge]=t.useState((s==null?void 0:s.size)||""),[m,xe]=t.useState((s==null?void 0:s.weight)||""),[p,es]=t.useState((s==null?void 0:s.dimensions_length)||""),[C,ss]=t.useState((s==null?void 0:s.dimensions_width)||""),[I,ts]=t.useState((s==null?void 0:s.dimensions_height)||""),[f,me]=t.useState((s==null?void 0:s.material)||""),[c,pe]=t.useState((s==null?void 0:s.colors)||[]),[b,fe]=t.useState((s==null?void 0:s.style)||""),[_,be]=t.useState((s==null?void 0:s.serial_number)||""),[k,_e]=t.useState((s==null?void 0:s.images)||[]);t.useEffect(()=>{s||y("/items/create")},[s,y]),t.useEffect(()=>{te(!0)},[E,T,M,o,v,P,h,x,m,p,C,I,f,c,b,_]);const je=async()=>{if(W){g(!0),u(null);try{const l=X(o);if(!l){u("Bitte wähle eine Kategorie aus"),g(!1);return}const A={user_id:W.id,title:E,description:T,price:s.is_free?0:M,category_id:l,brand:v||null,condition:P,tags:h.length>0?h:null,size:x||null,weight:m||null,dimensions_length:p||null,dimensions_width:C||null,dimensions_height:I||null,material:f||null,colors:c.length>0?c:null,style:b||null,serial_number:_||null,shipping_enabled:s.shipping_enabled,shipping_cost_type:s.shipping_cost_type,shipping_cost_fixed:s.shipping_cost_fixed||null,shipping_description:s.shipping_description||null,pickup_enabled:s.pickup_enabled,pickup_address_id:s.pickup_address_id||null,show_location_publicly:s.show_location_publicly,location_description:s.location_description||null,price_negotiable:s.price_negotiable,is_free:s.is_free,status:"draft",duration_days:s.duration_days||30},{data:B,error:j}=await V.from("items").insert([A]).select().single();if(j)throw j;if(k.length>0){const O=k.map((F,R)=>({item_id:B.id,image_url:F,display_order:R})),{error:z}=await V.from("item_images").insert(O);if(z)throw z}y("/")}catch(l){console.error("Error saving draft:",l),u(l instanceof Error?l.message:"Fehler beim Speichern des Entwurfs")}finally{g(!1)}}},ye=async()=>{if(W){g(!0),u(null);try{const l=X(o);if(!l){u("Bitte wähle eine Kategorie aus"),g(!1);return}const A=new Date,B=d?null:new Date(N),j=new Date(A);j.setDate(j.getDate()+(s.duration_days||30));const O={user_id:W.id,title:E,description:T,price:s.is_free?0:M,category_id:l,brand:v||null,condition:P,tags:h.length>0?h:null,size:x||null,weight:m||null,dimensions_length:p||null,dimensions_width:C||null,dimensions_height:I||null,material:f||null,colors:c.length>0?c:null,style:b||null,serial_number:_||null,shipping_enabled:s.shipping_enabled,shipping_cost_type:s.shipping_cost_type,shipping_cost_fixed:s.shipping_cost_fixed||null,shipping_description:s.shipping_description||null,pickup_enabled:s.pickup_enabled,pickup_address_id:s.pickup_address_id||null,show_location_publicly:s.show_location_publicly,location_description:s.location_description||null,price_negotiable:s.price_negotiable,is_free:s.is_free,status:d?"active":"scheduled",published_at:d?A.toISOString():B==null?void 0:B.toISOString(),expires_at:j.toISOString(),duration_days:s.duration_days||30},{data:z,error:F}=await V.from("items").insert([O]).select().single();if(F)throw F;if(k.length>0){const R=k.map((ve,Ce)=>({item_id:z.id,image_url:ve,display_order:Ce})),{error:J}=await V.from("item_images").insert(R);if(J)throw J}y(`/items/${z.id}`)}catch(l){console.error("Error publishing item:",l),u(l instanceof Error?l.message:"Fehler beim Veröffentlichen")}finally{g(!1)}}};if(!s)return null;const Se=[{value:"new",label:"Neu"},{value:"used_like_new",label:"Gebraucht (wie neu)"},{value:"used_good",label:"Gebraucht (gut)"},{value:"used_acceptable",label:"Gebraucht (akzeptabel)"}];return e.jsxs(i,{sx:{minHeight:"100vh",bgcolor:"background.default",pb:10},children:[e.jsxs(We,{maxWidth:"lg",sx:{py:3},children:[e.jsx(w,{startIcon:e.jsx(Qe,{size:20}),onClick:()=>y(-1),sx:{mb:3},children:"Zurück"}),$&&e.jsx(Z,{severity:"error",sx:{mb:3},onClose:()=>u(null),children:$}),e.jsxs(Z,{severity:"info",sx:{mb:3},children:[e.jsx(n,{variant:"body2",fontWeight:600,gutterBottom:!0,children:"Vorschau-Modus"}),e.jsx(n,{variant:"body2",children:'Fahre mit der Maus über Titel, Beschreibung, Preis oder Details, um sie zu bearbeiten. Klicke auf "Veröffentlichen" wenn alles bereit ist, oder speichere als Entwurf.'})]}),e.jsx(Q,{elevation:0,sx:{border:"1px solid",borderColor:"divider"},children:e.jsxs(i,{sx:{p:3},children:[e.jsxs(i,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",md:"1fr 1fr"},gap:4},children:[e.jsx(i,{children:e.jsx(Re,{images:k,onImagesChange:_e,isEditMode:r,isMobile:K})}),e.jsxs(i,{children:[e.jsx(a,{value:E,onChange:re,isEditMode:r,variant:"h4",fontWeight:700,placeholder:"Titel",multiline:!1}),e.jsx(a,{value:s.is_free?"0":M.toString(),onChange:l=>oe(Number(l)),isEditMode:!s.is_free,variant:"h5",fontWeight:600,color:"primary.main",prefix:"€ ",placeholder:"0",multiline:!1,sx:{mt:2}}),s.price_negotiable&&e.jsx(Ee,{label:"VB",size:"small",sx:{mt:1,fontWeight:700,bgcolor:"warning.main",color:"white"}}),e.jsx(G,{sx:{my:3}}),e.jsx(n,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,children:"Beschreibung"}),e.jsx(a,{value:T,onChange:ae,isEditMode:r,variant:"body1",placeholder:"Beschreibung",multiline:!0,minRows:4}),e.jsx(G,{sx:{my:3}}),e.jsxs(i,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsxs(i,{children:[e.jsx(n,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,children:"Kategorie"}),r?e.jsx(Je,{value:o,onChange:ce,required:!0,showBreadcrumbs:!0}):e.jsx(n,{variant:"body2",children:o.level4||o.level3||o.level2||o.level1||"Keine Kategorie"})]}),e.jsxs(i,{children:[e.jsx(n,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,children:"Zustand"}),e.jsx(Ze,{value:P,onChange:ue,options:Se,isEditMode:r})]}),v&&e.jsxs(i,{children:[e.jsx(n,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,children:"Marke"}),e.jsx(a,{value:v,onChange:de,isEditMode:r,variant:"body2",placeholder:"Marke"})]}),h.length>0&&e.jsxs(i,{children:[e.jsxs(n,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(Te,{size:16})," Tags"]}),e.jsx(Y,{values:h,onChange:he,isEditMode:r})]})]}),e.jsx(G,{sx:{my:3}}),e.jsx(n,{variant:"subtitle1",fontWeight:600,gutterBottom:!0,children:"Versand & Abholung"}),e.jsxs(i,{sx:{display:"flex",flexDirection:"column",gap:1.5},children:[s.shipping_enabled&&e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Me,{size:20,color:H.palette.success.main}),e.jsxs(n,{variant:"body2",children:["Versand: ",s.shipping_cost_type==="free"?"Kostenlos":s.shipping_cost_type==="ai_calculated"?`€ ${((U=s.shipping_cost_fixed)==null?void 0:U.toFixed(2))||"0.00"}`:`€ ${((q=s.shipping_cost_fixed)==null?void 0:q.toFixed(2))||"0.00"}`]})]}),s.pickup_enabled&&e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Pe,{size:20,color:H.palette.primary.main}),e.jsx(n,{variant:"body2",children:"Abholung möglich"})]})]})]})]}),(x||m||p||f||c.length>0||b||_)&&e.jsxs(e.Fragment,{children:[e.jsx(G,{sx:{my:4}}),e.jsx(n,{variant:"h6",fontWeight:600,gutterBottom:!0,children:"Details"}),e.jsxs(i,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",sm:"1fr 1fr"},gap:2},children:[x&&e.jsxs(i,{children:[e.jsxs(n,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx($e,{size:16})," Größe"]}),e.jsx(a,{value:x,onChange:ge,isEditMode:r,variant:"body2",placeholder:"Größe"})]}),m&&e.jsxs(i,{children:[e.jsxs(n,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(Ue,{size:16})," Gewicht"]}),e.jsx(a,{value:m,onChange:xe,isEditMode:r,variant:"body2",placeholder:"Gewicht"})]}),(p||C||I)&&e.jsxs(i,{children:[e.jsxs(n,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(D,{size:16})," Maße"]}),e.jsxs(n,{variant:"body2",children:[p," × ",C," × ",I," cm"]})]}),f&&e.jsxs(i,{children:[e.jsxs(n,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(D,{size:16})," Material"]}),e.jsx(a,{value:f,onChange:me,isEditMode:r,variant:"body2",placeholder:"Material"})]}),c.length>0&&e.jsxs(i,{children:[e.jsxs(n,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(Ae,{size:16})," Farben"]}),e.jsx(Y,{values:c,onChange:pe,isEditMode:r})]}),b&&e.jsxs(i,{children:[e.jsxs(n,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(Fe,{size:16})," Stil"]}),e.jsx(a,{value:b,onChange:fe,isEditMode:r,variant:"body2",placeholder:"Stil"})]}),_&&e.jsxs(i,{children:[e.jsxs(n,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(qe,{size:16})," Seriennummer"]}),e.jsx(a,{value:_,onChange:be,isEditMode:r,variant:"body2",placeholder:"Seriennummer"})]})]})]})]})})]}),e.jsxs(Q,{elevation:8,sx:{position:"fixed",bottom:{xs:16,md:32},left:"50%",transform:"translateX(-50%)",zIndex:1300,p:2,display:"flex",alignItems:"center",gap:2,flexDirection:{xs:"column",sm:"row"},bgcolor:"background.paper",borderRadius:3,border:"2px solid",borderColor:"primary.main",boxShadow:"0 8px 32px rgba(0,0,0,0.12)",minWidth:{xs:"calc(100% - 32px)",sm:"auto"}},children:[e.jsx(w,{variant:"outlined",onClick:je,disabled:S,startIcon:e.jsx(Xe,{size:18}),fullWidth:K,children:"Als Entwurf speichern"}),e.jsx(w,{variant:"contained",onClick:()=>L(!0),disabled:S,startIcon:e.jsx(ee,{size:18}),fullWidth:K,children:S?"Wird veröffentlicht...":"Veröffentlichen"})]}),e.jsxs(Ge,{open:ie,onClose:()=>L(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(Ve,{children:"Inserat veröffentlichen"}),e.jsx(He,{children:e.jsxs(i,{sx:{display:"flex",flexDirection:"column",gap:2,pt:2},children:[e.jsx(Ke,{control:e.jsx(Le,{checked:d,onChange:l=>le(l.target.checked)}),label:"Sofort veröffentlichen"}),!d&&e.jsx(Ne,{fullWidth:!0,type:"datetime-local",label:"Veröffentlichungsdatum",value:N,onChange:l=>ne(l.target.value),InputLabelProps:{shrink:!0},inputProps:{min:new Date().toISOString().slice(0,16)}}),e.jsx(Z,{severity:"info",children:d?"Das Inserat wird sofort veröffentlicht und ist für alle sichtbar.":"Das Inserat wird zum gewählten Zeitpunkt automatisch veröffentlicht."})]})}),e.jsxs(Oe,{children:[e.jsx(w,{onClick:()=>L(!1),children:"Abbrechen"}),e.jsx(w,{onClick:ye,variant:"contained",startIcon:e.jsx(ee,{size:20}),disabled:S||!d&&!N,children:S?"Wird veröffentlicht...":"Veröffentlichen"})]})]})]})};export{us as ItemPreviewPage};
