import{aP as w,j as e,f as te,h as re,r as h,G as L,B as o,a0 as se,F as Q,bO as ae,T as p,a2 as ie,R as le,H as de,aA as ce,J as he,a3 as X,bP as xe,w as D,n as ue,b5 as pe,ah as Y,ao as Z,y as ee}from"./index-DGPOwJJr.js";import{S as ge}from"./Search-B8gagK-N.js";import{A as fe,a as me,b as be}from"./AccordionSummary-DTGT1Hvj.js";import"./Collapse-Dmhu021x.js";const je=w(e.jsx("path",{d:"M22 11V3h-7v3H9V3H2v8h7V8h2v10h4v3h7v-8h-7v3h-2V8h2v3z"})),Ce=w(e.jsx("path",{d:"m12 4-1.41 1.41L16.17 11H4v2h12.17l-5.58 5.59L12 20l8-8z"})),ve=w(e.jsx("path",{d:"M5 20h14v-2H5zM19 9h-4V3H9v6H5l7 7z"})),ye=w(e.jsx("path",{d:"M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6z"})),Se=w(e.jsx("path",{d:"M7.41 18.59 8.83 20 12 16.83 15.17 20l1.41-1.41L12 14zm9.18-13.18L15.17 4 12 7.17 8.83 4 7.41 5.41 12 10z"})),we=w(e.jsx("path",{d:"M12 5.83 15.17 9l1.41-1.41L12 3 7.41 7.59 8.83 9zm0 12.34L8.83 15l-1.41 1.41L12 21l4.59-4.59L15.17 15z"})),ke=({searchQuery:f="",showUsageCount:b=!0,expandAll:v=!1,showOnlyWithItems:H=!1,onCategoryClick:r})=>{const z=te(),O=re(z.breakpoints.down("sm")),[j,P]=h.useState([]),[m,T]=h.useState(!0),[k,A]=h.useState(null),[I,y]=h.useState(()=>{const t=localStorage.getItem("categoryTreeExpanded");if(t)try{return new Set(JSON.parse(t))}catch{return new Set}return new Set});h.useEffect(()=>{localStorage.setItem("categoryTreeExpanded",JSON.stringify(Array.from(I)))},[I]),h.useEffect(()=>{B()},[]);const[E,U]=h.useState(null);h.useEffect(()=>{if(v!==E&&j.length>0){if(v){const t=new Set,n=a=>{a.forEach(c=>{t.add(c.id),c.children&&n(c.children)})};n(j),y(t)}else E!==null&&y(new Set);U(v)}},[v,j,E]);const B=async()=>{try{T(!0),A(null);const{data:t,error:n}=await L.from("categories").select("*").order("level",{ascending:!0}).order("sort_order",{ascending:!0});if(n)throw n;if(t){const a=W(t);P(a)}}catch(t){console.error("Error fetching categories:",t),A(t instanceof Error?t.message:"Unknown error")}finally{T(!1)}},W=t=>{const n=new Map;t.forEach(i=>{n.set(i.id,{...i,children:[]})});const a=[];t.forEach(i=>{const d=n.get(i.id);if(d)if(i.parent_id===null)a.push(d);else{const x=n.get(i.parent_id);x&&(x.children=x.children||[],x.children.push(d))}});const c=i=>{let d=i.usage_count||0;return i.children&&i.children.length>0&&i.children.forEach(x=>{d+=c(x)}),i.total_usage_count=d,d};return a.forEach(i=>c(i)),a},M=(t,n="de")=>{var a,c;return((c=(a=t.translations)==null?void 0:a[n])==null?void 0:c.name)||t.slug},_=(t,n="de")=>{var a,c;return(c=(a=t.translations)==null?void 0:a[n])==null?void 0:c.description},F=t=>{var d;if(!f)return!0;const n=f.toLowerCase(),a=M(t).toLowerCase(),c=((d=_(t))==null?void 0:d.toLowerCase())||"",i=t.slug.toLowerCase();return a.includes(n)||c.includes(n)||i.includes(n)},$=t=>F(t)?!0:t.children?t.children.some(n=>$(n)):!1,N=t=>(t.total_usage_count??0)>0,G=t=>$(t)?H?N(t):!0:!1,l=t=>{y(n=>{const a=new Set(n);return a.has(t)?a.delete(t):a.add(t),a})},g=(t,n=0,a=!1)=>{if(!G(t))return null;const c=M(t),i=I.has(t.id),d=t.children&&t.children.length>0,x=C=>{switch(C){case 1:return"#1976d2";case 2:return"#388e3c";case 3:return"#f57c00";case 4:return"#d32f2f";default:return"#757575"}};return e.jsx(o,{sx:{...n===0&&!a&&{borderTop:"1px solid rgba(0, 0, 0, 0.06)",mt:1,pt:1,...O&&{mx:-2,px:2}}},children:e.jsxs(fe,{expanded:i,onChange:d?()=>l(t.id):void 0,elevation:0,sx:{backgroundColor:"transparent",border:"none",boxShadow:"none !important","&:before":{display:"none"},"&.Mui-expanded":{margin:0}},disableGutters:!0,children:[e.jsx(me,{expandIcon:d?e.jsx(ye,{sx:{fontSize:20}}):null,sx:{pl:1.5+n*2,pr:1,py:.5,minHeight:36,"&.Mui-expanded":{minHeight:36},borderLeft:n>0?`2px solid ${x(t.level)}`:"none","&:hover":{backgroundColor:"rgba(25, 118, 210, 0.04)"},transition:"background-color 0.2s ease"},children:e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:.75,width:"100%"},children:[e.jsx(o,{sx:{color:x(t.level),display:"flex",alignItems:"center",minWidth:18,justifyContent:"center"},children:ae(t.slug,16)}),e.jsx(p,{variant:n===0?"subtitle1":"body2",sx:{fontWeight:n===0?600:500,flexGrow:1,fontSize:n===0?"0.875rem":"0.8125rem",lineHeight:1.4},children:c}),e.jsxs(o,{sx:{display:"flex",gap:.5,alignItems:"center"},children:[b&&(t.total_usage_count??0)>0&&e.jsx(ie,{label:`${t.total_usage_count}`,size:"small",sx:{backgroundColor:"rgba(25, 118, 210, 0.08)",color:"primary.main",fontSize:"0.65rem",height:20,fontWeight:600,border:"1px solid",borderColor:"rgba(25, 118, 210, 0.2)","& .MuiChip-label":{px:.75}}}),r&&(t.total_usage_count??0)>0&&e.jsx(o,{onClick:C=>{C.stopPropagation(),r(t.slug)},sx:{display:"flex",alignItems:"center",justifyContent:"center",width:24,height:24,borderRadius:"50%",backgroundColor:"rgba(25, 118, 210, 0.08)",color:"primary.main",cursor:"pointer",transition:"all 0.2s ease","&:hover":{backgroundColor:"primary.main",color:"white",transform:"scale(1.1)"}},children:e.jsx(Ce,{sx:{fontSize:14}})})]})]})}),d&&e.jsx(be,{sx:{p:0},children:e.jsx(o,{children:t.children.map((C,u)=>g(C,n+1,u===0))})})]})},t.id)};return m?e.jsx(o,{sx:{display:"flex",justifyContent:"center",p:4},children:e.jsx(se,{})}):k?e.jsxs(Q,{severity:"error",sx:{m:2},children:["Fehler beim Laden der Kategorien: ",k]}):j.length===0?e.jsx(Q,{severity:"info",sx:{m:2},children:"Keine Kategorien gefunden."}):e.jsx(o,{children:j.map((t,n)=>g(t,0,n===0))})},Ae=()=>{const f=le(),{user:b}=de(),{checkCredit:v}=ce(),H=te(),r=re(H.breakpoints.down("sm")),[z,O]=h.useState(""),[j,P]=h.useState(!0),[m,T]=h.useState(!1),[k,A]=h.useState(!1),[I,y]=h.useState(null),[E,U]=h.useState(0),[B,W]=h.useState(0),[M,_]=h.useState(0);h.useEffect(()=>{b?v().then(y):y(null)},[b,v]),h.useEffect(()=>{(async()=>{try{const{count:g}=await L.from("items").select("*",{count:"exact",head:!0});if(g!==null&&U(g),b){const{count:t}=await L.from("items").select("*",{count:"exact",head:!0}).eq("user_id",b.id);t!==null&&W(t);const{count:n}=await L.from("favorites").select("*",{count:"exact",head:!0}).eq("user_id",b.id);n!==null&&_(n)}else W(0),_(0)}catch(g){console.error("Error loading counts:",g)}})()},[b]);const F=l=>{f(`/?categories=${l}`)},$=async()=>{try{const{data:l,error:g}=await L.from("categories").select("*").order("level",{ascending:!0}).order("sort_order",{ascending:!0});if(g)throw g;if(!l)return;const n=(d=>{const x=new Map;d.forEach(s=>{x.set(s.id,{...s,children:[]})});const C=[];d.forEach(s=>{const S=x.get(s.id);if(s.parent_id===null)C.push(S);else{const R=x.get(s.parent_id);R&&R.children.push(S)}});let u="HABDAWAS Kategorien-Struktur\\n";u+="=".repeat(50)+"\\n\\n";const q=(s,S=0)=>{var J,V;const R="  ".repeat(S),ne=((V=(J=s.translations)==null?void 0:J.de)==null?void 0:V.name)||s.slug;let K=`${R}${S===0?"■ ":"└─ "}${ne} [${["Level 1","Level 2","Level 3","Level 4"][s.level-1]}]`;return s.usage_count>0&&(K+=` (${s.usage_count} Inserate)`),K+="\\n",s.children&&s.children.length>0&&s.children.forEach(oe=>{K+=q(oe,S+1)}),K};return C.forEach(s=>{u+=q(s),u+="\\n"}),u+="\\n"+"=".repeat(50)+"\\n",u+=`Gesamt: ${d.length} Kategorien\\n`,u+=`Level 1: ${d.filter(s=>s.level===1).length} Kategorien\\n`,u+=`Level 2: ${d.filter(s=>s.level===2).length} Kategorien\\n`,u+=`Level 3: ${d.filter(s=>s.level===3).length} Kategorien\\n`,u+=`Level 4: ${d.filter(s=>s.level===4).length} Kategorien\\n`,u+=`\\nExportiert am: ${new Date().toLocaleString("de-DE")}\\n`,u})(l),a=new Blob([n],{type:"text/plain;charset=utf-8"}),c=URL.createObjectURL(a),i=document.createElement("a");i.href=c,i.download=`kategorien-struktur-${new Date().toISOString().split("T")[0]}.txt`,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(c)}catch(l){console.error("Error exporting tree:",l),alert("Fehler beim Exportieren der Kategorien-Struktur")}},N=l=>{l===0?f("/"):l===1?f("/?view=myitems"):l===2&&f("/?view=favorites")},G=l=>{f(l?`/?categories=${l}`:"/")};return e.jsxs(e.Fragment,{children:[e.jsx(he,{elevation:0,sx:{bgcolor:"background.paper",borderBottom:"1px solid",borderColor:"divider",mb:0},children:e.jsx(X,{maxWidth:"xl",sx:{maxWidth:"1400px !important"},children:e.jsx(xe,{selectedTab:0,onTabChange:N,selectedCategories:[],onCategoryChange:G,allItemsCount:E,myItemsCount:B,favoritesCount:M,creditInfo:I})})}),e.jsxs(X,{maxWidth:"lg",sx:{py:r?0:4,px:r?0:3},children:[e.jsx(o,{sx:{mb:r?0:4,pb:r?1.5:3,borderBottom:r?"none":"2px solid",borderColor:"divider",background:r?"none":"linear-gradient(135deg, rgba(25, 118, 210, 0.05) 0%, rgba(255, 255, 255, 0) 100%)",borderRadius:r?0:2,p:r?1.5:3},children:e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:r?1.5:2,mb:r?0:2},children:[e.jsx(o,{sx:{p:r?.75:1.5,borderRadius:r?1.5:2,backgroundColor:"primary.main",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:r?"none":"0 4px 12px rgba(25, 118, 210, 0.3)"},children:e.jsx(je,{sx:{fontSize:r?22:32,color:"white"}})}),e.jsxs(o,{children:[e.jsx(p,{variant:r?"h6":"h4",component:"h1",sx:{fontWeight:r?600:700,mb:r?0:.5},children:"Kategorien"}),!r&&e.jsx(p,{variant:"body2",color:"text.secondary",sx:{fontWeight:500},children:"Übersicht über alle verfügbaren Kategorien"})]})]})}),r&&e.jsx(D,{}),e.jsx(o,{sx:{p:r?1.5:3,mb:r?0:3,borderRadius:r?0:2,border:r?"none":"1px solid",borderColor:"divider",bgcolor:r?"transparent":"background.paper",boxShadow:r?"none":2},children:e.jsxs(o,{sx:{display:"flex",flexDirection:"column",gap:r?1.5:2.5},children:[e.jsx(ue,{fullWidth:!0,placeholder:"Kategorien durchsuchen...",value:z,onChange:l=>O(l.target.value),InputProps:{startAdornment:e.jsx(pe,{position:"start",children:e.jsx(ge,{})})},sx:{"& .MuiOutlinedInput-root":{"&:hover fieldset":{borderColor:"primary.main"}}}}),e.jsx(D,{}),e.jsxs(o,{sx:{display:"flex",gap:r?1:2,flexWrap:"wrap",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(o,{sx:{display:"flex",gap:r?1:2,flexWrap:"wrap",flexDirection:r?"column":"row"},children:[e.jsx(Y,{control:e.jsx(Z,{checked:j,onChange:l=>P(l.target.checked),size:r?"small":"medium"}),label:"Anzahl anzeigen",componentsProps:{typography:{variant:r?"body2":"body1",sx:{fontSize:r?"0.875rem":void 0,fontWeight:r?400:void 0,color:r?"text.secondary":void 0}}},sx:{m:0}}),e.jsx(Y,{control:e.jsx(Z,{checked:k,onChange:l=>A(l.target.checked),size:r?"small":"medium"}),label:"Nur mit Inseraten",componentsProps:{typography:{variant:r?"body2":"body1",sx:{fontSize:r?"0.875rem":void 0,fontWeight:r?400:void 0,color:r?"text.secondary":void 0}}},sx:{m:0}})]}),e.jsx(ee,{variant:m?"contained":"outlined",startIcon:m?e.jsx(Se,{}):e.jsx(we,{}),onClick:()=>T(!m),size:r?"small":"medium",sx:{minWidth:r?"auto":180,fontWeight:600,boxShadow:m?2:0,fontSize:r?"0.75rem":void 0,px:r?1.5:void 0,py:r?.5:void 0},children:r?m?"Einklappen":"Ausklappen":m?"Alle einklappen":"Alle ausklappen"})]})]})}),r&&e.jsx(D,{}),e.jsx(o,{sx:{mb:r?0:4,p:r?1.5:0},children:e.jsx(ke,{searchQuery:z,showUsageCount:j,expandAll:m,showOnlyWithItems:k,onCategoryClick:F})}),r&&e.jsx(D,{}),e.jsxs(o,{sx:{p:r?1.5:3,background:r?"transparent":"linear-gradient(135deg, rgba(25, 118, 210, 0.1) 0%, rgba(255, 255, 255, 1) 100%)",borderRadius:r?0:2,border:r?"none":"1px solid",borderColor:"primary.light",boxShadow:r?"none":2},children:[e.jsx(p,{variant:"h6",sx:{mb:2.5,fontWeight:700,color:"primary.main"},children:"Kategorien-Legende"}),e.jsxs(o,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",sm:"1fr 1fr"},gap:2},children:[e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:1.5},children:[e.jsx(o,{sx:{width:32,height:32,backgroundColor:"#1976d2",borderRadius:1.5,boxShadow:"0 2px 8px rgba(25, 118, 210, 0.3)",display:"flex",alignItems:"center",justifyContent:"center"}}),e.jsxs(o,{children:[e.jsx(p,{variant:"body2",sx:{fontWeight:600},children:"Level 1"}),e.jsx(p,{variant:"caption",color:"text.secondary",children:"Hauptkategorie"})]})]}),e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:1.5},children:[e.jsx(o,{sx:{width:32,height:32,backgroundColor:"#388e3c",borderRadius:1.5,boxShadow:"0 2px 8px rgba(56, 142, 60, 0.3)",display:"flex",alignItems:"center",justifyContent:"center"}}),e.jsxs(o,{children:[e.jsx(p,{variant:"body2",sx:{fontWeight:600},children:"Level 2"}),e.jsx(p,{variant:"caption",color:"text.secondary",children:"Unterkategorie"})]})]}),e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:1.5},children:[e.jsx(o,{sx:{width:32,height:32,backgroundColor:"#f57c00",borderRadius:1.5,boxShadow:"0 2px 8px rgba(245, 124, 0, 0.3)",display:"flex",alignItems:"center",justifyContent:"center"}}),e.jsxs(o,{children:[e.jsx(p,{variant:"body2",sx:{fontWeight:600},children:"Level 3"}),e.jsx(p,{variant:"caption",color:"text.secondary",children:"Detailkategorie"})]})]}),e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:1.5},children:[e.jsx(o,{sx:{width:32,height:32,backgroundColor:"#d32f2f",borderRadius:1.5,boxShadow:"0 2px 8px rgba(211, 47, 47, 0.3)",display:"flex",alignItems:"center",justifyContent:"center"}}),e.jsxs(o,{children:[e.jsx(p,{variant:"body2",sx:{fontWeight:600},children:"Level 4"}),e.jsx(p,{variant:"caption",color:"text.secondary",children:"Spezifikation"})]})]})]}),!r&&e.jsx(o,{sx:{mt:3,display:"flex",justifyContent:"flex-end"},children:e.jsx(ee,{variant:"text",size:"small",startIcon:e.jsx(ve,{}),onClick:$,sx:{fontSize:"0.75rem",color:"text.disabled",opacity:.4,textTransform:"none","&:hover":{opacity:.8,color:"primary.main",backgroundColor:"rgba(25, 118, 210, 0.04)"}},children:"Struktur exportieren"})})]})]})]})};export{Ae as default};
