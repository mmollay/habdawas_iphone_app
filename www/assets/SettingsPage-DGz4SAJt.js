import{e as Ce,R as Ge,j as e,J as V,B as t,I as he,W as Qe,L as Xe,q as et,t as ye,v as ve,o as tt,U as nt,aB as Oe,a9 as ue,ae as qe,a$ as we,O as it,b0 as st,b1 as Ae,r as x,D as rt,i as at,T as n,l as lt,F,n as I,b2 as He,a2 as Z,ar as q,b3 as Ue,A as ot,y as N,X as ct,G,f as ne,h as ie,V as dt,a0 as te,aY as ht,a_ as ut,aD as xt,a7 as pt,aw as ze,b4 as mt,b5 as ge,b6 as Ee,w as ce,ah as M,ao as O,ax as gt,b7 as bt,b8 as ft,b9 as Me,a5 as jt,aO as _t,ap as yt,aq as vt,H as Fe,az as wt,ba as zt,a6 as Be,bb as kt,a3 as De,bc as St,bd as Ct,N as Le,be as At}from"./index-DGPOwJJr.js";import{u as Wt,A as le,T as It,M as Pt,a as Tt}from"./AdminPage-COqamuzH.js";import{C as Et,M as Mt}from"./Modal-Dhaeircd.js";import{L as ke,U as Bt}from"./user-check-D0NyMNH_.js";import{C as Se}from"./x-circle-CmvsgzW0.js";import{G as z}from"./Grid-CZGgcgxd.js";import{S as Dt}from"./star-CCnGXB6K.js";import{A as Lt}from"./alert-circle-BIXLrZ7T.js";import{searchCitiesByPostalCode as Rt}from"./postalCodeLookup-Bx0v-AE9.js";import{P as Vt}from"./plus-B36wF7R5.js";import{R as Ze,a as de}from"./RadioGroup-Dy1vNQ9b.js";import{f as Re}from"./formatNumber-DRkU0_R_.js";import"./AccordionSummary-DTGT1Hvj.js";import"./Collapse-Dmhu021x.js";import"./chevron-down-D3Id4EJ6.js";import"./credit-card-DgpwZID8.js";import"./dollar-sign--Zf6K9v7.js";import"./send-Dsz_AqS5.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nt=Ce("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gt=Ce("Hand",[["path",{d:"M18 11V6a2 2 0 0 0-2-2v0a2 2 0 0 0-2 2v0",key:"aigmz7"}],["path",{d:"M14 10V4a2 2 0 0 0-2-2v0a2 2 0 0 0-2 2v2",key:"1n6bmn"}],["path",{d:"M10 10.5V6a2 2 0 0 0-2-2v0a2 2 0 0 0-2 2v8",key:"a9iiix"}],["path",{d:"M18 8a2 2 0 1 1 4 0v6a8 8 0 0 1-8 8h-2c-2.8 0-4.5-.86-5.99-2.34l-3.6-3.6a2 2 0 0 1 2.83-2.82L7 15",key:"1s1gnw"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ve=Ce("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]),Ne=({currentSection:i,onSectionChange:s,collapsed:o,onToggleCollapse:d,isMobile:p=!1})=>{const{isAdmin:h}=Wt(),a=Ge(),f=[{id:"profile",label:"Persönliche Daten",icon:e.jsx(nt,{size:20})},{id:"security",label:"Sicherheit",icon:e.jsx(ke,{size:20})},{id:"tokens",label:"Mein Guthaben",icon:e.jsx(Oe,{size:20})},{id:"addresses",label:"Adressen",icon:e.jsx(ue,{size:20})},{id:"shipping",label:"Versand & Abholung",icon:e.jsx(qe,{size:20})},{id:"display",label:"Anzeige",icon:e.jsx(we,{size:20})},{id:"ai",label:"KI-Assistent",icon:e.jsx(it,{size:20})},{id:"notifications",label:"Benachrichtigungen",icon:e.jsx(st,{size:20})}];return h&&f.push({id:"admin",label:"Administration",icon:e.jsx(Ae,{size:20})}),e.jsxs(V,{elevation:0,sx:{width:p?"100%":o?72:260,transition:"width 0.3s ease",height:p?"100%":"100vh",borderRight:p?0:1,borderColor:"divider",borderRadius:0,overflow:"auto",display:"flex",flexDirection:"column",position:p?"relative":"sticky",top:0,left:0},children:[!p&&e.jsx(t,{sx:{display:"flex",justifyContent:o?"center":"flex-end",p:1.5,borderBottom:1,borderColor:"divider"},children:e.jsx(he,{onClick:d,size:"small",sx:{bgcolor:"action.hover","&:hover":{bgcolor:"action.selected"}},children:o?e.jsx(Qe,{size:18}):e.jsx(Et,{size:18})})}),e.jsx(Xe,{sx:{pt:2,pb:2},children:f.map(m=>{const j=e.jsxs(et,{onClick:()=>{m.id==="admin"?a("/admin"):s(m.id)},selected:i===m.id,sx:{mb:.5,mx:o&&!p?1:1.5,borderRadius:2,minHeight:48,justifyContent:o&&!p?"center":"flex-start",px:o&&!p?0:2,"&.Mui-selected":{bgcolor:"primary.main",color:"white","&:hover":{bgcolor:"primary.dark"},"& .MuiListItemIcon-root":{color:"white"}},"&:hover":{bgcolor:o&&!p?"action.hover":"action.selected"}},children:[e.jsx(ye,{sx:{minWidth:o&&!p?"auto":40,justifyContent:"center",color:i===m.id?"inherit":"text.secondary"},children:m.icon}),(!o||p)&&e.jsx(ve,{primary:m.label,primaryTypographyProps:{fontWeight:i===m.id?600:400,fontSize:"0.95rem"}})]},m.id);return p?j:e.jsx(tt,{title:o?m.label:"",placement:"right",arrow:!0,children:j},m.id)})})]})},Ke={aries:{name:"Widder",symbol:"♈",emoji:"🐏",element:"fire",quality:"cardinal",startDate:{month:3,day:21},endDate:{month:4,day:19},color:"#E74C3C",description:"Mutig, energisch, leidenschaftlich"},taurus:{name:"Stier",symbol:"♉",emoji:"🐂",element:"earth",quality:"fixed",startDate:{month:4,day:20},endDate:{month:5,day:20},color:"#27AE60",description:"Zuverlässig, geduldig, praktisch"},gemini:{name:"Zwillinge",symbol:"♊",emoji:"👯",element:"air",quality:"mutable",startDate:{month:5,day:21},endDate:{month:6,day:20},color:"#F39C12",description:"Vielseitig, kommunikativ, neugierig"},cancer:{name:"Krebs",symbol:"♋",emoji:"🦀",element:"water",quality:"cardinal",startDate:{month:6,day:21},endDate:{month:7,day:22},color:"#95A5A6",description:"Fürsorglich, intuitiv, emotional"},leo:{name:"Löwe",symbol:"♌",emoji:"🦁",element:"fire",quality:"fixed",startDate:{month:7,day:23},endDate:{month:8,day:22},color:"#E67E22",description:"Selbstbewusst, großzügig, kreativ"},virgo:{name:"Jungfrau",symbol:"♍",emoji:"👩",element:"earth",quality:"mutable",startDate:{month:8,day:23},endDate:{month:9,day:22},color:"#16A085",description:"Analytisch, ordentlich, hilfsbereit"},libra:{name:"Waage",symbol:"♎",emoji:"⚖️",element:"air",quality:"cardinal",startDate:{month:9,day:23},endDate:{month:10,day:22},color:"#3498DB",description:"Harmonisch, diplomatisch, gerecht"},scorpio:{name:"Skorpion",symbol:"♏",emoji:"🦂",element:"water",quality:"fixed",startDate:{month:10,day:23},endDate:{month:11,day:21},color:"#8E44AD",description:"Intensiv, leidenschaftlich, mystisch"},sagittarius:{name:"Schütze",symbol:"♐",emoji:"🏹",element:"fire",quality:"mutable",startDate:{month:11,day:22},endDate:{month:12,day:21},color:"#9B59B6",description:"Optimistisch, abenteuerlustig, philosophisch"},capricorn:{name:"Steinbock",symbol:"♑",emoji:"🐐",element:"earth",quality:"cardinal",startDate:{month:12,day:22},endDate:{month:1,day:19},color:"#34495E",description:"Diszipliniert, ehrgeizig, verantwortungsbewusst"},aquarius:{name:"Wassermann",symbol:"♒",emoji:"🏺",element:"air",quality:"fixed",startDate:{month:1,day:20},endDate:{month:2,day:18},color:"#1ABC9C",description:"Innovativ, unabhängig, humanitär"},pisces:{name:"Fische",symbol:"♓",emoji:"🐟",element:"water",quality:"mutable",startDate:{month:2,day:19},endDate:{month:3,day:20},color:"#5DADE2",description:"Einfühlsam, künstlerisch, spirituell"}};function $e(i){if(!i)return null;const s=new Date(i+"T00:00:00"),o=s.getMonth()+1,d=s.getDate();for(const[p,h]of Object.entries(Ke)){const{startDate:a,endDate:f}=h;if(a.month>f.month){if(o===a.month&&d>=a.day||o===f.month&&d<=f.day||o>a.month||o<f.month)return h}else if(o===a.month&&d>=a.day||o===f.month&&d<=f.day||o>a.month&&o<f.month)return h}return null}const me={wien:{lat:48.2082,lon:16.3738,name:"Wien"},vienna:{lat:48.2082,lon:16.3738,name:"Wien"},graz:{lat:47.0707,lon:15.4395,name:"Graz"},linz:{lat:48.3064,lon:14.2861,name:"Linz"},salzburg:{lat:47.8095,lon:13.055,name:"Salzburg"},innsbruck:{lat:47.2692,lon:11.4041,name:"Innsbruck"},klagenfurt:{lat:46.6247,lon:14.3054,name:"Klagenfurt"},villach:{lat:46.6111,lon:13.8558,name:"Villach"},wels:{lat:48.1667,lon:14.0167,name:"Wels"},"sankt pölten":{lat:48.2,lon:15.6333,name:"St. Pölten"},"st. pölten":{lat:48.2,lon:15.6333,name:"St. Pölten"},dornbirn:{lat:47.4125,lon:9.7417,name:"Dornbirn"},steyr:{lat:48.0333,lon:14.4167,name:"Steyr"},berlin:{lat:52.52,lon:13.405,name:"Berlin"},münchen:{lat:48.1351,lon:11.582,name:"München"},munich:{lat:48.1351,lon:11.582,name:"München"},hamburg:{lat:53.5511,lon:9.9937,name:"Hamburg"},köln:{lat:50.9375,lon:6.9603,name:"Köln"},cologne:{lat:50.9375,lon:6.9603,name:"Köln"},frankfurt:{lat:50.1109,lon:8.6821,name:"Frankfurt"},stuttgart:{lat:48.7758,lon:9.1829,name:"Stuttgart"},düsseldorf:{lat:51.2277,lon:6.7735,name:"Düsseldorf"},zürich:{lat:47.3769,lon:8.5417,name:"Zürich"},zurich:{lat:47.3769,lon:8.5417,name:"Zürich"},genf:{lat:46.2044,lon:6.1432,name:"Genf"},geneva:{lat:46.2044,lon:6.1432,name:"Genf"},basel:{lat:47.5596,lon:7.5886,name:"Basel"},bern:{lat:46.948,lon:7.4474,name:"Bern"},lausanne:{lat:46.5197,lon:6.6323,name:"Lausanne"},london:{lat:51.5074,lon:-.1278,name:"London"},paris:{lat:48.8566,lon:2.3522,name:"Paris"},rome:{lat:41.9028,lon:12.4964,name:"Rom"},roma:{lat:41.9028,lon:12.4964,name:"Rom"},madrid:{lat:40.4168,lon:-3.7038,name:"Madrid"},"new york":{lat:40.7128,lon:-74.006,name:"New York"},tokyo:{lat:35.6762,lon:139.6503,name:"Tokyo"},sydney:{lat:-33.8688,lon:151.2093,name:"Sydney"}};function Ot(i){if(!i)return{lat:48.2082,lon:16.3738};const s=i.toLowerCase().replace(/[,]/g," ").replace(/ö/g,"o").replace(/ü/g,"u").replace(/ä/g,"a").replace(/ß/g,"ss").trim();if(me[s])return{lat:me[s].lat,lon:me[s].lon};for(const[o,d]of Object.entries(me))if(s.includes(o)||o.includes(s.split(" ")[0]))return{lat:d.lat,lon:d.lon};return{lat:48.2082,lon:16.3738}}function qt(i){const s=Math.floor((14-(i.getUTCMonth()+1))/12),o=i.getUTCFullYear()+4800-s,d=i.getUTCMonth()+1+12*s-3;let p=i.getUTCDate()+Math.floor((153*d+2)/5)+365*o+Math.floor(o/4)-Math.floor(o/100)+Math.floor(o/400)-32045;const h=i.getUTCHours(),a=i.getUTCMinutes(),f=i.getUTCSeconds(),m=(h-12)/24+a/1440+f/86400;return p+m}function Ht(i){const s=(i-2451545)/36525;let o=280.46061837+360.98564736629*(i-2451545)+387933e-9*s*s-s*s*s/3871e4;return o=o%360,o<0&&(o+=360),o}function Ut(i,s){let o=i+s;return o=o%360,o<0&&(o+=360),o}function Ft(i,s){const d=i*Math.PI/180,p=s*Math.PI/180,h=23.43928*Math.PI/180,a=-Math.sin(h)*Math.tan(p)+Math.cos(h)*Math.sin(d),f=Math.cos(d)/a;let m=Math.atan(f)*(180/Math.PI);Math.cos(d)<0&&(m+=180),m<0&&(m+=360),m=m%360;const j=["aries","taurus","gemini","cancer","leo","virgo","libra","scorpio","sagittarius","capricorn","aquarius","pisces"],y=Math.floor(m/30),S=j[y];return Ke[S]||null}function Ye(i,s,o,d){try{if(!i||!s)return null;const p=Ot(d);if(!p)return null;const[h,a,f]=i.split("-").map(Number),[m,j]=s.split(":").map(Number);if(!h||!a||!f||m===void 0||j===void 0)return null;const y=new Date(h,a-1,f,m,j,0),S=new Date(y.toISOString()),A=qt(S),r=Ht(A),_=Ut(r,p.lon);return Ft(_,p.lat)}catch(p){return console.error("Error calculating ascendant:",p),null}}const Zt=[{value:"Europe/Vienna",label:"Europa/Wien (GMT+1)"},{value:"Europe/Berlin",label:"Europa/Berlin (GMT+1)"},{value:"Europe/Zurich",label:"Europa/Zürich (GMT+1)"},{value:"Europe/London",label:"Europa/London (GMT+0)"},{value:"Europe/Paris",label:"Europa/Paris (GMT+1)"},{value:"Europe/Rome",label:"Europa/Rom (GMT+1)"},{value:"Europe/Madrid",label:"Europa/Madrid (GMT+1)"},{value:"America/New_York",label:"Amerika/New York (GMT-5)"},{value:"America/Los_Angeles",label:"Amerika/Los Angeles (GMT-8)"},{value:"America/Chicago",label:"Amerika/Chicago (GMT-6)"},{value:"Asia/Tokyo",label:"Asien/Tokyo (GMT+9)"},{value:"Asia/Dubai",label:"Asien/Dubai (GMT+4)"},{value:"Australia/Sydney",label:"Australien/Sydney (GMT+10)"},{value:"UTC",label:"UTC (GMT+0)"}],Kt=({open:i,onClose:s,userId:o,currentData:d,onSave:p})=>{const[h,a]=x.useState({birth_date:d.birth_date||"",birth_time:d.birth_time||"",birth_place:d.birth_place||"",birth_timezone:d.birth_timezone||"Europe/Vienna"}),[f,m]=x.useState(!1),[j,y]=x.useState(null),[S,A]=x.useState(!1),r=$e(h.birth_date),_=Ye(h.birth_date,h.birth_time,h.birth_timezone,h.birth_place);x.useEffect(()=>{i&&(a({birth_date:d.birth_date||"",birth_time:d.birth_time||"",birth_place:d.birth_place||"",birth_timezone:d.birth_timezone||"Europe/Vienna"}),y(null),A(!1))},[i,d]);const w=async()=>{if(y(null),A(!1),!h.birth_date){y("Bitte gib ein Geburtsdatum ein");return}if(!h.birth_time){y("Bitte gib eine Geburtszeit ein");return}if(!h.birth_timezone){y("Bitte wähle eine Zeitzone aus");return}m(!0);try{const{error:g}=await G.from("profiles").update({birth_date:h.birth_date,birth_time:h.birth_time,birth_place:h.birth_place||null,birth_timezone:h.birth_timezone,updated_at:new Date().toISOString()}).eq("id",o);if(g)throw g;A(!0),setTimeout(()=>{p(),s()},1e3)}catch(g){console.error("Error saving birth data:",g),y(g instanceof Error?g.message:"Fehler beim Speichern")}finally{m(!1)}},P=async()=>{if(window.confirm("Möchtest du wirklich alle Geburtsdaten löschen?")){m(!0),y(null);try{const{error:g}=await G.from("profiles").update({birth_date:null,birth_time:null,birth_place:null,birth_timezone:null,updated_at:new Date().toISOString()}).eq("id",o);if(g)throw g;a({birth_date:"",birth_time:"",birth_place:"",birth_timezone:"Europe/Vienna"}),A(!0),setTimeout(()=>{p(),s()},1e3)}catch(g){console.error("Error clearing birth data:",g),y(g instanceof Error?g.message:"Fehler beim Löschen")}finally{m(!1)}}};return e.jsxs(rt,{open:i,onClose:s,maxWidth:"sm",fullWidth:!0,children:[e.jsx(at,{children:e.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Se,{size:24}),e.jsx(n,{variant:"h6",component:"span",children:"Geburtsdaten"})]})}),e.jsx(lt,{children:e.jsxs(t,{sx:{mt:1},children:[e.jsx(F,{severity:"info",sx:{mb:3},children:"Diese Daten werden verwendet um deine Inserate besser auf dein Profil abzustimmen. Sie sind nicht öffentlich sichtbar."}),j&&e.jsx(F,{severity:"error",sx:{mb:2},children:j}),S&&e.jsx(F,{severity:"success",sx:{mb:2},children:"Geburtsdaten erfolgreich gespeichert!"}),e.jsxs(z,{container:!0,spacing:{xs:2,md:3},children:[e.jsx(z,{size:{xs:12,md:6},children:e.jsx(I,{fullWidth:!0,label:"Geburtsdatum",type:"date",value:h.birth_date,onChange:g=>a({...h,birth_date:g.target.value}),InputLabelProps:{shrink:!0},InputProps:{startAdornment:e.jsx(Se,{size:18,style:{marginRight:8,opacity:.5}})},helperText:"Für Sternzeichen-Berechnung",required:!0})}),e.jsx(z,{size:{xs:12,md:6},children:e.jsx(I,{fullWidth:!0,label:"Geburtszeit",type:"time",value:h.birth_time,onChange:g=>a({...h,birth_time:g.target.value}),InputLabelProps:{shrink:!0},InputProps:{startAdornment:e.jsx(He,{size:18,style:{marginRight:8,opacity:.5}})},helperText:"Für Aszendent-Berechnung",required:!0})}),r&&e.jsx(z,{size:{xs:12},children:e.jsxs(t,{sx:{p:2,bgcolor:"action.hover",borderRadius:1,display:"flex",alignItems:"center",gap:2},children:[e.jsx(t,{sx:{fontSize:"3rem",lineHeight:1},children:r.symbol}),e.jsxs(t,{sx:{flex:1},children:[e.jsxs(n,{variant:"subtitle1",fontWeight:600,children:["Sternzeichen: ",r.name]}),e.jsx(n,{variant:"caption",color:"text.secondary",children:r.description}),e.jsx(t,{sx:{mt:.5,display:"flex",gap:.5},children:e.jsx(Z,{label:r.element==="fire"?"Feuer":r.element==="earth"?"Erde":r.element==="air"?"Luft":"Wasser",size:"small",sx:{bgcolor:r.color+"20",color:r.color,fontWeight:600}})})]})]})}),_&&e.jsx(z,{size:{xs:12},children:e.jsxs(t,{sx:{p:2,bgcolor:"action.hover",borderRadius:1,display:"flex",alignItems:"center",gap:2},children:[e.jsx(t,{sx:{fontSize:"3rem",lineHeight:1},children:_.symbol}),e.jsxs(t,{sx:{flex:1},children:[e.jsxs(n,{variant:"subtitle1",fontWeight:600,children:["Aszendent: ",_.name]}),e.jsx(n,{variant:"caption",color:"text.secondary",children:_.description}),e.jsx(t,{sx:{mt:.5,display:"flex",gap:.5},children:e.jsx(Z,{label:_.element==="fire"?"Feuer":_.element==="earth"?"Erde":_.element==="air"?"Luft":"Wasser",size:"small",sx:{bgcolor:_.color+"20",color:_.color,fontWeight:600}})})]})]})}),e.jsx(z,{size:{xs:12,md:6},children:e.jsx(I,{fullWidth:!0,select:!0,label:"Zeitzone",value:h.birth_timezone,onChange:g=>a({...h,birth_timezone:g.target.value}),InputProps:{startAdornment:e.jsx(Ue,{size:18,style:{marginRight:8,opacity:.5}})},helperText:"Zeitzone zum Geburtszeitpunkt",required:!0,children:Zt.map(g=>e.jsx(q,{value:g.value,children:g.label},g.value))})}),e.jsx(z,{size:{xs:12,md:6},children:e.jsx(I,{fullWidth:!0,label:"Geburtsort (optional)",value:h.birth_place,onChange:g=>a({...h,birth_place:g.target.value}),InputProps:{startAdornment:e.jsx(ue,{size:18,style:{marginRight:8,opacity:.5}})},placeholder:"z.B. Wien, Österreich",helperText:"Optional: Nur für Anzeigezwecke"})})]})]})}),e.jsxs(ot,{sx:{px:3,pb:2},children:[e.jsx(N,{onClick:P,disabled:f||!h.birth_date&&!h.birth_time,color:"error",variant:"outlined",size:"small",children:"Löschen"}),e.jsx(t,{sx:{flex:1}}),e.jsx(N,{onClick:s,disabled:f,startIcon:e.jsx(ct,{size:18}),children:"Abbrechen"}),e.jsx(N,{onClick:w,disabled:f,variant:"contained",startIcon:e.jsx(Dt,{size:18}),children:f?"Speichert...":"Speichern"})]})]})},$t=({profile:i,formData:s,onFormChange:o,userId:d,onProfileUpdate:p})=>{var We,Ie;const h=ne(),a=ie(h.breakpoints.down("md")),[f,m]=x.useState(!1),[j,y]=x.useState(!1),[S,A]=x.useState("idle"),[r,_]=x.useState(""),[w,P]=x.useState(null),[g,H]=x.useState(null),c=x.useRef(null),[U,Y]=x.useState(!1),[W,B]=x.useState(null),[l,v]=x.useState(!1),k=$e(s.birth_date),T=Ye(s.birth_date,s.birth_time,s.birth_timezone,s.birth_place),J=b=>{B(b.currentTarget)},u=()=>{B(null)},R=()=>{var b;u(),(b=c.current)==null||b.click()},K=()=>{u(),Y(!0)},xe=b=>new Promise(L=>{const se=new FileReader;se.onload=Pe=>{var oe;const Q=new Image;Q.onload=()=>{const re=document.createElement("canvas"),ae=re.getContext("2d"),je=1200,_e=1200;let X=Q.width,ee=Q.height;X>ee?X>je&&(ee=ee*je/X,X=je):ee>_e&&(X=X*_e/ee,ee=_e),re.width=X,re.height=ee,ae==null||ae.drawImage(Q,0,0,X,ee),re.toBlob(Te=>{if(Te){const Je=new File([Te],b.name,{type:"image/jpeg",lastModified:Date.now()});L(Je)}},"image/jpeg",.85)},Q.src=(oe=Pe.target)==null?void 0:oe.result},se.readAsDataURL(b)}),pe=async b=>{if(!b.type.startsWith("image/")){alert("Bitte wähle eine Bilddatei aus");return}m(!0);try{const L=await xe(b);if(L.size>5*1024*1024){alert("Die Datei ist zu groß. Maximal 5MB erlaubt."),m(!1);return}const se=L.name.split(".").pop(),Q=`avatars/${`${d}-${Date.now()}.${se}`}`,{error:oe}=await G.storage.from("avatars").upload(Q,L);if(oe)throw oe;const{data:{publicUrl:re}}=G.storage.from("avatars").getPublicUrl(Q),{error:ae}=await G.from("profiles").update({avatar_url:re}).eq("id",d);if(ae)throw ae;p()}catch(L){console.error("Error uploading avatar:",L),alert("Fehler beim Hochladen des Bildes")}finally{m(!1)}},C=async b=>{var se;const L=(se=b.target.files)==null?void 0:se[0];L&&await pe(L)},D=async b=>{await pe(b)},$=async()=>{if(!s.phone||s.phone.trim()===""){P("Bitte gib zuerst eine Telefonnummer ein");return}y(!0),P(null);try{const{data:b,error:L}=await G.rpc("request_phone_verification",{p_phone:s.phone});if(L)throw L;b.success?(H(b.code),A("code-sent")):P(b.message)}catch(b){console.error("Verification request error:",b),P("Fehler beim Senden des Codes")}finally{y(!1)}},E=async()=>{if(!r||r.length!==6){P("Bitte gib den 6-stelligen Code ein");return}y(!0),P(null);try{const{data:b,error:L}=await G.rpc("verify_phone_code",{p_code:r});if(L)throw L;b.success?(A("verified"),p()):P(b.message)}catch(b){console.error("Verification error:",b),P("Ungültiger oder abgelaufener Code")}finally{y(!1)}},be=a?t:V,fe=a?{}:{sx:{p:3}};return e.jsxs(t,{children:[e.jsx(n,{variant:"h5",fontWeight:700,gutterBottom:!0,sx:{mb:1,display:{xs:"none",md:"block"}},children:"Persönliche Daten"}),e.jsx(n,{variant:"body2",color:"text.secondary",sx:{mb:{xs:2,md:4},display:{xs:"none",md:"block"}},children:"Verwalte deine persönlichen Informationen"}),e.jsxs(be,{...fe,children:[e.jsxs(t,{sx:{display:"flex",alignItems:"center",mb:4,flexDirection:{xs:"column",sm:"row"},textAlign:{xs:"center",sm:"left"}},children:[e.jsxs(t,{sx:{position:"relative",mb:{xs:2,sm:0}},children:[e.jsx(dt,{src:(i==null?void 0:i.avatar_url)||void 0,sx:{width:100,height:100,fontSize:"2rem",bgcolor:"primary.main"},children:((Ie=(We=s.full_name)==null?void 0:We[0])==null?void 0:Ie.toUpperCase())||"U"}),e.jsx("input",{ref:c,type:"file",accept:"image/*",style:{display:"none"},onChange:C}),e.jsx(he,{onClick:J,disabled:f,sx:{position:"absolute",bottom:0,right:0,bgcolor:"primary.main",color:"white","&:hover":{bgcolor:"primary.dark"},width:36,height:36},children:f?e.jsx(te,{size:18,color:"inherit"}):e.jsx(ht,{size:18})}),e.jsxs(ut,{anchorEl:W,open:!!W,onClose:u,transformOrigin:{horizontal:"right",vertical:"top"},anchorOrigin:{horizontal:"right",vertical:"bottom"},children:[e.jsxs(q,{onClick:K,children:[e.jsx(ye,{children:e.jsx(xt,{size:18})}),e.jsx(ve,{children:"Foto aufnehmen"})]}),e.jsxs(q,{onClick:R,children:[e.jsx(ye,{children:e.jsx(pt,{size:18})}),e.jsx(ve,{children:"Datei wählen"})]})]})]}),e.jsxs(t,{sx:{ml:{sm:3}},children:[e.jsx(n,{variant:"h6",fontWeight:600,children:s.full_name||"Kein Name"}),e.jsx(n,{variant:"body2",color:"text.secondary",children:s.email})]})]}),e.jsxs(z,{container:!0,spacing:{xs:2,md:3},children:[e.jsx(z,{size:{xs:12,md:6},children:e.jsx(le,{fieldName:"full_name",fullWidth:!0,label:"Vollständiger Name",value:s.full_name,onChange:b=>o("full_name",b.target.value),helperText:"Dein voller Name wird anderen Nutzern angezeigt"})}),e.jsx(z,{size:{xs:12,md:6},children:e.jsx(le,{fieldName:"title",fullWidth:!0,label:"Akademischer Titel (optional)",value:s.title||"",onChange:b=>o("title",b.target.value),placeholder:"z.B. Dr., Prof., Mag.",helperText:"Wird in E-Mail-Anreden verwendet"})}),e.jsx(z,{size:{xs:12,md:6},children:e.jsxs(le,{fieldName:"salutation",fullWidth:!0,select:!0,label:"Anrede",value:s.salutation||"neutral",onChange:b=>o("salutation",b.target.value),helperText:"Wird für die korrekte Anrede in E-Mails verwendet",SelectProps:{native:!0},children:[e.jsx("option",{value:"neutral",children:"Neutral"}),e.jsx("option",{value:"mr",children:"Herr"}),e.jsx("option",{value:"ms",children:"Frau"})]})}),e.jsx(z,{size:{xs:12,md:6},children:e.jsx(I,{fullWidth:!0,label:"E-Mail-Adresse",value:s.email,disabled:!0,helperText:"Deine E-Mail-Adresse kann nicht geändert werden"})}),e.jsx(z,{size:{xs:12},children:e.jsxs(t,{children:[e.jsx(t,{sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:e.jsx(le,{fieldName:"phone",fullWidth:!0,label:"Telefonnummer",value:s.phone,onChange:b=>o("phone",b.target.value),placeholder:"+43 650 123456",disabled:(i==null?void 0:i.phone_verified)||S==="code-sent",InputProps:{endAdornment:i!=null&&i.phone_verified?e.jsx(Z,{icon:e.jsx(ze,{size:16}),label:"Verifiziert",color:"success",size:"small",sx:{mr:-1}}):void 0}})}),!(i!=null&&i.phone_verified)&&S==="idle"&&e.jsxs(t,{sx:{mt:2},children:[e.jsx(N,{variant:"outlined",startIcon:e.jsx(Ae,{size:18}),onClick:$,disabled:j||!s.phone,size:"small",children:j?"Sende Code...":"Telefonnummer verifizieren"}),e.jsx(n,{variant:"caption",display:"block",color:"text.secondary",sx:{mt:1},children:"Erhöhe das Vertrauen durch Verifizierung deiner Telefonnummer"})]}),S==="code-sent"&&e.jsxs(t,{sx:{mt:2},children:[e.jsxs(F,{severity:"info",sx:{mb:2},children:[e.jsxs(n,{variant:"body2",sx:{mb:1},children:[e.jsx("strong",{children:"Demo-Modus:"})," Der Verifizierungscode lautet: ",e.jsx("strong",{children:g})]}),e.jsx(n,{variant:"caption",color:"text.secondary",children:"In der Produktion würde dieser Code per SMS gesendet werden."})]}),e.jsxs(t,{sx:{display:"flex",gap:2,alignItems:"flex-start"},children:[e.jsx(I,{label:"6-stelliger Code",value:r,onChange:b=>{const L=b.target.value.replace(/\D/g,"").slice(0,6);_(L)},placeholder:"123456",inputProps:{maxLength:6},sx:{width:"200px"},error:!!w,helperText:w}),e.jsx(N,{variant:"contained",onClick:E,disabled:j||r.length!==6,children:j?"Prüfe...":"Verifizieren"}),e.jsx(N,{variant:"text",onClick:()=>{A("idle"),_(""),P(null)},children:"Abbrechen"})]})]}),S==="verified"&&e.jsx(F,{severity:"success",sx:{mt:2},children:"Deine Telefonnummer wurde erfolgreich verifiziert!"}),w&&S==="idle"&&e.jsx(F,{severity:"error",sx:{mt:2},children:w})]})}),e.jsx(z,{size:{xs:12,md:6},children:e.jsxs(le,{fieldName:"language",fullWidth:!0,select:!0,label:"Sprache",value:s.language,onChange:b=>o("language",b.target.value),helperText:"Bevorzugte Sprache für die App",SelectProps:{native:!0},children:[e.jsx("option",{value:"de",children:"Deutsch"}),e.jsx("option",{value:"en",children:"English"})]})}),e.jsx(z,{size:{xs:12},children:e.jsx(le,{fieldName:"bio",fullWidth:!0,label:"Über mich",value:s.bio,onChange:b=>o("bio",b.target.value),multiline:!0,rows:4,helperText:"Erzähle anderen Nutzern etwas über dich (optional)",placeholder:"Ich verkaufe gerne gebrauchte Artikel und bin immer auf der Suche nach guten Deals..."})}),e.jsx(z,{size:{xs:12},children:e.jsxs(t,{sx:{mt:2,p:2,border:"1px solid",borderColor:"divider",borderRadius:1,bgcolor:"background.paper"},children:[e.jsxs(t,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:1},children:[e.jsx(n,{variant:"subtitle2",fontWeight:600,children:"Geburtsdaten für Inserate-Optimierung (Experimentell)"}),e.jsx(N,{variant:"outlined",size:"small",onClick:()=>v(!0),startIcon:e.jsx(Se,{size:16}),children:s.birth_date?"Bearbeiten":"Hinzufügen"})]}),e.jsx(n,{variant:"caption",color:"text.secondary",display:"block",sx:{mb:s.birth_date?1:0},children:"Optional: Diese Daten werden verwendet um deine Inserate besser auf dein Profil abzustimmen. Sie sind nicht öffentlich sichtbar."}),s.birth_date&&e.jsxs(e.Fragment,{children:[e.jsxs(t,{sx:{mt:2,display:"flex",flexWrap:"wrap",gap:2},children:[e.jsxs(t,{children:[e.jsx(n,{variant:"caption",color:"text.secondary",display:"block",children:"Geburtsdatum"}),e.jsx(n,{variant:"body2",children:new Date(s.birth_date+"T00:00:00").toLocaleDateString("de-DE",{day:"2-digit",month:"long",year:"numeric"})})]}),s.birth_time&&e.jsxs(t,{children:[e.jsx(n,{variant:"caption",color:"text.secondary",display:"block",children:"Geburtszeit"}),e.jsxs(n,{variant:"body2",children:[s.birth_time," Uhr"]})]}),s.birth_place&&e.jsxs(t,{children:[e.jsx(n,{variant:"caption",color:"text.secondary",display:"block",children:"Geburtsort"}),e.jsx(n,{variant:"body2",children:s.birth_place})]})]}),k&&e.jsxs(t,{sx:{mt:2,p:1.5,bgcolor:"action.hover",borderRadius:1,display:"flex",alignItems:"center",gap:1.5},children:[e.jsx(t,{sx:{fontSize:"2rem",lineHeight:1},children:k.symbol}),e.jsxs(t,{sx:{flex:1},children:[e.jsx(n,{variant:"body2",fontWeight:600,children:k.name}),e.jsx(n,{variant:"caption",color:"text.secondary",children:k.description})]}),e.jsx(Z,{label:k.element==="fire"?"Feuer":k.element==="earth"?"Erde":k.element==="air"?"Luft":"Wasser",size:"small",sx:{bgcolor:k.color+"20",color:k.color,fontWeight:600}})]}),T&&e.jsxs(t,{sx:{mt:1,p:1.5,bgcolor:"action.hover",borderRadius:1,display:"flex",alignItems:"center",gap:1.5},children:[e.jsx(t,{sx:{fontSize:"2rem",lineHeight:1},children:T.symbol}),e.jsxs(t,{sx:{flex:1},children:[e.jsxs(n,{variant:"body2",fontWeight:600,children:["Aszendent: ",T.name]}),e.jsx(n,{variant:"caption",color:"text.secondary",children:T.description})]}),e.jsx(Z,{label:T.element==="fire"?"Feuer":T.element==="earth"?"Erde":T.element==="air"?"Luft":"Wasser",size:"small",sx:{bgcolor:T.color+"20",color:T.color,fontWeight:600}})]})]})]})})]})]}),e.jsx(mt,{open:U,onClose:()=>Y(!1),onCapture:D}),e.jsx(Kt,{open:l,onClose:()=>v(!1),userId:d,currentData:{birth_date:s.birth_date||"",birth_time:s.birth_time||"",birth_place:s.birth_place||"",birth_timezone:s.birth_timezone||""},onSave:()=>{p(),v(!1)}})]})},Yt=({userId:i})=>{const s=ne(),o=ie(s.breakpoints.down("md")),[d,p]=x.useState(!1),[h,a]=x.useState(!0),[f,m]=x.useState(!1),[j,y]=x.useState(!1),[S,A]=x.useState(!1),[r,_]=x.useState(!1),[w,P]=x.useState(""),[g,H]=x.useState(""),[c,U]=x.useState(null),[Y,W]=x.useState(null),[B,l]=x.useState(null);x.useEffect(()=>{v()},[i]),x.useEffect(()=>{l(w?k(w):null)},[w]);const v=async()=>{try{a(!0);const{data:{user:C},error:D}=await G.auth.getUser();if(D)throw D;if(!C)return;const $=C.app_metadata.providers||[],E=$.some(fe=>fe!=="email"),be=$.includes("email");m(E),y(be&&!E)}catch(C){console.error("Error checking user auth:",C)}finally{a(!1)}},k=C=>{let D=0;return C.length>=8&&D++,C.length>=12&&D++,/[a-z]/.test(C)&&/[A-Z]/.test(C)&&D++,/\d/.test(C)&&D++,/[^a-zA-Z\d]/.test(C)&&D++,D<=2?"weak":D<=3?"medium":"strong"},T=()=>!w||w.length<8?"Passwort muss mindestens 8 Zeichen lang sein":w!==g?"Passwörter stimmen nicht überein":B==="weak"?"Passwort ist zu schwach. Verwende Groß- und Kleinbuchstaben, Zahlen und Sonderzeichen":null,J=async()=>{var D,$;W(null),U(null);const C=T();if(C){W(C);return}p(!0);try{const{error:E}=await G.auth.updateUser({password:w});if(E)throw E;U("Passwort erfolgreich gesetzt! Du kannst dich jetzt mit deiner E-Mail und diesem Passwort anmelden."),P(""),H(""),y(!0),await v()}catch(E){console.error("Error setting password:",E),(D=E.message)!=null&&D.includes("should be different from the old password")?W("Das neue Passwort muss sich vom aktuellen Passwort unterscheiden."):($=E.message)!=null&&$.includes("Password is too weak")?W("Passwort ist zu schwach. Verwende ein stärkeres Passwort."):W(E.message||"Fehler beim Setzen des Passworts")}finally{p(!1)}},u=async()=>{var D,$;W(null),U(null);const C=T();if(C){W(C);return}p(!0);try{const{error:E}=await G.auth.updateUser({password:w});if(E)throw E;U("Passwort erfolgreich geändert!"),P(""),H("")}catch(E){console.error("Error changing password:",E),(D=E.message)!=null&&D.includes("should be different from the old password")?W("Das neue Passwort muss sich vom aktuellen Passwort unterscheiden."):($=E.message)!=null&&$.includes("Password is too weak")?W("Passwort ist zu schwach. Verwende ein stärkeres Passwort."):W(E.message||"Fehler beim Ändern des Passworts")}finally{p(!1)}},R=()=>B?B==="weak"?"error":B==="medium"?"warning":"success":"default",K=()=>B?B==="weak"?"Schwach":B==="medium"?"Mittel":"Stark":"",xe=o?t:V,pe=o?{}:{sx:{p:3}};return h?e.jsx(t,{sx:{display:"flex",justifyContent:"center",py:8},children:e.jsx(te,{})}):e.jsxs(t,{children:[e.jsx(n,{variant:"h5",fontWeight:700,gutterBottom:!0,sx:{mb:1,display:{xs:"none",md:"block"}},children:"Sicherheit"}),e.jsx(n,{variant:"body2",color:"text.secondary",sx:{mb:{xs:2,md:4},display:{xs:"none",md:"block"}},children:"Verwalte deine Anmeldemethoden und Passwort-Einstellungen"}),e.jsxs(xe,{...pe,children:[e.jsxs(t,{sx:{mb:4},children:[e.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:1.5,mb:2},children:[e.jsx(Ae,{size:24,color:"#1976d2"}),e.jsx(n,{variant:"h6",fontWeight:600,children:"Anmeldemethoden"})]}),e.jsxs(t,{sx:{display:"flex",flexDirection:"column",gap:1.5},children:[f&&e.jsx(Z,{icon:e.jsx(ze,{size:16}),label:"Google OAuth",color:"success",sx:{alignSelf:"flex-start"}}),j?e.jsx(Z,{icon:e.jsx(ze,{size:16}),label:"E-Mail & Passwort",color:"success",sx:{alignSelf:"flex-start"}}):e.jsx(Z,{icon:e.jsx(Lt,{size:16}),label:"Kein Passwort gesetzt",color:"warning",sx:{alignSelf:"flex-start"}})]})]}),!j&&f&&e.jsxs(F,{severity:"info",sx:{mb:3},children:[e.jsxs(n,{variant:"body2",sx:{mb:1},children:[e.jsx("strong",{children:"Hinweis:"})," Du hast dich mit Google angemeldet und hast noch kein Passwort gesetzt."]}),e.jsx(n,{variant:"body2",children:"Setze ein Passwort, um dich alternativ auch mit E-Mail und Passwort anmelden zu können."})]}),e.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:1.5,mb:3},children:[e.jsx(ke,{size:24,color:"#1976d2"}),e.jsx(n,{variant:"h6",fontWeight:600,children:j?"Passwort ändern":"Passwort setzen"})]}),c&&e.jsx(F,{severity:"success",sx:{mb:3},onClose:()=>U(null),children:c}),Y&&e.jsx(F,{severity:"error",sx:{mb:3},onClose:()=>W(null),children:Y}),e.jsxs(t,{sx:{display:"flex",flexDirection:"column",gap:3},children:[e.jsx(I,{fullWidth:!0,label:"Neues Passwort",type:S?"text":"password",value:w,onChange:C=>P(C.target.value),placeholder:"Mindestens 8 Zeichen",InputProps:{endAdornment:e.jsx(ge,{position:"end",children:e.jsx(he,{onClick:()=>A(!S),edge:"end",children:S?e.jsx(Ee,{size:20}):e.jsx(we,{size:20})})})},helperText:B&&e.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:.5,mt:.5},children:[e.jsx(n,{variant:"caption",color:"text.secondary",children:"Passwortstärke:"}),e.jsx(Z,{label:K(),color:R(),size:"small",sx:{height:18,fontSize:"0.7rem"}})]})}),e.jsx(I,{fullWidth:!0,label:"Passwort bestätigen",type:r?"text":"password",value:g,onChange:C=>H(C.target.value),placeholder:"Passwort wiederholen",InputProps:{endAdornment:e.jsx(ge,{position:"end",children:e.jsx(he,{onClick:()=>_(!r),edge:"end",children:r?e.jsx(Ee,{size:20}):e.jsx(we,{size:20})})})},error:g.length>0&&w!==g,helperText:g.length>0&&w!==g?"Passwörter stimmen nicht überein":""}),e.jsxs(t,{children:[e.jsx(N,{variant:"contained",onClick:j?u:J,disabled:d||!w||!g||w!==g,startIcon:d?e.jsx(te,{size:18}):e.jsx(ke,{size:18}),sx:{mr:2},children:d?"Wird gespeichert...":j?"Passwort ändern":"Passwort setzen"}),(w||g)&&e.jsx(N,{variant:"text",onClick:()=>{P(""),H(""),W(null),U(null)},children:"Abbrechen"})]}),e.jsxs(F,{severity:"info",sx:{mt:2},children:[e.jsx(n,{variant:"body2",fontWeight:600,sx:{mb:1},children:"Passwort-Anforderungen:"}),e.jsxs(t,{component:"ul",sx:{m:0,pl:2},children:[e.jsx(n,{component:"li",variant:"body2",children:"Mindestens 8 Zeichen"}),e.jsx(n,{component:"li",variant:"body2",children:"Groß- und Kleinbuchstaben"}),e.jsx(n,{component:"li",variant:"body2",children:"Mindestens eine Zahl"}),e.jsx(n,{component:"li",variant:"body2",children:"Empfohlen: Sonderzeichen (!@#$%^&*)"})]})]})]})]})]})},Jt=({formData:i,onFormChange:s})=>{const o=ne(),d=ie(o.breakpoints.down("md")),p=d?t:V,h=d?{}:{sx:{p:3}};return e.jsxs(t,{children:[e.jsx(n,{variant:"h5",fontWeight:700,gutterBottom:!0,sx:{mb:1,display:{xs:"none",md:"block"}},children:"KI-Assistent"}),e.jsx(n,{variant:"body2",color:"text.secondary",sx:{mb:4,display:{xs:"none",md:"block"}},children:"Passe an, wie die KI deine Inseratentexte erstellen soll"}),e.jsxs(p,{...h,children:[e.jsx(n,{variant:"h6",fontWeight:600,gutterBottom:!0,sx:{mb:2},children:"Textgenerierung"}),e.jsxs(t,{sx:{display:"flex",flexDirection:"column",gap:2,mb:3},children:[e.jsxs(I,{fullWidth:!0,select:!0,label:"Schreibstil",value:i.ai_text_style,onChange:a=>s("ai_text_style",a.target.value),helperText:"Der Ton und die Art der generierten Texte",children:[e.jsx(q,{value:"formal",children:"Förmlich - Professionell und sachlich"}),e.jsx(q,{value:"casual",children:"Locker - Freundlich und ungezwungen"}),e.jsx(q,{value:"detailed",children:"Detailreich - Ausführlich und informativ"}),e.jsx(q,{value:"concise",children:"Prägnant - Kurz und auf den Punkt"}),e.jsx(q,{value:"balanced",children:"Ausgewogen - Gute Balance (empfohlen)"})]}),e.jsxs(I,{fullWidth:!0,select:!0,label:"Textlänge",value:i.ai_text_length,onChange:a=>s("ai_text_length",a.target.value),helperText:"Bevorzugte Länge der Beschreibungen",children:[e.jsx(q,{value:"short",children:"Kurz - Ca. 2-3 Sätze"}),e.jsx(q,{value:"medium",children:"Mittel - Ca. 4-6 Sätze (empfohlen)"}),e.jsx(q,{value:"long",children:"Lang - Ca. 7-10 Sätze"})]})]}),e.jsx(ce,{sx:{my:3}}),e.jsx(n,{variant:"h6",fontWeight:600,gutterBottom:!0,sx:{mb:2},children:"Erweiterte Optionen"}),e.jsxs(t,{sx:{display:"flex",flexDirection:"column",gap:1.5},children:[e.jsx(M,{control:e.jsx(O,{checked:i.ai_include_emoji,onChange:a=>s("ai_include_emoji",a.target.checked)}),label:e.jsxs(t,{children:[e.jsx(n,{variant:"body2",fontWeight:600,children:"Emojis verwenden"}),e.jsx(n,{variant:"caption",color:"text.secondary",children:"Die KI fügt passende Emojis in die Beschreibungen ein"})]}),sx:{alignItems:"flex-start",m:0}}),e.jsx(t,{sx:{height:1,bgcolor:"divider",my:.5}}),e.jsx(M,{control:e.jsx(O,{checked:i.ai_allow_line_breaks,onChange:a=>s("ai_allow_line_breaks",a.target.checked)}),label:e.jsxs(t,{children:[e.jsx(n,{variant:"body2",fontWeight:600,children:"Zeilenumbrüche erlauben"}),e.jsx(n,{variant:"caption",color:"text.secondary",children:"Die KI strukturiert Texte mit Absätzen für bessere Lesbarkeit"})]}),sx:{alignItems:"flex-start",m:0}}),e.jsx(t,{sx:{height:1,bgcolor:"divider",my:.5}}),e.jsx(M,{control:e.jsx(O,{checked:i.ai_auto_publish,onChange:a=>s("ai_auto_publish",a.target.checked)}),label:e.jsxs(t,{children:[e.jsx(n,{variant:"body2",fontWeight:600,children:"Automatisch veröffentlichen"}),e.jsx(n,{variant:"caption",color:"text.secondary",children:"Inserate werden direkt nach der KI-Generierung veröffentlicht"})]}),sx:{alignItems:"flex-start",m:0}}),e.jsx(t,{sx:{height:1,bgcolor:"divider",my:.5}}),e.jsx(M,{control:e.jsx(O,{checked:i.ai_analyze_all_images,onChange:a=>s("ai_analyze_all_images",a.target.checked)}),label:e.jsxs(t,{children:[e.jsx(n,{variant:"body2",fontWeight:600,children:"Alle Bilder analysieren"}),e.jsx(n,{variant:"caption",color:"text.secondary",children:"Bei mehreren Bildern werden alle analysiert (teurer, aber detaillierter)"})]}),sx:{alignItems:"flex-start",m:0}})]})]})]})},Qt=({formData:i,onFormChange:s})=>{const o=ne(),d=ie(o.breakpoints.down("md")),p=d?t:V,h=d?{}:{sx:{p:3}};return e.jsxs(t,{children:[e.jsx(n,{variant:"h5",fontWeight:700,gutterBottom:!0,sx:{mb:1,display:{xs:"none",md:"block"}},children:"Benachrichtigungen"}),e.jsx(n,{variant:"body2",color:"text.secondary",sx:{mb:4,display:{xs:"none",md:"block"}},children:"Wähle aus, wie du über Neuigkeiten informiert werden möchtest"}),e.jsx(p,{...h,children:e.jsxs(t,{sx:{display:"flex",flexDirection:"column",gap:1.5},children:[e.jsx(M,{control:e.jsx(O,{checked:i.notifications_enabled,onChange:a=>s("notifications_enabled",a.target.checked)}),label:e.jsxs(t,{children:[e.jsx(n,{variant:"body2",fontWeight:600,children:"Push-Benachrichtigungen"}),e.jsx(n,{variant:"caption",color:"text.secondary",children:"Erhalte Benachrichtigungen über neue Nachrichten und Aktivitäten"})]}),sx:{alignItems:"flex-start",m:0}}),e.jsx(t,{sx:{height:1,bgcolor:"divider",my:.5}}),e.jsx(M,{control:e.jsx(O,{checked:i.email_notifications,onChange:a=>s("email_notifications",a.target.checked)}),label:e.jsxs(t,{children:[e.jsx(n,{variant:"body2",fontWeight:600,children:"E-Mail-Benachrichtigungen"}),e.jsx(n,{variant:"caption",color:"text.secondary",children:"Erhalte wichtige Updates und Neuigkeiten per E-Mail"})]}),sx:{alignItems:"flex-start",m:0}}),e.jsx(t,{sx:{height:1,bgcolor:"divider",my:.5}}),e.jsx(M,{control:e.jsx(O,{checked:i.newsletter_subscribed,onChange:a=>s("newsletter_subscribed",a.target.checked)}),label:e.jsxs(t,{children:[e.jsx(n,{variant:"body2",fontWeight:600,children:"Newsletter abonnieren"}),e.jsx(n,{variant:"caption",color:"text.secondary",children:"Erhalte regelmäßig Angebote, Tipps und Neuigkeiten per E-Mail"})]}),sx:{alignItems:"flex-start",m:0}})]})})]})},Xt=({userId:i})=>{const s=ne(),o=ie(s.breakpoints.down("md")),[d,p]=x.useState([]),[h,a]=x.useState(!0),[f,m]=x.useState(!1),[j,y]=x.useState(null),[S,A]=x.useState(!1),[r,_]=x.useState({name:"",address:"",postal_code:"",city:"",country:"AT",phone:"",show_phone_publicly:!1,is_default:!1,address_type:"both",is_default_shipping:!1}),[w,P]=x.useState([]),[g,H]=x.useState(!1);x.useEffect(()=>{const v=setTimeout(async()=>{if(r.postal_code.length>=4){H(!0);try{const T=(await Rt(r.postal_code,r.country)).map(J=>J.city);console.log("AddressesSection: Found cities for",r.postal_code,r.country,":",T),P(T),T.length===1&&!r.city&&_(J=>({...J,city:T[0]}))}catch(k){console.error("Error fetching cities:",k)}finally{H(!1)}}else P([])},500);return()=>clearTimeout(v)},[r.postal_code,r.country]);const c=async()=>{a(!0);try{const{data:l,error:v}=await G.from("addresses").select("*").eq("user_id",i).order("is_default",{ascending:!1}).order("created_at",{ascending:!1});if(v)throw v;p(l||[])}catch(l){console.error("Error loading addresses:",l)}finally{a(!1)}};x.useEffect(()=>{c()},[i]);const U=()=>{y(null),_({name:"",address:"",postal_code:"",city:"",country:"AT",phone:"",show_phone_publicly:!1,is_default:!1,address_type:"both",is_default_shipping:!1}),m(!0)},Y=l=>{y(l),_({name:l.name||"",address:l.address,postal_code:l.postal_code,city:l.city,country:l.country,phone:l.phone||"",show_phone_publicly:l.show_phone_publicly||!1,is_default:l.is_default,address_type:l.address_type||"both",is_default_shipping:l.is_default_shipping||!1}),m(!0)},W=async()=>{var l,v;if(!(!r.address.trim()||!r.postal_code.trim()||!r.city.trim())){A(!0);try{if(j){const{error:k}=await G.from("addresses").update({name:r.name.trim()||"Meine Adresse",address:r.address.trim(),postal_code:r.postal_code.trim(),city:r.city.trim(),country:r.country,phone:((l=r.phone)==null?void 0:l.trim())||null,show_phone_publicly:r.show_phone_publicly,is_default:r.is_default,address_type:r.address_type,is_default_shipping:r.is_default_shipping}).eq("id",j.id);if(k)throw k}else{const{error:k}=await G.from("addresses").insert({user_id:i,name:r.name.trim()||"Meine Adresse",address:r.address.trim(),postal_code:r.postal_code.trim(),city:r.city.trim(),country:r.country,phone:((v=r.phone)==null?void 0:v.trim())||null,show_phone_publicly:r.show_phone_publicly,is_default:r.is_default,address_type:r.address_type,is_default_shipping:r.is_default_shipping});if(k)throw k}await c(),m(!1)}catch(k){console.error("Error saving address:",k)}finally{A(!1)}}},B=async l=>{if(window.confirm("Möchtest du diese Adresse wirklich löschen?"))try{const{error:v}=await G.from("addresses").delete().eq("id",l);if(v)throw v;await c()}catch(v){console.error("Error deleting address:",v)}};return h?e.jsx(t,{sx:{display:"flex",justifyContent:"center",py:8},children:e.jsx(te,{})}):e.jsxs(t,{children:[e.jsxs(t,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:4},children:[e.jsxs(t,{sx:{display:{xs:"none",md:"block"}},children:[e.jsx(n,{variant:"h5",fontWeight:700,gutterBottom:!0,sx:{mb:1},children:"Adressen"}),e.jsx(n,{variant:"body2",color:"text.secondary",children:"Verwalte deine Adressen für Abholung und Versand"})]}),e.jsx(N,{variant:"contained",startIcon:e.jsx(Vt,{size:20}),onClick:U,sx:{ml:{xs:"auto",md:"auto"},mr:{xs:"auto",md:0}},children:d.length===0?"Adresse hinzufügen":o?"+ Adresse":"Neue Adresse"})]}),d.length===0?e.jsxs(V,{sx:{p:{xs:3,md:6},textAlign:"center"},children:[e.jsx(ue,{size:48,style:{margin:"0 auto 16px",color:"#999"}}),e.jsx(n,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"Keine Adressen vorhanden"}),e.jsx(n,{variant:"body2",color:"text.secondary",children:"Füge deine erste Adresse über den Button oben hinzu"})]}):e.jsx(z,{container:!0,spacing:2,children:d.map(l=>{var v;return e.jsx(z,{size:{xs:12,md:6},children:e.jsx(gt,{sx:{height:"100%",border:l.is_default?2:1,borderColor:l.is_default?"primary.main":"divider"},children:e.jsxs(bt,{children:[e.jsxs(t,{sx:{display:"flex",justifyContent:"space-between",alignItems:"start",mb:2},children:[e.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(ft,{size:20,color:l.is_default?"#1976d2":"#666"}),e.jsx(n,{variant:"h6",fontWeight:600,children:l.name||"Unbenannte Adresse"})]}),l.is_default&&e.jsx(n,{variant:"caption",sx:{bgcolor:"primary.main",color:"white",px:1.5,py:.5,borderRadius:1,fontWeight:600},children:"Standard"})]}),e.jsx(n,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:l.address}),e.jsxs(n,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:[l.postal_code," ",l.city]}),e.jsx(n,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:((v=Me.find(k=>k.code===l.country))==null?void 0:v.name)||l.country}),l.phone&&e.jsxs(n,{variant:"body2",color:"text.secondary",children:["Tel: ",l.phone]}),e.jsxs(t,{sx:{mt:2,display:"flex",gap:1,flexWrap:"wrap"},children:[(l.address_type==="both"||l.address_type==="pickup_only")&&e.jsx(t,{sx:{display:"flex",alignItems:"center",px:1.5,py:.75,bgcolor:"rgba(25, 118, 210, 0.08)",borderRadius:1.5,border:"1px solid",borderColor:"primary.main"},children:e.jsx(n,{variant:"caption",color:"primary.main",fontWeight:600,sx:{fontSize:"0.75rem",lineHeight:1},children:"Abholung"})}),(l.address_type==="both"||l.address_type==="shipping_only")&&e.jsx(t,{sx:{display:"flex",alignItems:"center",px:1.5,py:.75,bgcolor:"rgba(46, 125, 50, 0.08)",borderRadius:1.5,border:"1px solid",borderColor:"success.main"},children:e.jsx(n,{variant:"caption",color:"success.main",fontWeight:600,sx:{fontSize:"0.75rem",lineHeight:1},children:"Versand"})}),l.is_default_shipping&&e.jsx(t,{sx:{display:"flex",alignItems:"center",px:1.5,py:.75,bgcolor:"rgba(237, 108, 2, 0.08)",borderRadius:1.5,border:"1px solid",borderColor:"warning.main"},children:e.jsx(n,{variant:"caption",color:"warning.main",fontWeight:600,sx:{fontSize:"0.75rem",lineHeight:1},children:"Standard-Versand"})})]}),e.jsxs(t,{sx:{display:"flex",gap:1,mt:3},children:[e.jsx(N,{variant:"outlined",size:"medium",onClick:()=>Y(l),fullWidth:!0,sx:{fontWeight:600,textTransform:"none",borderWidth:1.5,"&:hover":{borderWidth:1.5}},children:"Bearbeiten"}),e.jsx(N,{variant:"outlined",color:"error",size:"medium",onClick:()=>B(l.id),sx:{minWidth:48,px:1.5,fontWeight:600,borderWidth:1.5,"&:hover":{borderWidth:1.5}},children:e.jsx(jt,{size:18,strokeWidth:2})})]})]})})},l.id)})}),e.jsx(Mt,{open:f,onClose:()=>m(!1),title:j?"Adresse bearbeiten":"Neue Adresse hinzufügen",maxWidth:"md",fullScreen:o,children:e.jsxs(z,{container:!0,spacing:3,children:[e.jsx(z,{size:{xs:12},children:e.jsx(I,{fullWidth:!0,label:"Name (optional)",value:r.name,onChange:l=>_({...r,name:l.target.value}),placeholder:"z.B. Zuhause, Arbeit"})}),e.jsx(z,{size:{xs:12},children:e.jsx(I,{fullWidth:!0,required:!0,label:"Straße und Hausnummer",value:r.address,onChange:l=>_({...r,address:l.target.value})})}),e.jsx(z,{size:{xs:12,sm:4},children:e.jsx(I,{fullWidth:!0,label:"PLZ",required:!0,value:r.postal_code,onChange:l=>_({...r,postal_code:l.target.value}),helperText:g?"Suche Orte...":w.length>0?`${w.length} Ort(e) gefunden`:""})}),e.jsx(z,{size:{xs:12,sm:8},children:e.jsx(_t,{fullWidth:!0,freeSolo:!0,loading:g,options:w,value:r.city,onInputChange:(l,v)=>{_({...r,city:v||""})},renderInput:l=>e.jsx(I,{...l,label:"Ort",required:!0})})}),e.jsx(z,{size:{xs:12,sm:6},children:e.jsx(I,{fullWidth:!0,select:!0,label:"Land",value:r.country,onChange:l=>_({...r,country:l.target.value}),SelectProps:{native:!0},children:Me.map(l=>e.jsx("option",{value:l.code,children:l.name},l.code))})}),e.jsx(z,{size:{xs:12,sm:6},children:e.jsx(I,{fullWidth:!0,label:"Telefon (optional)",value:r.phone,onChange:l=>_({...r,phone:l.target.value}),helperText:"Wird für Artikeldetails verwendet, falls freigegeben"})}),r.phone&&e.jsx(z,{size:{xs:12},children:e.jsx(M,{control:e.jsx(O,{checked:r.show_phone_publicly,onChange:l=>_({...r,show_phone_publicly:l.target.checked})}),label:e.jsxs(t,{children:[e.jsx(n,{variant:"body2",children:"Telefonnummer öffentlich anzeigen"}),e.jsx(n,{variant:"caption",color:"text.secondary",children:"Wenn aktiviert, wird deine Telefonnummer bei Artikeln mit dieser Adresse angezeigt"})]})})}),e.jsx(z,{size:{xs:12},children:e.jsxs(I,{fullWidth:!0,select:!0,label:"Adresstyp",value:r.address_type,onChange:l=>_({...r,address_type:l.target.value}),helperText:"Wähle aus, wofür diese Adresse verwendet werden soll",children:[e.jsx(q,{value:"both",children:"Abholung & Versand"}),e.jsx(q,{value:"pickup_only",children:"Nur Abholung"}),e.jsx(q,{value:"shipping_only",children:"Nur Versand"})]})}),e.jsx(z,{size:{xs:12},children:e.jsxs(t,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsx(M,{control:e.jsx(O,{checked:r.is_default,onChange:l=>_({...r,is_default:l.target.checked})}),label:"Als Standard-Adresse für Abholung festlegen"}),(r.address_type==="both"||r.address_type==="shipping_only")&&e.jsx(M,{control:e.jsx(O,{checked:r.is_default_shipping,onChange:l=>_({...r,is_default_shipping:l.target.checked})}),label:"Als Standard-Versandadresse festlegen"})]})}),e.jsx(z,{size:{xs:12},children:e.jsxs(t,{sx:{display:"flex",gap:2,justifyContent:"flex-end",pt:3,mt:2,borderTop:1,borderColor:"divider"},children:[e.jsx(N,{onClick:()=>m(!1),size:"large",sx:{minWidth:120},children:"ABBRECHEN"}),e.jsx(N,{variant:"contained",onClick:W,disabled:S||!r.address||!r.postal_code||!r.city,size:"large",sx:{minWidth:120},children:S?e.jsx(te,{size:24}):"SPEICHERN"})]})})]})})]})},en=({formData:i,onFormChange:s})=>{const o=ne(),d=ie(o.breakpoints.down("md")),p=d?t:V,h=d?{}:{sx:{p:3,mb:3}};return e.jsxs(t,{children:[e.jsx(n,{variant:"h5",fontWeight:700,gutterBottom:!0,sx:{mb:1,display:{xs:"none",md:"block"}},children:"Versand & Abholung"}),e.jsx(n,{variant:"body2",color:"text.secondary",sx:{mb:4,display:{xs:"none",md:"block"}},children:"Lege fest, wie Käufer deine Artikel erhalten können"}),e.jsx(F,{severity:"info",sx:{mb:3},children:"Diese Einstellungen gelten als Standard für alle deine Artikel."}),e.jsxs(p,{...h,children:[e.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:1.5,mb:3},children:[e.jsx(qe,{size:20,color:"#1976d2"}),e.jsx(n,{variant:"h6",fontWeight:600,children:"Versandoptionen"})]}),e.jsx(M,{control:e.jsx(O,{checked:i.shipping_enabled,onChange:a=>s("shipping_enabled",a.target.checked)}),label:e.jsxs(t,{children:[e.jsx(n,{variant:"body2",fontWeight:600,children:"Versand anbieten"}),e.jsx(n,{variant:"caption",color:"text.secondary",children:"Biete Versand für deine Artikel an"})]}),sx:{alignItems:"flex-start",m:0,mb:3}}),i.shipping_enabled&&e.jsxs(t,{sx:{pl:{xs:0,sm:2},display:"flex",flexDirection:"column",gap:2.5},children:[e.jsxs(yt,{component:"fieldset",children:[e.jsx(vt,{component:"legend",sx:{mb:1.5,fontWeight:600,fontSize:"0.875rem"},children:"Versandkostenberechnung"}),e.jsxs(Ze,{value:i.shipping_cost_type,onChange:a=>s("shipping_cost_type",a.target.value),children:[e.jsx(M,{value:"free",control:e.jsx(de,{size:"small"}),label:"Kostenloser Versand",sx:{mb:1}}),e.jsx(M,{value:"fixed",control:e.jsx(de,{size:"small"}),label:"Feste Versandkosten",sx:{mb:1}}),e.jsx(M,{value:"ai_calculated",control:e.jsx(de,{size:"small"}),label:"KI-berechnet (automatisch)"})]})]}),i.shipping_cost_type==="fixed"&&e.jsx(I,{label:"Versandkosten",type:"number",size:"small",value:i.shipping_cost,onChange:a=>s("shipping_cost",parseFloat(a.target.value)||0),InputProps:{endAdornment:e.jsx(ge,{position:"end",children:"€"}),inputProps:{min:0,step:.5}},helperText:"Standard-Versandkosten pro Artikel",sx:{maxWidth:280}}),e.jsx(I,{fullWidth:!0,multiline:!0,rows:2,size:"small",label:"Versandbeschreibung (optional)",placeholder:"z.B. Versand mit DHL, Lieferzeit 2-3 Werktage",value:i.shipping_description||"",onChange:a=>s("shipping_description",a.target.value||null),helperText:"Zusätzliche Informationen zum Versand"})]})]}),e.jsxs(p,{...h,children:[e.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:1.5,mb:3},children:[e.jsx(ue,{size:20,color:"#1976d2"}),e.jsx(n,{variant:"h6",fontWeight:600,children:"Abholoptionen"})]}),e.jsx(M,{control:e.jsx(O,{checked:i.pickup_enabled,onChange:a=>s("pickup_enabled",a.target.checked)}),label:e.jsxs(t,{children:[e.jsx(n,{variant:"body2",fontWeight:600,children:"Abholung ermöglichen"}),e.jsx(n,{variant:"caption",color:"text.secondary",children:"Käufer können Artikel bei dir abholen"})]}),sx:{alignItems:"flex-start",m:0,mb:3}}),i.pickup_enabled&&e.jsxs(t,{sx:{pl:{xs:0,sm:2},display:"flex",flexDirection:"column",gap:2.5},children:[e.jsx(M,{control:e.jsx(O,{size:"small",checked:i.show_location_publicly,onChange:a=>s("show_location_publicly",a.target.checked)}),label:e.jsxs(t,{children:[e.jsx(n,{variant:"body2",fontWeight:500,children:"Standort öffentlich anzeigen"}),e.jsx(n,{variant:"caption",color:"text.secondary",sx:{display:"block",mt:.5},children:i.show_location_publicly?"Vollständige Adresse wird angezeigt":"Nur PLZ und Ort sichtbar"})]}),sx:{alignItems:"flex-start",m:0}}),e.jsx(I,{fullWidth:!0,multiline:!0,rows:2,size:"small",label:"Abholbeschreibung (optional)",placeholder:"z.B. Abholung nach Vereinbarung, Parkplätze vorhanden",value:i.location_description||"",onChange:a=>s("location_description",a.target.value||null),helperText:"Zusätzliche Informationen zur Abholung"})]})]})]})},tn=({formData:i,onFormChange:s})=>{const o=ne(),d=ie(o.breakpoints.down("md")),p=d?t:V,h=d?{}:{sx:{p:3}};return e.jsxs(t,{children:[e.jsx(n,{variant:"h5",fontWeight:700,gutterBottom:!0,sx:{mb:1,display:{xs:"none",md:"block"}},children:"Anzeige-Einstellungen"}),e.jsx(n,{variant:"body2",color:"text.secondary",sx:{mb:4,display:{xs:"none",md:"block"}},children:"Passe die Darstellung der Anwendung an deine Bedürfnisse an"}),e.jsx(p,{...h,children:e.jsxs(t,{sx:{display:"flex",flexDirection:"column",gap:3},children:[e.jsxs(t,{children:[e.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:1.5,mb:1.5},children:[e.jsx(Ue,{size:20,color:"#1976d2"}),e.jsx(n,{variant:"h6",fontWeight:600,children:"Sprache"})]}),e.jsx(n,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Wähle die Sprache der Benutzeroberfläche"}),e.jsxs(I,{fullWidth:!0,select:!0,value:i.language,onChange:a=>s("language",a.target.value),SelectProps:{native:!0},children:[e.jsx("option",{value:"de",children:"Deutsch"}),e.jsx("option",{value:"en",children:"English"})]})]}),e.jsx(ce,{sx:{my:2}}),e.jsxs(t,{children:[e.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:1.5,mb:1.5},children:[e.jsx(ue,{size:20,color:"#1976d2"}),e.jsx(n,{variant:"h6",fontWeight:600,children:"Standort-Sichtbarkeit"})]}),e.jsx(n,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Steuere, wer deinen Standort (Ort & Land) bei deinen Artikeln sehen kann"}),e.jsx(V,{elevation:0,sx:{p:2,border:1,borderColor:"divider",borderRadius:1,bgcolor:"grey.50"},children:e.jsx(M,{control:e.jsx(O,{checked:i.show_location_to_public,onChange:a=>s("show_location_to_public",a.target.checked)}),label:e.jsxs(t,{children:[e.jsx(n,{variant:"body2",fontWeight:500,children:"Standort für Besucher sichtbar"}),e.jsx(n,{variant:"caption",color:"text.secondary",children:i.show_location_to_public?"Ort und Land sind für alle sichtbar (auch nicht angemeldete Besucher)":"Ort und Land sind nur für angemeldete Nutzer sichtbar"})]}),sx:{alignItems:"flex-start",m:0}})}),e.jsx(n,{variant:"caption",color:"text.secondary",sx:{display:"block",mt:1.5,fontStyle:"italic"},children:"ℹ️ Vollständige Adressen sind nur für angemeldete Nutzer sichtbar, wenn du dies in den Abholoptionen aktiviert hast."})]}),e.jsx(ce,{sx:{my:2}}),e.jsxs(t,{children:[e.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:1.5,mb:1.5},children:[e.jsx(Gt,{size:20,color:"#1976d2"}),e.jsx(n,{variant:"h6",fontWeight:600,children:"Händigkeit"})]}),e.jsx(n,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Optimiere die Button-Position für deine bevorzugte Hand bei der Ein-Hand-Bedienung"}),e.jsx(Ze,{value:i.hand_preference,onChange:a=>s("hand_preference",a.target.value),children:e.jsxs(t,{sx:{display:"flex",flexDirection:"column",gap:1.5},children:[e.jsx(V,{elevation:0,sx:{p:2,border:1,borderColor:i.hand_preference==="right"?"primary.main":"divider",borderRadius:1,cursor:"pointer","&:hover":{borderColor:"primary.main"}},onClick:()=>s("hand_preference","right"),children:e.jsx(M,{value:"right",control:e.jsx(de,{checked:i.hand_preference==="right"}),label:e.jsx(t,{sx:{display:"flex",alignItems:"center",gap:1.5},children:e.jsxs(t,{children:[e.jsx(n,{variant:"body2",fontWeight:600,children:"Rechtshänder"}),e.jsx(n,{variant:"caption",color:"text.secondary",children:"Navigation links, Aktionen rechts"})]})}),sx:{m:0,width:"100%"}})}),e.jsx(V,{elevation:0,sx:{p:2,border:1,borderColor:i.hand_preference==="left"?"primary.main":"divider",borderRadius:1,cursor:"pointer","&:hover":{borderColor:"primary.main"}},onClick:()=>s("hand_preference","left"),children:e.jsx(M,{value:"left",control:e.jsx(de,{checked:i.hand_preference==="left"}),label:e.jsx(t,{sx:{display:"flex",alignItems:"center",gap:1.5},children:e.jsxs(t,{children:[e.jsx(n,{variant:"body2",fontWeight:600,children:"Linkshänder"}),e.jsx(n,{variant:"caption",color:"text.secondary",children:"Navigation rechts, Aktionen links"})]})}),sx:{m:0,width:"100%"}})})]})})]}),e.jsx(ce,{sx:{my:2}}),e.jsxs(t,{children:[e.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:1.5,mb:1.5},children:[e.jsx(Bt,{size:20,color:"#1976d2"}),e.jsx(n,{variant:"h6",fontWeight:600,children:"Verkäuferprofil-Sichtbarkeit"})]}),e.jsx(n,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Zeige dein Profil in deinen Inseraten an, um Vertrauen aufzubauen"}),e.jsx(V,{elevation:0,sx:{p:2,border:1,borderColor:"divider",borderRadius:1,bgcolor:"grey.50"},children:e.jsx(M,{control:e.jsx(O,{checked:i.show_seller_profile,onChange:a=>s("show_seller_profile",a.target.checked)}),label:e.jsxs(t,{children:[e.jsx(n,{variant:"body2",fontWeight:500,children:"Verkäuferprofil in Inseraten anzeigen"}),e.jsx(n,{variant:"caption",color:"text.secondary",children:i.show_seller_profile?"Dein Name, Avatar und andere Inserate werden in deinen Artikeln angezeigt":'Nur "Privater Verkäufer" wird angezeigt, keine persönlichen Infos'})]}),sx:{alignItems:"flex-start",m:0}})}),!i.show_seller_profile&&e.jsx(V,{elevation:0,sx:{p:2,mt:2,border:1,borderColor:"warning.main",borderRadius:1,bgcolor:"warning.50"},children:e.jsxs(t,{sx:{display:"flex",gap:1.5,alignItems:"flex-start"},children:[e.jsx(Nt,{size:18,color:"#ed6c02",style:{flexShrink:0,marginTop:2}}),e.jsxs(t,{children:[e.jsx(n,{variant:"body2",fontWeight:600,color:"warning.dark",sx:{mb:.5},children:"Hinweis zur Sichtbarkeit"}),e.jsx(n,{variant:"caption",color:"text.secondary",children:"Inserate mit sichtbarem Verkäuferprofil wirken seriöser und erhalten durchschnittlich 40% mehr Anfragen. Dein Name und Avatar helfen Interessenten, Vertrauen aufzubauen."})]})]})}),e.jsx(n,{variant:"caption",color:"text.secondary",sx:{display:"block",mt:1.5,fontStyle:"italic"},children:"ℹ️ Du kannst dein Profilbild und deinen Namen jederzeit in den persönlichen Daten ändern."})]}),e.jsx(ce,{sx:{my:2}}),e.jsxs(t,{children:[e.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:1.5,mb:1.5},children:[e.jsx(He,{size:20,color:"#1976d2"}),e.jsx(n,{variant:"h6",fontWeight:600,children:"Standard-Schaltdauer"})]}),e.jsx(n,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Lege fest, wie lange deine Inserate standardmäßig online bleiben. Diese Dauer wird bei jedem neuen Inserat verwendet."}),e.jsx(I,{fullWidth:!0,type:"number",value:i.default_listing_duration,onChange:a=>{const f=parseInt(a.target.value);f>=10&&f<=30&&s("default_listing_duration",f)},inputProps:{min:10,max:30,step:1},helperText:"Zwischen 10 und 30 Tagen",InputProps:{endAdornment:e.jsx(ge,{position:"end",children:e.jsx(n,{variant:"body2",color:"text.secondary",children:"Tage"})})}}),e.jsx(V,{elevation:0,sx:{p:2,mt:2,border:1,borderColor:"divider",borderRadius:1,bgcolor:"grey.50"},children:e.jsx(n,{variant:"caption",color:"text.secondary",children:'📅 Deine Inserate werden nach Ablauf dieser Dauer automatisch als "abgelaufen" markiert und sind nicht mehr öffentlich sichtbar. Du kannst sie jederzeit wieder aktivieren.'})})]})]})})]})},nn=()=>{const i=Ge(),{user:s}=Fe(),{personalCredits:o,communityPotBalance:d,loading:p}=wt();return e.jsxs(t,{children:[e.jsx(n,{variant:"h6",gutterBottom:!0,sx:{fontWeight:700,mb:3,display:{xs:"none",md:"block"}},children:"Mein Guthaben"}),e.jsxs(t,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",md:"repeat(2, 1fr)"},gap:{xs:2,md:3},mb:{xs:3,md:4}},children:[e.jsxs(V,{elevation:0,sx:{p:{xs:2,sm:2.5,md:3},borderRadius:{xs:2,md:3},bgcolor:"#f8f9fa",border:"1px solid #e8eaed",position:"relative",overflow:"hidden",transition:"all 0.2s ease","&:hover":{boxShadow:"0 1px 3px 0 rgba(60, 64, 67, 0.3), 0 4px 8px 3px rgba(60, 64, 67, 0.15)",transform:"translateY(-2px)"}},children:[e.jsxs(t,{sx:{display:"flex",alignItems:"flex-start",gap:{xs:1.5,md:2},mb:{xs:2,md:2.5}},children:[e.jsx(t,{sx:{width:{xs:40,md:48},height:{xs:40,md:48},borderRadius:2,bgcolor:"#e8f0fe",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:e.jsx(Oe,{size:24,color:"#1a73e8"})}),e.jsxs(t,{sx:{flex:1,minWidth:0},children:[e.jsx(n,{variant:"body2",color:"text.secondary",sx:{fontSize:{xs:"0.75rem",md:"0.875rem"},mb:.25,fontWeight:500},children:"Personal Inserate"}),e.jsx(n,{variant:"h3",sx:{fontWeight:600,color:"#202124",fontSize:{xs:"1.75rem",sm:"2rem",md:"2.5rem"},lineHeight:1.2},children:p?e.jsx(te,{size:28}):Re(o)})]})]}),e.jsxs(N,{fullWidth:!0,variant:"contained",startIcon:e.jsx(zt,{size:16}),onClick:()=>i("/tokens"),sx:{textTransform:"none",fontWeight:600,py:{xs:1,md:1.25},bgcolor:"#1a73e8",color:"white",borderRadius:2,boxShadow:"none",fontSize:{xs:"0.875rem",md:"1rem"},"&:hover":{bgcolor:"#1557b0",boxShadow:"0 1px 2px 0 rgba(60, 64, 67, 0.3), 0 1px 3px 1px rgba(60, 64, 67, 0.15)"}},children:[e.jsx(t,{component:"span",sx:{display:{xs:"none",sm:"inline"}},children:"Inserate kaufen"}),e.jsx(t,{component:"span",sx:{display:{xs:"inline",sm:"none"}},children:"Kaufen"})]})]}),e.jsxs(V,{elevation:0,sx:{p:{xs:2,sm:2.5,md:3},borderRadius:{xs:2,md:3},bgcolor:"#fef7ff",border:"1px solid #f3e8fd",position:"relative",overflow:"hidden",transition:"all 0.2s ease","&:hover":{boxShadow:"0 1px 3px 0 rgba(60, 64, 67, 0.3), 0 4px 8px 3px rgba(60, 64, 67, 0.15)",transform:"translateY(-2px)"}},children:[e.jsxs(t,{sx:{display:"flex",alignItems:"flex-start",gap:{xs:1.5,md:2},mb:{xs:2,md:2.5}},children:[e.jsx(t,{sx:{width:{xs:40,md:48},height:{xs:40,md:48},borderRadius:2,bgcolor:"#fce8f3",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:e.jsx(Be,{size:24,color:"#c51162",fill:"#c51162"})}),e.jsxs(t,{sx:{flex:1,minWidth:0},children:[e.jsx(n,{variant:"body2",color:"text.secondary",sx:{fontSize:{xs:"0.75rem",md:"0.875rem"},mb:.25,fontWeight:500},children:"Community-Topf"}),e.jsx(n,{variant:"h3",sx:{fontWeight:600,color:"#c51162",fontSize:{xs:"1.75rem",sm:"2rem",md:"2.5rem"},lineHeight:1.2},children:p?e.jsx(te,{size:28}):Re(d)})]})]}),e.jsxs(N,{fullWidth:!0,variant:"outlined",startIcon:e.jsx(Be,{size:16}),onClick:()=>i("/tokens?tab=community"),sx:{textTransform:"none",fontWeight:600,py:{xs:1,md:1.25},borderColor:"#c51162",color:"#c51162",borderRadius:2,borderWidth:1.5,fontSize:{xs:"0.875rem",md:"1rem"},"&:hover":{borderColor:"#a00037",bgcolor:"rgba(197, 17, 98, 0.04)",borderWidth:1.5}},children:[e.jsx(t,{component:"span",sx:{display:{xs:"none",sm:"inline"}},children:"Jetzt spenden"}),e.jsx(t,{component:"span",sx:{display:{xs:"inline",sm:"none"}},children:"Spenden"})]})]})]}),e.jsx(It,{mode:"user",userId:s==null?void 0:s.id,showUserColumn:!1,showFilters:!0,showStats:!1,showRefresh:!1,limit:50})]})},sn=({userId:i,data:s,enabled:o,debounceMs:d=1e3})=>{const[p,h]=x.useState("idle"),[a,f]=x.useState(null),m=x.useRef(null),j=x.useRef(null),y=x.useRef(""),S=x.useRef(!0);return x.useEffect(()=>{if(!o||!i){console.log("⏸️ AutoSave disabled:",{enabled:o,userId:i});return}if(S.current){S.current=!1,y.current=JSON.stringify(s),console.log("🎬 AutoSave initialized");return}const A=JSON.stringify(s);if(A!==y.current)return console.log("📝 Data changed, scheduling save..."),y.current=A,m.current&&clearTimeout(m.current),h("idle"),m.current=setTimeout(async()=>{console.log("💾 Saving to database...",s),h("saving");try{const{error:r}=await G.from("profiles").update(s).eq("id",i);if(r)throw r;console.log("✅ Saved successfully!"),h("saved"),f(new Date),j.current&&clearTimeout(j.current),j.current=setTimeout(()=>{h("idle")},3e3)}catch(r){console.error("❌ Auto-save error:",r),h("error"),j.current&&clearTimeout(j.current),j.current=setTimeout(()=>{h("idle")},5e3)}},d),()=>{m.current&&clearTimeout(m.current),j.current&&clearTimeout(j.current)}},[i,s,o,d]),{status:p,lastSaved:a}},wn=()=>{const{user:i}=Fe(),s=ne(),o=ie(s.breakpoints.down("md")),[d,p]=kt(),[h,a]=x.useState(null),[f,m]=x.useState([]),[j,y]=x.useState(!0),[S,A]=x.useState(null),[r,_]=x.useState(()=>{const u=d.get("section");if(u)return u;const R=localStorage.getItem("settings-last-section");return R&&["overview","profile","security","addresses","shipping","display","ai","notifications","tokens","admin"].includes(R)?R:"profile"}),[w,P]=x.useState(!1),[g,H]=x.useState(!1),[c,U]=x.useState({full_name:"",email:"",phone:"",bio:"",language:"de",salutation:"neutral",title:"",birth_date:"",birth_time:"",birth_place:"",birth_timezone:"",notifications_enabled:!0,email_notifications:!0,newsletter_subscribed:!1,show_phone_publicly:!1,ai_text_style:"balanced",ai_text_length:"medium",ai_include_emoji:!1,ai_allow_line_breaks:!1,ai_auto_publish:!1,ai_analyze_all_images:!1,shipping_enabled:!1,shipping_cost:5,shipping_cost_type:"fixed",shipping_description:null,pickup_enabled:!0,show_location_publicly:!1,show_location_to_public:!0,location_description:null,default_listing_duration:30,hand_preference:"right",show_seller_profile:!0}),Y=i?{full_name:c.full_name||null,phone:c.phone||null,bio:c.bio||null,language:c.language||null,salutation:c.salutation||"neutral",title:c.title||null,birth_date:c.birth_date||null,birth_time:c.birth_time||null,birth_place:c.birth_place||null,birth_timezone:c.birth_timezone||null,notifications_enabled:c.notifications_enabled,email_notifications:c.email_notifications,newsletter_subscribed:c.newsletter_subscribed,show_phone_publicly:c.show_phone_publicly,ai_text_style:c.ai_text_style,ai_text_length:c.ai_text_length,ai_include_emoji:c.ai_include_emoji,ai_auto_publish:c.ai_auto_publish,ai_allow_line_breaks:c.ai_allow_line_breaks,ai_analyze_all_images:c.ai_analyze_all_images,shipping_enabled:c.shipping_enabled,shipping_cost:c.shipping_cost,shipping_cost_type:c.shipping_cost_type,shipping_description:c.shipping_description,pickup_enabled:c.pickup_enabled,show_location_publicly:c.show_location_publicly,location_description:c.location_description,default_listing_duration:c.default_listing_duration,show_location_to_public:c.show_location_to_public,hand_preference:c.hand_preference,show_seller_profile:c.show_seller_profile}:{},{status:W,lastSaved:B}=sn({userId:(i==null?void 0:i.id)||"",data:Y,enabled:!!i,debounceMs:1e3}),l=async()=>{if(i){y(!0);try{const{data:u,error:R}=await G.from("profiles").select("*").eq("id",i.id).maybeSingle();if(R)throw R;if(u){a(u);const K={full_name:u.full_name||"",email:u.email||"",phone:u.phone||"",bio:u.bio||"",language:u.language||"de",salutation:u.salutation||"neutral",title:u.title||"",birth_date:u.birth_date||"",birth_time:u.birth_time||"",birth_place:u.birth_place||"",birth_timezone:u.birth_timezone||"",notifications_enabled:u.notifications_enabled??!0,email_notifications:u.email_notifications??!0,newsletter_subscribed:u.newsletter_subscribed??!1,show_phone_publicly:u.show_phone_publicly??!1,ai_text_style:u.ai_text_style||"balanced",ai_text_length:u.ai_text_length||"medium",ai_include_emoji:u.ai_include_emoji??!1,ai_allow_line_breaks:u.ai_allow_line_breaks??!1,ai_auto_publish:u.ai_auto_publish??!1,ai_analyze_all_images:u.ai_analyze_all_images??!1,shipping_enabled:u.shipping_enabled??!1,shipping_cost:u.shipping_cost??0,shipping_cost_type:u.shipping_cost_type||"fixed",shipping_description:u.shipping_description||null,pickup_enabled:u.pickup_enabled??!0,show_location_publicly:u.show_location_publicly??!1,show_location_to_public:u.show_location_to_public??!0,location_description:u.location_description||null,default_listing_duration:u.default_listing_duration??30,hand_preference:u.hand_preference||"right",show_seller_profile:u.show_seller_profile??!0};U(K)}}catch(u){console.error("Error loading profile:",u),A("Fehler beim Laden des Profils")}finally{y(!1)}}},v=(u,R)=>{U(K=>({...K,[u]:R}))},k=u=>{const R=Math.floor((new Date().getTime()-u.getTime())/1e3);if(R<10)return"gerade eben";if(R<60)return`vor ${R}s`;const K=Math.floor(R/60);return K<60?`vor ${K}min`:`vor ${Math.floor(K/60)}h`};if(x.useEffect(()=>{l()},[i]),x.useEffect(()=>{const u=d.get("section");u&&["overview","profile","security","addresses","shipping","display","ai","notifications","tokens","admin"].includes(u)&&(_(u),localStorage.setItem("settings-last-section",u))},[d]),x.useEffect(()=>{localStorage.setItem("settings-last-section",r),(!d.get("section")||d.get("section")!==r)&&p({section:r})},[r]),j)return e.jsx(De,{maxWidth:"xl",sx:{py:4},children:e.jsx(t,{sx:{display:"flex",justifyContent:"center",py:8},children:e.jsx(te,{size:60})})});const T=()=>{switch(r){case"profile":return e.jsx($t,{profile:h,formData:{full_name:c.full_name,email:c.email,phone:c.phone,bio:c.bio,language:c.language,salutation:c.salutation,title:c.title,birth_date:c.birth_date,birth_time:c.birth_time,birth_place:c.birth_place,birth_timezone:c.birth_timezone},onFormChange:v,userId:(i==null?void 0:i.id)||"",onProfileUpdate:l});case"security":return i?e.jsx(Yt,{userId:i.id}):null;case"addresses":return i?e.jsx(Xt,{userId:i.id}):null;case"shipping":return e.jsx(en,{formData:{shipping_enabled:c.shipping_enabled,shipping_cost:c.shipping_cost,shipping_cost_type:c.shipping_cost_type,shipping_description:c.shipping_description,pickup_enabled:c.pickup_enabled,show_location_publicly:c.show_location_publicly,location_description:c.location_description,show_ai_shipping_costs:!1},onFormChange:v});case"display":return e.jsx(tn,{formData:{language:c.language,show_location_to_public:c.show_location_to_public,default_listing_duration:c.default_listing_duration,hand_preference:c.hand_preference,show_seller_profile:c.show_seller_profile},onFormChange:v});case"ai":return e.jsx(Jt,{formData:{ai_text_style:c.ai_text_style,ai_text_length:c.ai_text_length,ai_include_emoji:c.ai_include_emoji,ai_auto_publish:c.ai_auto_publish,ai_allow_line_breaks:c.ai_allow_line_breaks,ai_analyze_all_images:c.ai_analyze_all_images},onFormChange:v});case"tokens":return e.jsx(nn,{});case"notifications":return e.jsx(Qt,{formData:{notifications_enabled:c.notifications_enabled,email_notifications:c.email_notifications,newsletter_subscribed:c.newsletter_subscribed},onFormChange:v});case"admin":return e.jsx(Tt,{});default:return null}},J=()=>({overview:"Übersicht",profile:"Persönliche Daten",security:"Sicherheit",addresses:"Adressen",shipping:"Versand & Abholung",display:"Anzeige",ai:"KI-Assistent",notifications:"Benachrichtigungen",tokens:"Mein Guthaben",admin:"Administration"})[r];return o?e.jsxs(t,{children:[e.jsx(St,{position:"sticky",elevation:1,sx:{bgcolor:"background.paper",color:"text.primary"},children:e.jsxs(Ct,{children:[e.jsx(he,{edge:"start",onClick:()=>H(!0),sx:{mr:2},children:e.jsx(Pt,{size:24})}),e.jsx(n,{variant:"h6",fontWeight:600,children:J()}),e.jsxs(t,{sx:{ml:"auto"},children:[W==="saving"&&e.jsx(Z,{icon:e.jsx(Ve,{size:14,style:{animation:"spin 1s linear infinite"}}),label:"Speichert...",size:"small",sx:{height:28}}),W==="saved"&&B&&e.jsx(Z,{icon:e.jsx(Le,{size:14}),label:`Gespeichert ${k(B)}`,size:"small",color:"success",sx:{height:28}})]})]})}),e.jsx(At,{anchor:"left",open:g,onClose:()=>H(!1),sx:{"& .MuiDrawer-paper":{width:280}},children:e.jsx(Ne,{currentSection:r,onSectionChange:u=>{_(u),H(!1)},collapsed:!1,onToggleCollapse:()=>{},isMobile:!0})}),e.jsxs(t,{sx:{py:2,px:2},children:[S&&e.jsx(F,{severity:"error",sx:{mb:2},onClose:()=>A(null),children:S}),T()]})]}):e.jsxs(t,{sx:{display:"flex",minHeight:"calc(100vh - 200px)"},children:[e.jsx(Ne,{currentSection:r,onSectionChange:_,collapsed:w,onToggleCollapse:()=>P(!w)}),e.jsxs(t,{sx:{flex:1,pl:4,pr:4,py:4,position:"relative"},children:[e.jsxs(t,{sx:{position:"fixed",top:80,right:24,zIndex:1e3},children:[W==="saving"&&e.jsx(Z,{icon:e.jsx(Ve,{size:14,style:{animation:"spin 1s linear infinite"}}),label:"Speichert...",size:"small",sx:{height:28}}),W==="saved"&&B&&e.jsx(Z,{icon:e.jsx(Le,{size:14}),label:`Gespeichert ${k(B)}`,size:"small",color:"success",sx:{height:28}})]}),e.jsxs(De,{maxWidth:"lg",disableGutters:!0,children:[S&&e.jsx(F,{severity:"error",sx:{mb:3},onClose:()=>A(null),children:S}),T()]})]})]})};export{wn as SettingsPage};
