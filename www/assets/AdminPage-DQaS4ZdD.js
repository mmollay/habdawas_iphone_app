import{r as h,g as Se,a as ke,u as _e,j as e,s as Me,c as Pe,b as Te,m as ut,aT as we,e as oe,n as At,f as A,P as Y,B as j,w as pe,ap as Rt,aq as Kt,N as qe,O as Ge,au as tt,Q as Ee,aO as nt,aw as ht,aj as Zt,h as We,i as De,x as Ot,H as ie,t as N,aC as ce,ao as en,ad as fe,ag as ve,ah as xe,L as W,aU as tn,T as u,K as I,as as Et,M as Bt,C as nn,V as It,D as Qe,p as Je,q as Ve,A as U,v as Xe,l as K,ay as se,az as ae,aQ as lt,aR as X,ac as rn,aV as sn,o as an,aN as Ft,ae as on,a4 as xt,al as ln,aF as $t,aW as cn,aX as Ye,aY as dn,af as un,I as hn,aP as mn,aK as gn,X as fn,R as xn,aS as pn}from"./index-BSUU9nrj.js";import{C as yn,a as bn}from"./chevron-right-LG1cVKCM.js";import{G as E,D as mt}from"./dollar-sign-CG0h9cSh.js";import{C as Lt}from"./credit-card-QH-sWYwV.js";import{S as gt}from"./Snackbar-DAEujyml.js";import{P as jn}from"./plus-B3wyn_If.js";import{A as wn,a as vn,b as Cn}from"./AccordionSummary-DW1MYCBE.js";import{C as Sn}from"./calendar-DKNVDNuI.js";import{a as ge,A as kn,f as L,u as Nt}from"./formatNumber-_rJIlwWT.js";import{R as _n,a as pt}from"./RadioGroup-DY1f4CsV.js";import{G as ct}from"./gift-DVgAVAco.js";import{S as Mn}from"./save-C1v_47cF.js";const Ut=h.createContext();function Pn(t){return Se("MuiTable",t)}ke("MuiTable",["root","stickyHeader"]);const Tn=t=>{const{classes:r,stickyHeader:n}=t;return Te({root:["root",n&&"stickyHeader"]},Pn,r)},Wn=Me("table",{name:"MuiTable",slot:"Root",overridesResolver:(t,r)=>{const{ownerState:n}=t;return[r.root,n.stickyHeader&&r.stickyHeader]}})(ut(({theme:t})=>({display:"table",width:"100%",borderCollapse:"collapse",borderSpacing:0,"& caption":{...t.typography.body2,padding:t.spacing(2),color:(t.vars||t).palette.text.secondary,textAlign:"left",captionSide:"bottom"},variants:[{props:({ownerState:r})=>r.stickyHeader,style:{borderCollapse:"separate"}}]}))),yt="table",Ie=h.forwardRef(function(r,n){const s=_e({props:r,name:"MuiTable"}),{className:a,component:i=yt,padding:l="normal",size:d="medium",stickyHeader:f=!1,...b}=s,o={...s,component:i,padding:l,size:d,stickyHeader:f},w=Tn(o),_=h.useMemo(()=>({padding:l,size:d,stickyHeader:f}),[l,d,f]);return e.jsx(Ut.Provider,{value:_,children:e.jsx(Wn,{as:i,role:i===yt?null:"table",ref:n,className:Pe(w.root,a),ownerState:o,...b})})}),rt=h.createContext();function Dn(t){return Se("MuiTableBody",t)}ke("MuiTableBody",["root"]);const zn=t=>{const{classes:r}=t;return Te({root:["root"]},Dn,r)},An=Me("tbody",{name:"MuiTableBody",slot:"Root"})({display:"table-row-group"}),Rn={variant:"body"},bt="tbody",Fe=h.forwardRef(function(r,n){const s=_e({props:r,name:"MuiTableBody"}),{className:a,component:i=bt,...l}=s,d={...s,component:i},f=zn(d);return e.jsx(rt.Provider,{value:Rn,children:e.jsx(An,{className:Pe(f.root,a),as:i,ref:n,role:i===bt?null:"rowgroup",ownerState:d,...l})})});function On(t){return Se("MuiTableCell",t)}const En=ke("MuiTableCell",["root","head","body","footer","sizeSmall","sizeMedium","paddingCheckbox","paddingNone","alignLeft","alignCenter","alignRight","alignJustify","stickyHeader"]),Bn=t=>{const{classes:r,variant:n,align:s,padding:a,size:i,stickyHeader:l}=t,d={root:["root",n,l&&"stickyHeader",s!=="inherit"&&`align${we(s)}`,a!=="normal"&&`padding${we(a)}`,`size${we(i)}`]};return Te(d,On,r)},In=Me("td",{name:"MuiTableCell",slot:"Root",overridesResolver:(t,r)=>{const{ownerState:n}=t;return[r.root,r[n.variant],r[`size${we(n.size)}`],n.padding!=="normal"&&r[`padding${we(n.padding)}`],n.align!=="inherit"&&r[`align${we(n.align)}`],n.stickyHeader&&r.stickyHeader]}})(ut(({theme:t})=>({...t.typography.body2,display:"table-cell",verticalAlign:"inherit",borderBottom:t.vars?`1px solid ${t.vars.palette.TableCell.border}`:`1px solid
    ${t.palette.mode==="light"?t.lighten(t.alpha(t.palette.divider,1),.88):t.darken(t.alpha(t.palette.divider,1),.68)}`,textAlign:"left",padding:16,variants:[{props:{variant:"head"},style:{color:(t.vars||t).palette.text.primary,lineHeight:t.typography.pxToRem(24),fontWeight:t.typography.fontWeightMedium}},{props:{variant:"body"},style:{color:(t.vars||t).palette.text.primary}},{props:{variant:"footer"},style:{color:(t.vars||t).palette.text.secondary,lineHeight:t.typography.pxToRem(21),fontSize:t.typography.pxToRem(12)}},{props:{size:"small"},style:{padding:"6px 16px",[`&.${En.paddingCheckbox}`]:{width:24,padding:"0 12px 0 16px","& > *":{padding:0}}}},{props:{padding:"checkbox"},style:{width:48,padding:"0 0 0 4px"}},{props:{padding:"none"},style:{padding:0}},{props:{align:"left"},style:{textAlign:"left"}},{props:{align:"center"},style:{textAlign:"center"}},{props:{align:"right"},style:{textAlign:"right",flexDirection:"row-reverse"}},{props:{align:"justify"},style:{textAlign:"justify"}},{props:({ownerState:r})=>r.stickyHeader,style:{position:"sticky",top:0,zIndex:2,backgroundColor:(t.vars||t).palette.background.default}}]}))),x=h.forwardRef(function(r,n){const s=_e({props:r,name:"MuiTableCell"}),{align:a="inherit",className:i,component:l,padding:d,scope:f,size:b,sortDirection:o,variant:w,..._}=s,m=h.useContext(Ut),g=h.useContext(rt),C=g&&g.variant==="head";let S;l?S=l:S=C?"th":"td";let O=f;S==="td"?O=void 0:!O&&C&&(O="col");const y=w||g&&g.variant,v={...s,align:a,component:S,padding:d||(m&&m.padding?m.padding:"normal"),size:b||(m&&m.size?m.size:"medium"),sortDirection:o,stickyHeader:y==="head"&&m&&m.stickyHeader,variant:y},k=Bn(v);let D=null;return o&&(D=o==="asc"?"ascending":"descending"),e.jsx(In,{as:S,ref:n,className:Pe(k.root,i),"aria-sort":D,scope:O,ownerState:v,..._})});function Fn(t){return Se("MuiTableContainer",t)}ke("MuiTableContainer",["root"]);const $n=t=>{const{classes:r}=t;return Te({root:["root"]},Fn,r)},Ln=Me("div",{name:"MuiTableContainer",slot:"Root"})({width:"100%",overflowX:"auto"}),$e=h.forwardRef(function(r,n){const s=_e({props:r,name:"MuiTableContainer"}),{className:a,component:i="div",...l}=s,d={...s,component:i},f=$n(d);return e.jsx(Ln,{ref:n,as:i,className:Pe(f.root,a),ownerState:d,...l})});function Nn(t){return Se("MuiTableHead",t)}ke("MuiTableHead",["root"]);const Un=t=>{const{classes:r}=t;return Te({root:["root"]},Nn,r)},Hn=Me("thead",{name:"MuiTableHead",slot:"Root"})({display:"table-header-group"}),Yn={variant:"head"},jt="thead",Le=h.forwardRef(function(r,n){const s=_e({props:r,name:"MuiTableHead"}),{className:a,component:i=jt,...l}=s,d={...s,component:i},f=Un(d);return e.jsx(rt.Provider,{value:Yn,children:e.jsx(Hn,{as:i,className:Pe(f.root,a),ref:n,role:i===jt?null:"rowgroup",ownerState:d,...l})})});function qn(t){return Se("MuiTableRow",t)}const wt=ke("MuiTableRow",["root","selected","hover","head","footer"]),Gn=t=>{const{classes:r,selected:n,hover:s,head:a,footer:i}=t;return Te({root:["root",n&&"selected",s&&"hover",a&&"head",i&&"footer"]},qn,r)},Qn=Me("tr",{name:"MuiTableRow",slot:"Root",overridesResolver:(t,r)=>{const{ownerState:n}=t;return[r.root,n.head&&r.head,n.footer&&r.footer]}})(ut(({theme:t})=>({color:"inherit",display:"table-row",verticalAlign:"middle",outline:0,[`&.${wt.hover}:hover`]:{backgroundColor:(t.vars||t).palette.action.hover},[`&.${wt.selected}`]:{backgroundColor:t.alpha((t.vars||t).palette.primary.main,(t.vars||t).palette.action.selectedOpacity),"&:hover":{backgroundColor:t.alpha((t.vars||t).palette.primary.main,`${(t.vars||t).palette.action.selectedOpacity} + ${(t.vars||t).palette.action.hoverOpacity}`)}}}))),vt="tr",q=h.forwardRef(function(r,n){const s=_e({props:r,name:"MuiTableRow"}),{className:a,component:i=vt,hover:l=!1,selected:d=!1,...f}=s,b=h.useContext(rt),o={...s,component:i,hover:l,selected:d,head:b&&b.variant==="head",footer:b&&b.variant==="footer"},w=Gn(o);return e.jsx(Qn,{as:i,ref:n,className:Pe(w.root,a),role:i===vt?null:"row",ownerState:o,...f})});/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ht=oe("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jn=oe("Ban",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m4.9 4.9 14.2 14.2",key:"1m5liu"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vn=oe("CheckCircle2",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xn=oe("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Kn=oe("Key",[["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["path",{d:"m15.5 7.5 3 3L22 7l-3-3",key:"1rn1fs"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zn=oe("ListTodo",[["rect",{x:"3",y:"5",width:"6",height:"6",rx:"1",key:"1defrl"}],["path",{d:"m3 17 2 2 4-4",key:"1jhpwq"}],["path",{d:"M13 6h8",key:"15sg57"}],["path",{d:"M13 12h8",key:"h98zly"}],["path",{d:"M13 18h8",key:"oe0vm4"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const er=oe("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yt=oe("RefreshCcw",[["path",{d:"M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"14sxne"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16",key:"1hlbsb"}],["path",{d:"M16 16h5v5",key:"ccwih5"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tr=oe("TrendingDown",[["polyline",{points:"22 17 13.5 8.5 8.5 13.5 2 7",key:"1r2t7k"}],["polyline",{points:"16 17 22 17 22 11",key:"11uiuu"}]]),ft=()=>{const{user:t}=At(),[r,n]=h.useState(!1),[s,a]=h.useState(!0);return h.useEffect(()=>{(async()=>{if(!t){n(!1),a(!1);return}const{data:v}=await A.from("profiles").select("is_admin").eq("id",t.id).maybeSingle();if((v==null?void 0:v.is_admin)===!0){n(!0),a(!1);return}const{data:k}=await A.rpc("get_user_roles",{check_user_id:t.id}),D=k==null?void 0:k.some(F=>F.role_name==="admin");n(D||!1),a(!1)})()},[t]),{isAdmin:r,loading:s,getSystemSettings:async()=>{const{data:y,error:v}=await A.from("system_settings").select("*").limit(1).maybeSingle();if(v)throw v;return y},updateSystemSettings:async y=>{const{data:v}=await A.from("system_settings").select("id").limit(1).maybeSingle();if(!v)throw new Error("System settings not found");const{error:k}=await A.from("system_settings").update({...y,updated_at:new Date().toISOString(),updated_by:t==null?void 0:t.id}).eq("id",v.id);if(k)throw k},getAllUsers:async()=>{const{data:y,error:v}=await A.rpc("get_all_users_admin");if(v)throw v;return y||[]},suspendUser:async(y,v)=>{const{error:k}=await A.rpc("suspend_user_admin",{target_user_id:y,reason:v});if(k)throw k},unsuspendUser:async y=>{const{error:v}=await A.rpc("unsuspend_user_admin",{target_user_id:y});if(v)throw v},deleteUser:async y=>{const{error:v}=await A.rpc("delete_user_admin",{target_user_id:y});if(v)throw v},updateUserTokens:async(y,v)=>{const{error:k}=await A.from("user_tokens").update({balance:v}).eq("user_id",y);if(k)throw k},getAllRoles:async()=>{const{data:y,error:v}=await A.rpc("get_all_roles_with_permissions");if(v)throw v;return y||[]},getUserRoles:async y=>{const{data:v,error:k}=await A.rpc("get_user_roles",{check_user_id:y});if(k)throw k;return v||[]},assignRole:async(y,v)=>{const{error:k}=await A.rpc("assign_role_to_user",{target_user_id:y,target_role_id:v});if(k)throw k},removeRole:async(y,v)=>{const{error:k}=await A.rpc("remove_role_from_user",{target_user_id:y,target_role_id:v});if(k)throw k},getUserPermissions:async y=>{const{data:v,error:k}=await A.rpc("get_user_permissions",{check_user_id:y});if(k)throw k;return v||[]},hasPermission:async y=>{if(!t)return!1;const{data:v,error:k}=await A.rpc("user_has_permission",{check_user_id:t.id,permission_name:y});return k?!1:v||!1}}},Ct=({currentSection:t,onSectionChange:r,collapsed:n,onToggleCollapse:s,isMobile:a=!1})=>{const i=[{id:"users",label:"Benutzerverwaltung",icon:e.jsx(nt,{size:20})},{id:"roles",label:"Rollen & Rechte",icon:e.jsx(ht,{size:20})},{id:"credits",label:"Credit-System",icon:e.jsx(Zt,{size:20})},{id:"tasks",label:"Aufgaben",icon:e.jsx(Zn,{size:20})}];return e.jsxs(Y,{elevation:0,sx:{width:a?"100%":n?72:260,transition:"width 0.3s ease",height:a?"100%":"100vh",borderRight:a?0:1,borderColor:"divider",borderRadius:0,overflow:"auto",display:"flex",flexDirection:"column",position:a?"relative":"sticky",top:0,left:0},children:[!a&&e.jsx(j,{sx:{display:"flex",justifyContent:n?"center":"flex-end",p:1.5,borderBottom:1,borderColor:"divider"},children:e.jsx(pe,{onClick:s,size:"small",sx:{bgcolor:"action.hover","&:hover":{bgcolor:"action.selected"}},children:n?e.jsx(yn,{size:18}):e.jsx(bn,{size:18})})}),e.jsx(Rt,{sx:{pt:2,pb:2},children:i.map((l,d)=>{const f=e.jsxs(Kt,{onClick:()=>r(l.id),selected:t===l.id,sx:{mb:.5,mx:n&&!a?1:1.5,borderRadius:2,minHeight:48,justifyContent:n&&!a?"center":"flex-start",px:n&&!a?0:2,"&.Mui-selected":{bgcolor:"primary.main",color:"white","&:hover":{bgcolor:"primary.dark"},"& .MuiListItemIcon-root":{color:"white"}},"&:hover":{bgcolor:n&&!a?"action.hover":"action.selected"}},children:[e.jsx(qe,{sx:{minWidth:n&&!a?"auto":40,justifyContent:"center",color:t===l.id?"inherit":"text.secondary"},children:l.icon}),(!n||a)&&e.jsx(Ge,{primary:l.label,primaryTypographyProps:{fontWeight:t===l.id?600:400,fontSize:"0.95rem"}})]},l.id),b=a?f:e.jsx(tt,{title:n?l.label:"",placement:"right",arrow:!0,children:f},l.id);return l.id==="tasks"?e.jsxs(j,{children:[e.jsx(Ee,{sx:{my:2,mx:2}}),b]},l.id):b})})]})},St=()=>{const t=We();De(t.breakpoints.down("md"));const r=Ot(),{getAllUsers:n,suspendUser:s,unsuspendUser:a,deleteUser:i,getUserRoles:l,assignRole:d,removeRole:f,getAllRoles:b}=ft(),[o,w]=h.useState([]),[_,m]=h.useState(!1),[g,C]=h.useState({open:!1,message:"",severity:"success"}),[S,O]=h.useState(""),[y,v]=h.useState("all"),[k,D]=h.useState("all"),[F,z]=h.useState("newest"),[H,V]=h.useState(null),[P,ze]=h.useState(null),[at,ye]=h.useState(!1),[Ae,Ne]=h.useState(""),[it,ue]=h.useState(!1),[G,Re]=h.useState(!1),[Oe,c]=h.useState([]),[M,B]=h.useState([]);h.useEffect(()=>{$()},[]);const $=async()=>{m(!0);try{const p=await n(),T=await Promise.all(p.map(async Q=>{const ot=await l(Q.id);return{...Q,roles:ot}}));w(T)}catch(p){C({open:!0,message:`Fehler beim Laden: ${p.message}`,severity:"error"})}finally{m(!1)}},he=(p,T)=>{V(p.currentTarget),ze(T)},te=()=>{V(null)},Ue=async()=>{if(P){try{await s(P.id,Ae),C({open:!0,message:"Benutzer erfolgreich gesperrt",severity:"success"}),ye(!1),Ne(""),await $()}catch(p){C({open:!0,message:`Fehler: ${p.message}`,severity:"error"})}te()}},ne=async()=>{if(P){try{await a(P.id),C({open:!0,message:"Sperrung erfolgreich aufgehoben",severity:"success"}),await $()}catch(p){C({open:!0,message:`Fehler: ${p.message}`,severity:"error"})}te()}},re=async()=>{if(P){try{await i(P.id),C({open:!0,message:"Benutzer erfolgreich gelÃ¶scht",severity:"success"}),ue(!1),await $()}catch(p){C({open:!0,message:`Fehler: ${p.message}`,severity:"error"})}te()}},He=p=>new Date(p).toLocaleDateString("de-DE",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}),be=h.useMemo(()=>{let p=[...o];if(S.trim()){const T=S.toLowerCase();p=p.filter(Q=>Q.email.toLowerCase().includes(T)||Q.full_name&&Q.full_name.toLowerCase().includes(T))}return y==="active"?p=p.filter(T=>!T.is_suspended):y==="suspended"&&(p=p.filter(T=>T.is_suspended)),k==="admin"?p=p.filter(T=>T.is_admin):k==="user"&&(p=p.filter(T=>!T.is_admin)),p.sort((T,Q)=>{if(F==="newest")return new Date(Q.created_at).getTime()-new Date(T.created_at).getTime();if(F==="oldest")return new Date(T.created_at).getTime()-new Date(Q.created_at).getTime();{const ot=T.full_name||T.email,Xt=Q.full_name||Q.email;return ot.localeCompare(Xt)}}),p},[o,S,y,k,F]);return _&&o.length===0?e.jsx(j,{sx:{display:"flex",justifyContent:"center",p:4},children:e.jsx(ie,{})}):e.jsxs(j,{children:[e.jsxs(Y,{sx:{mb:3},children:[e.jsxs(j,{sx:{p:{xs:2,md:3},borderBottom:1,borderColor:"divider"},children:[e.jsxs(E,{container:!0,spacing:{xs:2,md:3},alignItems:"center",children:[e.jsx(E,{size:{xs:12,md:4},children:e.jsx(N,{fullWidth:!0,placeholder:"Nach E-Mail oder Name suchen...",value:S,onChange:p=>O(p.target.value),InputProps:{startAdornment:e.jsx(ce,{position:"start",children:e.jsx(en,{size:20})})},size:"small"})}),e.jsx(E,{size:{xs:12,sm:6,md:2.5},children:e.jsxs(fe,{fullWidth:!0,size:"small",children:[e.jsx(ve,{children:"Status"}),e.jsxs(xe,{value:y,label:"Status",onChange:p=>v(p.target.value),children:[e.jsx(W,{value:"all",children:"Alle"}),e.jsx(W,{value:"active",children:"Aktiv"}),e.jsx(W,{value:"suspended",children:"Gesperrt"})]})]})}),e.jsx(E,{size:{xs:12,sm:6,md:2.5},children:e.jsxs(fe,{fullWidth:!0,size:"small",children:[e.jsx(ve,{children:"Rolle"}),e.jsxs(xe,{value:k,label:"Rolle",onChange:p=>D(p.target.value),children:[e.jsx(W,{value:"all",children:"Alle"}),e.jsx(W,{value:"admin",children:"Admins"}),e.jsx(W,{value:"user",children:"User"})]})]})}),e.jsx(E,{size:{xs:12,sm:6,md:3},children:e.jsxs(fe,{fullWidth:!0,size:"small",children:[e.jsx(ve,{children:"Sortierung"}),e.jsxs(xe,{value:F,label:"Sortierung",onChange:p=>z(p.target.value),children:[e.jsx(W,{value:"newest",children:"Neueste zuerst"}),e.jsx(W,{value:"oldest",children:"Ã„lteste zuerst"}),e.jsx(W,{value:"name",children:"Nach Name"})]})]})})]}),e.jsxs(j,{sx:{mt:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(tn,{size:16,color:t.palette.text.secondary}),e.jsxs(u,{variant:"body2",color:"text.secondary",children:[be.length," von ",o.length," Benutzer",be.length!==o.length&&" (gefiltert)"]})]})]}),e.jsx($e,{children:e.jsxs(Ie,{children:[e.jsx(Le,{children:e.jsxs(q,{children:[e.jsx(x,{children:"E-Mail"}),e.jsx(x,{children:"Name"}),e.jsx(x,{children:"Rollen"}),e.jsx(x,{children:"Registriert"}),e.jsx(x,{align:"center",children:"Status"}),e.jsx(x,{align:"center",children:"Items"}),e.jsx(x,{align:"center",children:"Nachrichten"}),e.jsx(x,{align:"center",children:"Aktionen"})]})}),e.jsx(Fe,{children:be.length===0?e.jsx(q,{children:e.jsx(x,{colSpan:8,align:"center",sx:{py:4},children:e.jsx(u,{variant:"body2",color:"text.secondary",children:"Keine Benutzer gefunden"})})}):be.map(p=>e.jsxs(q,{hover:!0,children:[e.jsxs(x,{children:[p.email,p.is_admin&&e.jsx(I,{label:"Super Admin",size:"small",color:"error",sx:{ml:1}})]}),e.jsx(x,{children:p.full_name||"-"}),e.jsx(x,{children:e.jsx(j,{display:"flex",gap:.5,flexWrap:"wrap",children:p.roles&&p.roles.length>0?p.roles.map(T=>e.jsx(I,{label:T.display_name,size:"small",variant:"outlined"},T.role_id)):e.jsx(u,{variant:"body2",color:"text.secondary",children:"-"})})}),e.jsx(x,{children:He(p.created_at)}),e.jsx(x,{align:"center",children:p.is_suspended?e.jsx(tt,{title:p.suspended_reason||"Gesperrt",children:e.jsx(I,{label:"Gesperrt",size:"small",color:"error"})}):e.jsx(I,{label:"Aktiv",size:"small",color:"success"})}),e.jsx(x,{align:"center",children:e.jsx(I,{label:p.item_count,size:"small",variant:"outlined",onClick:()=>r(`/?seller=${p.id}`),sx:{cursor:"pointer"}})}),e.jsx(x,{align:"center",children:p.message_count}),e.jsx(x,{align:"center",children:e.jsx(pe,{size:"small",onClick:T=>he(T,p),disabled:p.is_admin,children:e.jsx(Et,{size:20})})})]},p.id))})]})})]}),e.jsxs(Bt,{anchorEl:H,open:!!H,onClose:te,children:[e.jsxs(W,{onClick:async()=>{if(P){const p=await l(P.id),T=await b();c(p),B(T),Re(!0)}},children:[e.jsx(ht,{size:18,style:{marginRight:8}}),"Rollen verwalten"]}),e.jsxs(W,{onClick:()=>P&&r(`/?seller=${P.id}`),children:[e.jsx(Lt,{size:18,style:{marginRight:8}}),"Items anzeigen"]}),P!=null&&P.is_suspended?e.jsxs(W,{onClick:ne,children:[e.jsx(nn,{size:18,style:{marginRight:8}}),"Entsperren"]}):e.jsxs(W,{onClick:()=>ye(!0),sx:{color:"warning.main"},children:[e.jsx(Jn,{size:18,style:{marginRight:8}}),"Sperren"]}),e.jsxs(W,{onClick:()=>ue(!0),sx:{color:"error.main"},children:[e.jsx(It,{size:18,style:{marginRight:8}}),"LÃ¶schen"]})]}),e.jsxs(Qe,{open:at,onClose:()=>ye(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(Je,{children:"Benutzer sperren"}),e.jsxs(Ve,{children:[e.jsx(U,{severity:"warning",sx:{mb:2},children:"Der Benutzer kann sich nicht mehr anmelden und keine Items erstellen oder bearbeiten."}),e.jsxs(u,{variant:"body2",color:"text.secondary",sx:{mb:2},children:["Benutzer: ",e.jsx("strong",{children:P==null?void 0:P.email})]}),e.jsx(N,{label:"Grund fÃ¼r Sperrung",fullWidth:!0,multiline:!0,rows:3,value:Ae,onChange:p=>Ne(p.target.value),placeholder:"Z.B.: VerstoÃŸ gegen Nutzungsbedingungen"})]}),e.jsxs(Xe,{children:[e.jsx(K,{onClick:()=>ye(!1),children:"Abbrechen"}),e.jsx(K,{variant:"contained",color:"warning",onClick:Ue,disabled:!Ae.trim(),children:"Sperren"})]})]}),e.jsxs(Qe,{open:it,onClose:()=>ue(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(Je,{children:"Benutzer lÃ¶schen"}),e.jsxs(Ve,{children:[e.jsx(U,{severity:"error",sx:{mb:2},children:"Diese Aktion kann nicht rÃ¼ckgÃ¤ngig gemacht werden! Alle Daten des Benutzers werden unwiderruflich gelÃ¶scht."}),e.jsxs(u,{variant:"body2",color:"text.secondary",children:["Benutzer: ",e.jsx("strong",{children:P==null?void 0:P.email})]}),e.jsxs(u,{variant:"body2",color:"text.secondary",children:["Items: ",e.jsx("strong",{children:P==null?void 0:P.item_count})]}),e.jsxs(u,{variant:"body2",color:"text.secondary",children:["Nachrichten: ",e.jsx("strong",{children:P==null?void 0:P.message_count})]})]}),e.jsxs(Xe,{children:[e.jsx(K,{onClick:()=>ue(!1),children:"Abbrechen"}),e.jsx(K,{variant:"contained",color:"error",onClick:re,children:"Unwiderruflich lÃ¶schen"})]})]}),e.jsxs(Qe,{open:G,onClose:()=>Re(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(Je,{children:"Rollen verwalten"}),e.jsxs(Ve,{children:[e.jsxs(u,{variant:"body2",color:"text.secondary",sx:{mb:2},children:["Benutzer: ",e.jsx("strong",{children:P==null?void 0:P.email})]}),e.jsx(u,{variant:"subtitle2",sx:{mt:2,mb:1},children:"Aktuelle Rollen:"}),e.jsx(j,{display:"flex",gap:1,flexWrap:"wrap",mb:2,children:Oe.length>0?Oe.map(p=>e.jsx(I,{label:p.display_name,onDelete:async()=>{if(P)try{await f(P.id,p.role_id);const T=await l(P.id);c(T),C({open:!0,message:"Rolle erfolgreich entfernt",severity:"success"}),await $()}catch(T){C({open:!0,message:`Fehler: ${T.message}`,severity:"error"})}}},p.role_id)):e.jsx(u,{variant:"body2",color:"text.secondary",children:"Keine Rollen zugewiesen"})}),e.jsx(u,{variant:"subtitle2",sx:{mt:3,mb:1},children:"Rolle hinzufÃ¼gen:"}),e.jsx(j,{display:"flex",gap:1,flexWrap:"wrap",children:M.filter(p=>!Oe.some(T=>T.role_id===p.role_id)).map(p=>e.jsx(I,{label:p.display_name,onClick:async()=>{if(P)try{await d(P.id,p.role_id);const T=await l(P.id);c(T),C({open:!0,message:"Rolle erfolgreich zugewiesen",severity:"success"}),await $()}catch(T){C({open:!0,message:`Fehler: ${T.message}`,severity:"error"})}},variant:"outlined",sx:{cursor:"pointer"}},p.role_id))})]}),e.jsx(Xe,{children:e.jsx(K,{onClick:()=>Re(!1),children:"SchlieÃŸen"})})]}),e.jsx(gt,{open:g.open,autoHideDuration:6e3,onClose:()=>C({...g,open:!1}),children:e.jsx(U,{severity:g.severity,onClose:()=>C({...g,open:!1}),children:g.message})})]})},nr=()=>{const t=We();De(t.breakpoints.down("md"));const{getAllRoles:r}=ft(),[n,s]=h.useState([]),[a,i]=h.useState(!1),[l,d]=h.useState({open:!1,message:"",severity:"success"});h.useEffect(()=>{f()},[]);const f=async()=>{i(!0);try{const o=await r();s(o)}catch(o){console.error("Error loading roles:",o),d({open:!0,message:"Fehler beim Laden der Rollen",severity:"error"})}finally{i(!1)}},b=o=>{switch(o){case"admin":return"error";case"moderator":return"warning";case"support":return"info";case"content_reviewer":return"success";default:return"default"}};return a?e.jsx(j,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",children:e.jsx(ie,{})}):e.jsxs(j,{children:[e.jsx(u,{variant:"h6",fontWeight:600,gutterBottom:!0,sx:{mb:2},children:"Rollen-Ãœbersicht"}),e.jsx(E,{container:!0,spacing:{xs:2,md:3},sx:{mb:4},children:n.map(o=>e.jsx(E,{size:{xs:12,sm:6,md:3},children:e.jsx(se,{elevation:1,sx:{height:"100%",display:"flex",flexDirection:"column",transition:"all 0.2s ease","&:hover":{elevation:3,transform:"translateY(-2px)"}},children:e.jsxs(ae,{sx:{display:"flex",flexDirection:"column",height:"100%",p:{xs:2,md:3}},children:[e.jsxs(j,{display:"flex",alignItems:"center",mb:2,children:[e.jsx(ht,{size:24,color:t.palette.primary.main,style:{marginRight:8}}),e.jsx(u,{variant:"h6",component:"div",fontWeight:600,children:o.display_name})]}),e.jsx(u,{variant:"body2",color:"text.secondary",sx:{mb:"auto",minHeight:40,display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden",textOverflow:"ellipsis"},children:o.description}),e.jsxs(j,{display:"flex",justifyContent:"space-between",alignItems:"center",sx:{pt:2,mt:2,borderTop:"1px solid",borderColor:"divider"},children:[e.jsxs(j,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(nt,{size:16,color:t.palette.text.secondary}),e.jsx(u,{variant:"body2",fontWeight:500,children:o.user_count})]}),e.jsxs(j,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(Kn,{size:16,color:t.palette.text.secondary}),e.jsx(u,{variant:"body2",fontWeight:500,children:o.permission_count})]})]})]})})},o.role_id))}),e.jsx(Ee,{sx:{my:4}}),e.jsx(u,{variant:"h6",fontWeight:600,gutterBottom:!0,sx:{mb:2},children:"Rollen-Details"}),e.jsx(Y,{elevation:1,sx:{mb:4},children:e.jsx($e,{children:e.jsxs(Ie,{children:[e.jsx(Le,{children:e.jsxs(q,{children:[e.jsx(x,{children:"Rolle"}),e.jsx(x,{children:"Beschreibung"}),e.jsx(x,{align:"center",children:"Berechtigungen"}),e.jsx(x,{align:"center",children:"Benutzer"})]})}),e.jsx(Fe,{children:n.map(o=>e.jsxs(q,{hover:!0,children:[e.jsx(x,{children:e.jsx(I,{label:o.display_name,color:b(o.role_name),size:"small",sx:{fontWeight:500}})}),e.jsx(x,{children:o.description}),e.jsx(x,{align:"center",children:e.jsx(I,{label:o.permission_count,size:"small",variant:"outlined"})}),e.jsx(x,{align:"center",children:e.jsx(I,{label:o.user_count,size:"small",variant:"outlined"})})]},o.role_id))})]})})}),e.jsxs(E,{container:!0,spacing:{xs:2,md:3},children:[e.jsx(E,{size:{xs:12,md:6},children:e.jsxs(U,{severity:"info",icon:e.jsx(Ht,{size:20}),children:[e.jsx(u,{variant:"body2",fontWeight:600,mb:1,children:"VerfÃ¼gbare Rollen und Berechtigungen:"}),e.jsxs(u,{variant:"body2",component:"div",sx:{mt:1},children:[e.jsx("strong",{children:"Administrator:"})," Vollzugriff auf alle Systemfunktionen inkl. Rollenverwaltung",e.jsx("br",{}),e.jsx("strong",{children:"Moderator:"})," Kann Inserate prÃ¼fen, freigeben, sperren und bearbeiten",e.jsx("br",{}),e.jsx("strong",{children:"Support:"})," Kann Benutzerdaten einsehen und bei Problemen helfen",e.jsx("br",{}),e.jsx("strong",{children:"Content Reviewer:"})," Kann Inhalte prÃ¼fen und freigeben"]})]})}),e.jsx(E,{size:{xs:12,md:6},children:e.jsxs(U,{severity:"success",icon:e.jsx(Vn,{size:20}),children:[e.jsx(u,{variant:"body2",fontWeight:600,mb:1,children:"Funktionen bereits aktiv:"}),e.jsxs(u,{variant:"body2",component:"div",children:["Rollen kÃ¶nnen Benutzern Ã¼ber die Benutzerverwaltung zugewiesen werden",e.jsx("br",{}),"Berechtigungen werden automatisch Ã¼berprÃ¼ft (items.view_all, items.edit_any, items.delete, etc.)",e.jsx("br",{}),"Datenbank-Funktionen: approve_item(), reject_item(), feature_item() fÃ¼r Moderatoren",e.jsx("br",{}),"RLS-Policies berÃ¼cksichtigen Berechtigungen bei Items"]}),e.jsxs(u,{variant:"body2",component:"div",sx:{mt:2},children:[e.jsx("strong",{children:"Noch zu implementieren:"}),e.jsx("br",{}),"UI-Integration fÃ¼r Moderatoren (Approve/Reject Buttons in der Item-Ansicht)",e.jsx("br",{}),"Messages-Moderation UI",e.jsx("br",{}),"Analytics-Dashboard fÃ¼r Support-Rolle"]})]})})]}),e.jsx(gt,{open:l.open,autoHideDuration:6e3,onClose:()=>d({...l,open:!1}),children:e.jsx(U,{severity:l.severity,onClose:()=>d({...l,open:!1}),children:l.message})})]})},rr=()=>{const{user:t}=At(),[r,n]=h.useState([]),[s,a]=h.useState([]),[i,l]=h.useState(!0),[d,f]=h.useState(!1),[b,o]=h.useState(null),[w,_]=h.useState({open:!1,message:"",severity:"success"}),[m,g]=h.useState(null),[C,S]=h.useState(null),[O,y]=h.useState("all"),[v,k]=h.useState(0),[D,F]=h.useState({title:"",description:"",category:"other",priority:"medium",status:"todo",estimated_hours:"",due_date:""});h.useEffect(()=>{V(),z()},[]);const z=async()=>{try{const M=await(await fetch("/TODO.md")).text();H(M)}catch(c){console.error("Error loading TODO.md:",c)}},H=c=>{const M=c.split(`
`),B=[];let $=null;for(let he=0;he<M.length;he++){const te=M[he],Ue=te.match(/^## (.+)$/);if(Ue){$&&B.push($);const ne=Ue[1].trim(),re=ne.match(/^([^\w\s]+)\s+(.+)$/);$={title:re?re[2]:ne,emoji:re?re[1]:"ðŸ“‹",items:[],notes:[]};continue}if($){const ne=te.match(/^(\s*)- \[([ x])\] (.+)$/);if(ne){const be=Math.floor(ne[1].length/2);$.items.push({text:ne[3],checked:ne[2]==="x",indent:be});continue}const re=te.match(/\*\*PrioritÃ¤t:\*\*\s*(.+)$/);if(re){$.priority=re[1];continue}const He=te.match(/\*\*GeschÃ¤tzter Aufwand:\*\*\s*(.+)$/);if(He){$.estimatedHours=He[1];continue}}}$&&B.push($),a(B.filter(he=>he.items.length>0))},V=async()=>{l(!0);try{const{data:c,error:M}=await A.from("admin_tasks").select("*").order("created_at",{ascending:!1});if(M)throw M;n(c||[])}catch(c){_({open:!0,message:`Fehler beim Laden: ${c.message}`,severity:"error"})}finally{l(!1)}},P=c=>{var M;c?(o(c),F({title:c.title,description:c.description||"",category:c.category,priority:c.priority,status:c.status,estimated_hours:((M=c.estimated_hours)==null?void 0:M.toString())||"",due_date:c.due_date?c.due_date.split("T")[0]:""})):(o(null),F({title:"",description:"",category:"other",priority:"medium",status:"todo",estimated_hours:"",due_date:""})),f(!0)},ze=()=>{f(!1),o(null)},at=async()=>{if(!D.title.trim()){_({open:!0,message:"Bitte gib einen Titel ein",severity:"error"});return}try{const c={title:D.title.trim(),description:D.description.trim()||null,category:D.category,priority:D.priority,status:D.status,estimated_hours:D.estimated_hours?parseInt(D.estimated_hours):null,due_date:D.due_date||null};if(b){const{error:M}=await A.from("admin_tasks").update(c).eq("id",b.id);if(M)throw M;_({open:!0,message:"Task erfolgreich aktualisiert",severity:"success"})}else{const{error:M}=await A.from("admin_tasks").insert([{...c,created_by:t==null?void 0:t.id}]);if(M)throw M;_({open:!0,message:"Task erfolgreich erstellt",severity:"success"})}ze(),V()}catch(c){_({open:!0,message:`Fehler: ${c.message}`,severity:"error"})}},ye=async c=>{if(confirm("MÃ¶chtest du diese Aufgabe wirklich lÃ¶schen?"))try{const{error:M}=await A.from("admin_tasks").delete().eq("id",c);if(M)throw M;_({open:!0,message:"Task erfolgreich gelÃ¶scht",severity:"success"}),V()}catch(M){_({open:!0,message:`Fehler: ${M.message}`,severity:"error"})}},Ae=async(c,M)=>{try{const{error:B}=await A.from("admin_tasks").update({status:M}).eq("id",c);if(B)throw B;V()}catch(B){_({open:!0,message:`Fehler: ${B.message}`,severity:"error"})}},Ne=c=>({moderation:"Moderation",feature:"Feature",bug:"Bug",improvement:"Verbesserung",documentation:"Dokumentation",other:"Sonstiges"})[c]||c,it=c=>({low:"default",medium:"info",high:"warning",urgent:"error"})[c]||"default",ue=O==="all"?r:r.filter(c=>c.status===O),G={total:r.length,todo:r.filter(c=>c.status==="todo").length,in_progress:r.filter(c=>c.status==="in_progress").length,done:r.filter(c=>c.status==="done").length},Re=s.reduce((c,M)=>c+M.items.length,0),Oe=s.reduce((c,M)=>c+M.items.filter(B=>B.checked).length,0);return e.jsxs(j,{children:[e.jsxs(j,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsx(u,{variant:"h6",sx:{fontWeight:600},children:"Task Management"}),e.jsx(K,{variant:"contained",startIcon:e.jsx(jn,{size:20}),onClick:()=>P(),children:"Neue Aufgabe"})]}),e.jsx(Y,{sx:{mb:3},children:e.jsxs(lt,{value:v,onChange:(c,M)=>k(M),children:[e.jsx(X,{label:`TODO-Liste (${Oe}/${Re})`}),e.jsx(X,{label:`Datenbank Tasks (${G.total})`})]})}),v===0?e.jsx(j,{children:s.length===0?e.jsx(Y,{sx:{p:4,textAlign:"center"},children:e.jsx(u,{variant:"body1",color:"text.secondary",children:"TODO.md wird geladen..."})}):e.jsx(j,{children:s.map((c,M)=>e.jsxs(wn,{defaultExpanded:M<3,children:[e.jsx(vn,{expandIcon:e.jsx(rn,{size:20}),children:e.jsxs(j,{sx:{display:"flex",alignItems:"center",gap:1.5,width:"100%"},children:[e.jsx(u,{sx:{fontSize:"1.5rem"},children:c.emoji}),e.jsxs(j,{sx:{flex:1},children:[e.jsx(u,{variant:"h6",fontWeight:600,children:c.title}),e.jsxs(j,{sx:{display:"flex",gap:2,mt:.5},children:[e.jsxs(u,{variant:"caption",color:"text.secondary",children:[c.items.filter(B=>B.checked).length," / ",c.items.length," erledigt"]}),c.priority&&e.jsx(I,{label:c.priority,size:"small",color:c.priority.toLowerCase().includes("high")||c.priority.toLowerCase().includes("urgent")?"error":c.priority.toLowerCase().includes("medium")?"warning":"default",sx:{height:20}}),c.estimatedHours&&e.jsx(I,{label:c.estimatedHours,size:"small",variant:"outlined",sx:{height:20}})]})]})]})}),e.jsx(Cn,{children:e.jsx(Rt,{dense:!0,children:c.items.map((B,$)=>e.jsxs(sn,{sx:{pl:2+B.indent*3,py:.5},children:[e.jsx(qe,{sx:{minWidth:32},children:B.checked?e.jsx(an,{size:18,color:"#4caf50"}):e.jsx(Xn,{size:18,color:"#9e9e9e"})}),e.jsx(Ge,{primary:B.text,primaryTypographyProps:{sx:{textDecoration:B.checked?"line-through":"none",color:B.checked?"text.secondary":"text.primary",fontSize:"0.9rem"}}})]},$))})})]},M))})}):e.jsxs(j,{children:[e.jsxs(E,{container:!0,spacing:2,sx:{mb:3},children:[e.jsx(E,{item:!0,xs:12,sm:6,md:3,children:e.jsx(se,{children:e.jsxs(ae,{children:[e.jsx(u,{color:"text.secondary",variant:"body2",children:"Gesamt"}),e.jsx(u,{variant:"h4",fontWeight:600,children:G.total})]})})}),e.jsx(E,{item:!0,xs:12,sm:6,md:3,children:e.jsx(se,{children:e.jsxs(ae,{children:[e.jsx(u,{color:"text.secondary",variant:"body2",children:"Offen"}),e.jsx(u,{variant:"h4",fontWeight:600,color:"text.primary",children:G.todo})]})})}),e.jsx(E,{item:!0,xs:12,sm:6,md:3,children:e.jsx(se,{children:e.jsxs(ae,{children:[e.jsx(u,{color:"text.secondary",variant:"body2",children:"In Arbeit"}),e.jsx(u,{variant:"h4",fontWeight:600,color:"info.main",children:G.in_progress})]})})}),e.jsx(E,{item:!0,xs:12,sm:6,md:3,children:e.jsx(se,{children:e.jsxs(ae,{children:[e.jsx(u,{color:"text.secondary",variant:"body2",children:"Erledigt"}),e.jsx(u,{variant:"h4",fontWeight:600,color:"success.main",children:G.done})]})})})]}),e.jsx(Y,{sx:{mb:3},children:e.jsxs(lt,{value:O,onChange:(c,M)=>y(M),sx:{borderBottom:1,borderColor:"divider"},children:[e.jsx(X,{label:`Alle (${G.total})`,value:"all"}),e.jsx(X,{label:`Offen (${G.todo})`,value:"todo"}),e.jsx(X,{label:`In Arbeit (${G.in_progress})`,value:"in_progress"}),e.jsx(X,{label:`Erledigt (${G.done})`,value:"done"})]})}),e.jsx($e,{component:Y,children:e.jsxs(Ie,{children:[e.jsx(Le,{children:e.jsxs(q,{children:[e.jsx(x,{children:"Titel"}),e.jsx(x,{children:"Kategorie"}),e.jsx(x,{children:"PrioritÃ¤t"}),e.jsx(x,{children:"Status"}),e.jsx(x,{children:"Aufwand"}),e.jsx(x,{children:"FÃ¤llig am"}),e.jsx(x,{align:"right",children:"Aktionen"})]})}),e.jsx(Fe,{children:i?e.jsx(q,{children:e.jsx(x,{colSpan:7,align:"center",children:"LÃ¤dt..."})}):ue.length===0?e.jsx(q,{children:e.jsx(x,{colSpan:7,align:"center",children:"Keine Aufgaben gefunden"})}):ue.map(c=>e.jsxs(q,{children:[e.jsx(x,{children:e.jsxs(j,{children:[e.jsx(u,{variant:"body2",fontWeight:600,children:c.title}),c.description&&e.jsxs(u,{variant:"caption",color:"text.secondary",children:[c.description.substring(0,60),c.description.length>60?"...":""]})]})}),e.jsx(x,{children:e.jsx(I,{label:Ne(c.category),size:"small",variant:"outlined"})}),e.jsx(x,{children:e.jsx(I,{label:c.priority,size:"small",color:it(c.priority)})}),e.jsx(x,{children:e.jsx(fe,{size:"small",sx:{minWidth:120},children:e.jsxs(xe,{value:c.status,onChange:M=>Ae(c.id,M.target.value),sx:{fontSize:"0.875rem"},children:[e.jsx(W,{value:"todo",children:"Offen"}),e.jsx(W,{value:"in_progress",children:"In Arbeit"}),e.jsx(W,{value:"done",children:"Erledigt"}),e.jsx(W,{value:"cancelled",children:"Abgebrochen"})]})})}),e.jsx(x,{children:c.estimated_hours?`${c.estimated_hours}h`:"-"}),e.jsx(x,{children:c.due_date?e.jsxs(j,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(Sn,{size:14}),e.jsx(u,{variant:"body2",children:new Date(c.due_date).toLocaleDateString("de-DE")})]}):"-"}),e.jsx(x,{align:"right",children:e.jsx(pe,{size:"small",onClick:M=>{g(M.currentTarget),S(c)},children:e.jsx(Et,{size:18})})})]},c.id))})]})}),e.jsxs(Bt,{anchorEl:m,open:!!m,onClose:()=>{g(null),S(null)},children:[e.jsxs(W,{onClick:()=>{C&&P(C),g(null)},children:[e.jsx(qe,{children:e.jsx(Lt,{size:18})}),e.jsx(Ge,{children:"Bearbeiten"})]}),e.jsxs(W,{onClick:()=>{C&&ye(C.id),g(null),S(null)},children:[e.jsx(qe,{children:e.jsx(It,{size:18})}),e.jsx(Ge,{children:"LÃ¶schen"})]})]})]}),e.jsxs(Qe,{open:d,onClose:ze,maxWidth:"sm",fullWidth:!0,children:[e.jsx(Je,{children:b?"Aufgabe bearbeiten":"Neue Aufgabe erstellen"}),e.jsx(Ve,{children:e.jsxs(j,{sx:{display:"flex",flexDirection:"column",gap:2,mt:2},children:[e.jsx(N,{label:"Titel",fullWidth:!0,required:!0,value:D.title,onChange:c=>F({...D,title:c.target.value})}),e.jsx(N,{label:"Beschreibung",fullWidth:!0,multiline:!0,rows:3,value:D.description,onChange:c=>F({...D,description:c.target.value})}),e.jsxs(fe,{fullWidth:!0,children:[e.jsx(ve,{children:"Kategorie"}),e.jsxs(xe,{value:D.category,label:"Kategorie",onChange:c=>F({...D,category:c.target.value}),children:[e.jsx(W,{value:"moderation",children:"Moderation"}),e.jsx(W,{value:"feature",children:"Feature"}),e.jsx(W,{value:"bug",children:"Bug"}),e.jsx(W,{value:"improvement",children:"Verbesserung"}),e.jsx(W,{value:"documentation",children:"Dokumentation"}),e.jsx(W,{value:"other",children:"Sonstiges"})]})]}),e.jsxs(fe,{fullWidth:!0,children:[e.jsx(ve,{children:"PrioritÃ¤t"}),e.jsxs(xe,{value:D.priority,label:"PrioritÃ¤t",onChange:c=>F({...D,priority:c.target.value}),children:[e.jsx(W,{value:"low",children:"Niedrig"}),e.jsx(W,{value:"medium",children:"Mittel"}),e.jsx(W,{value:"high",children:"Hoch"}),e.jsx(W,{value:"urgent",children:"Dringend"})]})]}),e.jsxs(fe,{fullWidth:!0,children:[e.jsx(ve,{children:"Status"}),e.jsxs(xe,{value:D.status,label:"Status",onChange:c=>F({...D,status:c.target.value}),children:[e.jsx(W,{value:"todo",children:"Offen"}),e.jsx(W,{value:"in_progress",children:"In Arbeit"}),e.jsx(W,{value:"done",children:"Erledigt"}),e.jsx(W,{value:"cancelled",children:"Abgebrochen"})]})]}),e.jsx(N,{label:"GeschÃ¤tzter Aufwand (Stunden)",type:"number",fullWidth:!0,value:D.estimated_hours,onChange:c=>F({...D,estimated_hours:c.target.value})}),e.jsx(N,{label:"FÃ¤llig am",type:"date",fullWidth:!0,InputLabelProps:{shrink:!0},value:D.due_date,onChange:c=>F({...D,due_date:c.target.value})})]})}),e.jsxs(Xe,{children:[e.jsx(K,{onClick:ze,children:"Abbrechen"}),e.jsx(K,{onClick:at,variant:"contained",children:b?"Speichern":"Erstellen"})]})]}),e.jsx(gt,{open:w.open,autoHideDuration:6e3,onClose:()=>_({...w,open:!1}),children:e.jsx(U,{severity:w.severity,onClose:()=>_({...w,open:!1}),children:w.message})})]})},sr=(t={})=>{const{userId:r,limit:n=50,autoFetch:s=!0}=t,[a,i]=h.useState([]),[l,d]=h.useState(!0),[f,b]=h.useState(null),o=async()=>{try{d(!0),b(null);let m=A.from("donations").select(`
          *,
          user:profiles!user_id (
            id,
            full_name,
            email
          )
        `).order("created_at",{ascending:!1}).limit(n);r&&(m=m.eq("user_id",r));const{data:g,error:C}=await m;if(C)throw C;i(g||[])}catch(m){const g=m instanceof Error?m.message:"Failed to load donations";b(g),console.error("Error fetching donations:",m)}finally{d(!1)}};h.useEffect(()=>{s&&o()},[r,n,s]);const w=()=>a.reduce((m,g)=>m+Number(g.amount),0),_=()=>a.reduce((m,g)=>m+g.credits_granted,0);return{donations:a,loading:l,error:f,refresh:o,totalDonations:w(),totalCredits:_()}},qt=6048e5,ar=864e5,kt=Symbol.for("constructDateFrom");function de(t,r){return typeof t=="function"?t(r):t&&typeof t=="object"&&kt in t?t[kt](r):t instanceof Date?new t.constructor(r):new Date(r)}function J(t,r){return de(r||t,t)}let ir={};function st(){return ir}function Be(t,r){var d,f,b,o;const n=st(),s=(r==null?void 0:r.weekStartsOn)??((f=(d=r==null?void 0:r.locale)==null?void 0:d.options)==null?void 0:f.weekStartsOn)??n.weekStartsOn??((o=(b=n.locale)==null?void 0:b.options)==null?void 0:o.weekStartsOn)??0,a=J(t,r==null?void 0:r.in),i=a.getDay(),l=(i<s?7:0)+i-s;return a.setDate(a.getDate()-l),a.setHours(0,0,0,0),a}function Ke(t,r){return Be(t,{...r,weekStartsOn:1})}function Gt(t,r){const n=J(t,r==null?void 0:r.in),s=n.getFullYear(),a=de(n,0);a.setFullYear(s+1,0,4),a.setHours(0,0,0,0);const i=Ke(a),l=de(n,0);l.setFullYear(s,0,4),l.setHours(0,0,0,0);const d=Ke(l);return n.getTime()>=i.getTime()?s+1:n.getTime()>=d.getTime()?s:s-1}function _t(t){const r=J(t),n=new Date(Date.UTC(r.getFullYear(),r.getMonth(),r.getDate(),r.getHours(),r.getMinutes(),r.getSeconds(),r.getMilliseconds()));return n.setUTCFullYear(r.getFullYear()),+t-+n}function or(t,...r){const n=de.bind(null,r.find(s=>typeof s=="object"));return r.map(n)}function Mt(t,r){const n=J(t,r==null?void 0:r.in);return n.setHours(0,0,0,0),n}function lr(t,r,n){const[s,a]=or(n==null?void 0:n.in,t,r),i=Mt(s),l=Mt(a),d=+i-_t(i),f=+l-_t(l);return Math.round((d-f)/ar)}function cr(t,r){const n=Gt(t,r),s=de(t,0);return s.setFullYear(n,0,4),s.setHours(0,0,0,0),Ke(s)}function dr(t){return t instanceof Date||typeof t=="object"&&Object.prototype.toString.call(t)==="[object Date]"}function ur(t){return!(!dr(t)&&typeof t!="number"||isNaN(+J(t)))}function hr(t,r){const n=J(t,r==null?void 0:r.in);return n.setFullYear(n.getFullYear(),0,1),n.setHours(0,0,0,0),n}const mr={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},gr=(t,r,n)=>{let s;const a=mr[t];return typeof a=="string"?s=a:r===1?s=a.one:s=a.other.replace("{{count}}",r.toString()),n!=null&&n.addSuffix?n.comparison&&n.comparison>0?"in "+s:s+" ago":s};function Ce(t){return(r={})=>{const n=r.width?String(r.width):t.defaultWidth;return t.formats[n]||t.formats[t.defaultWidth]}}const fr={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},xr={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},pr={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},yr={date:Ce({formats:fr,defaultWidth:"full"}),time:Ce({formats:xr,defaultWidth:"full"}),dateTime:Ce({formats:pr,defaultWidth:"full"})},br={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},jr=(t,r,n,s)=>br[t];function Z(t){return(r,n)=>{const s=n!=null&&n.context?String(n.context):"standalone";let a;if(s==="formatting"&&t.formattingValues){const l=t.defaultFormattingWidth||t.defaultWidth,d=n!=null&&n.width?String(n.width):l;a=t.formattingValues[d]||t.formattingValues[l]}else{const l=t.defaultWidth,d=n!=null&&n.width?String(n.width):t.defaultWidth;a=t.values[d]||t.values[l]}const i=t.argumentCallback?t.argumentCallback(r):r;return a[i]}}const wr={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},vr={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},Cr={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},Sr={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},kr={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},_r={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},Mr=(t,r)=>{const n=Number(t),s=n%100;if(s>20||s<10)switch(s%10){case 1:return n+"st";case 2:return n+"nd";case 3:return n+"rd"}return n+"th"},Pr={ordinalNumber:Mr,era:Z({values:wr,defaultWidth:"wide"}),quarter:Z({values:vr,defaultWidth:"wide",argumentCallback:t=>t-1}),month:Z({values:Cr,defaultWidth:"wide"}),day:Z({values:Sr,defaultWidth:"wide"}),dayPeriod:Z({values:kr,defaultWidth:"wide",formattingValues:_r,defaultFormattingWidth:"wide"})};function ee(t){return(r,n={})=>{const s=n.width,a=s&&t.matchPatterns[s]||t.matchPatterns[t.defaultMatchWidth],i=r.match(a);if(!i)return null;const l=i[0],d=s&&t.parsePatterns[s]||t.parsePatterns[t.defaultParseWidth],f=Array.isArray(d)?Wr(d,w=>w.test(l)):Tr(d,w=>w.test(l));let b;b=t.valueCallback?t.valueCallback(f):f,b=n.valueCallback?n.valueCallback(b):b;const o=r.slice(l.length);return{value:b,rest:o}}}function Tr(t,r){for(const n in t)if(Object.prototype.hasOwnProperty.call(t,n)&&r(t[n]))return n}function Wr(t,r){for(let n=0;n<t.length;n++)if(r(t[n]))return n}function Qt(t){return(r,n={})=>{const s=r.match(t.matchPattern);if(!s)return null;const a=s[0],i=r.match(t.parsePattern);if(!i)return null;let l=t.valueCallback?t.valueCallback(i[0]):i[0];l=n.valueCallback?n.valueCallback(l):l;const d=r.slice(a.length);return{value:l,rest:d}}}const Dr=/^(\d+)(th|st|nd|rd)?/i,zr=/\d+/i,Ar={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},Rr={any:[/^b/i,/^(a|c)/i]},Or={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},Er={any:[/1/i,/2/i,/3/i,/4/i]},Br={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},Ir={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},Fr={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},$r={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},Lr={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},Nr={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},Ur={ordinalNumber:Qt({matchPattern:Dr,parsePattern:zr,valueCallback:t=>parseInt(t,10)}),era:ee({matchPatterns:Ar,defaultMatchWidth:"wide",parsePatterns:Rr,defaultParseWidth:"any"}),quarter:ee({matchPatterns:Or,defaultMatchWidth:"wide",parsePatterns:Er,defaultParseWidth:"any",valueCallback:t=>t+1}),month:ee({matchPatterns:Br,defaultMatchWidth:"wide",parsePatterns:Ir,defaultParseWidth:"any"}),day:ee({matchPatterns:Fr,defaultMatchWidth:"wide",parsePatterns:$r,defaultParseWidth:"any"}),dayPeriod:ee({matchPatterns:Lr,defaultMatchWidth:"any",parsePatterns:Nr,defaultParseWidth:"any"})},Hr={code:"en-US",formatDistance:gr,formatLong:yr,formatRelative:jr,localize:Pr,match:Ur,options:{weekStartsOn:0,firstWeekContainsDate:1}};function Yr(t,r){const n=J(t,r==null?void 0:r.in);return lr(n,hr(n))+1}function qr(t,r){const n=J(t,r==null?void 0:r.in),s=+Ke(n)-+cr(n);return Math.round(s/qt)+1}function Jt(t,r){var o,w,_,m;const n=J(t,r==null?void 0:r.in),s=n.getFullYear(),a=st(),i=(r==null?void 0:r.firstWeekContainsDate)??((w=(o=r==null?void 0:r.locale)==null?void 0:o.options)==null?void 0:w.firstWeekContainsDate)??a.firstWeekContainsDate??((m=(_=a.locale)==null?void 0:_.options)==null?void 0:m.firstWeekContainsDate)??1,l=de((r==null?void 0:r.in)||t,0);l.setFullYear(s+1,0,i),l.setHours(0,0,0,0);const d=Be(l,r),f=de((r==null?void 0:r.in)||t,0);f.setFullYear(s,0,i),f.setHours(0,0,0,0);const b=Be(f,r);return+n>=+d?s+1:+n>=+b?s:s-1}function Gr(t,r){var d,f,b,o;const n=st(),s=(r==null?void 0:r.firstWeekContainsDate)??((f=(d=r==null?void 0:r.locale)==null?void 0:d.options)==null?void 0:f.firstWeekContainsDate)??n.firstWeekContainsDate??((o=(b=n.locale)==null?void 0:b.options)==null?void 0:o.firstWeekContainsDate)??1,a=Jt(t,r),i=de((r==null?void 0:r.in)||t,0);return i.setFullYear(a,0,s),i.setHours(0,0,0,0),Be(i,r)}function Qr(t,r){const n=J(t,r==null?void 0:r.in),s=+Be(n,r)-+Gr(n,r);return Math.round(s/qt)+1}function R(t,r){const n=t<0?"-":"",s=Math.abs(t).toString().padStart(r,"0");return n+s}const le={y(t,r){const n=t.getFullYear(),s=n>0?n:1-n;return R(r==="yy"?s%100:s,r.length)},M(t,r){const n=t.getMonth();return r==="M"?String(n+1):R(n+1,2)},d(t,r){return R(t.getDate(),r.length)},a(t,r){const n=t.getHours()/12>=1?"pm":"am";switch(r){case"a":case"aa":return n.toUpperCase();case"aaa":return n;case"aaaaa":return n[0];case"aaaa":default:return n==="am"?"a.m.":"p.m."}},h(t,r){return R(t.getHours()%12||12,r.length)},H(t,r){return R(t.getHours(),r.length)},m(t,r){return R(t.getMinutes(),r.length)},s(t,r){return R(t.getSeconds(),r.length)},S(t,r){const n=r.length,s=t.getMilliseconds(),a=Math.trunc(s*Math.pow(10,n-3));return R(a,r.length)}},je={midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},Pt={G:function(t,r,n){const s=t.getFullYear()>0?1:0;switch(r){case"G":case"GG":case"GGG":return n.era(s,{width:"abbreviated"});case"GGGGG":return n.era(s,{width:"narrow"});case"GGGG":default:return n.era(s,{width:"wide"})}},y:function(t,r,n){if(r==="yo"){const s=t.getFullYear(),a=s>0?s:1-s;return n.ordinalNumber(a,{unit:"year"})}return le.y(t,r)},Y:function(t,r,n,s){const a=Jt(t,s),i=a>0?a:1-a;if(r==="YY"){const l=i%100;return R(l,2)}return r==="Yo"?n.ordinalNumber(i,{unit:"year"}):R(i,r.length)},R:function(t,r){const n=Gt(t);return R(n,r.length)},u:function(t,r){const n=t.getFullYear();return R(n,r.length)},Q:function(t,r,n){const s=Math.ceil((t.getMonth()+1)/3);switch(r){case"Q":return String(s);case"QQ":return R(s,2);case"Qo":return n.ordinalNumber(s,{unit:"quarter"});case"QQQ":return n.quarter(s,{width:"abbreviated",context:"formatting"});case"QQQQQ":return n.quarter(s,{width:"narrow",context:"formatting"});case"QQQQ":default:return n.quarter(s,{width:"wide",context:"formatting"})}},q:function(t,r,n){const s=Math.ceil((t.getMonth()+1)/3);switch(r){case"q":return String(s);case"qq":return R(s,2);case"qo":return n.ordinalNumber(s,{unit:"quarter"});case"qqq":return n.quarter(s,{width:"abbreviated",context:"standalone"});case"qqqqq":return n.quarter(s,{width:"narrow",context:"standalone"});case"qqqq":default:return n.quarter(s,{width:"wide",context:"standalone"})}},M:function(t,r,n){const s=t.getMonth();switch(r){case"M":case"MM":return le.M(t,r);case"Mo":return n.ordinalNumber(s+1,{unit:"month"});case"MMM":return n.month(s,{width:"abbreviated",context:"formatting"});case"MMMMM":return n.month(s,{width:"narrow",context:"formatting"});case"MMMM":default:return n.month(s,{width:"wide",context:"formatting"})}},L:function(t,r,n){const s=t.getMonth();switch(r){case"L":return String(s+1);case"LL":return R(s+1,2);case"Lo":return n.ordinalNumber(s+1,{unit:"month"});case"LLL":return n.month(s,{width:"abbreviated",context:"standalone"});case"LLLLL":return n.month(s,{width:"narrow",context:"standalone"});case"LLLL":default:return n.month(s,{width:"wide",context:"standalone"})}},w:function(t,r,n,s){const a=Qr(t,s);return r==="wo"?n.ordinalNumber(a,{unit:"week"}):R(a,r.length)},I:function(t,r,n){const s=qr(t);return r==="Io"?n.ordinalNumber(s,{unit:"week"}):R(s,r.length)},d:function(t,r,n){return r==="do"?n.ordinalNumber(t.getDate(),{unit:"date"}):le.d(t,r)},D:function(t,r,n){const s=Yr(t);return r==="Do"?n.ordinalNumber(s,{unit:"dayOfYear"}):R(s,r.length)},E:function(t,r,n){const s=t.getDay();switch(r){case"E":case"EE":case"EEE":return n.day(s,{width:"abbreviated",context:"formatting"});case"EEEEE":return n.day(s,{width:"narrow",context:"formatting"});case"EEEEEE":return n.day(s,{width:"short",context:"formatting"});case"EEEE":default:return n.day(s,{width:"wide",context:"formatting"})}},e:function(t,r,n,s){const a=t.getDay(),i=(a-s.weekStartsOn+8)%7||7;switch(r){case"e":return String(i);case"ee":return R(i,2);case"eo":return n.ordinalNumber(i,{unit:"day"});case"eee":return n.day(a,{width:"abbreviated",context:"formatting"});case"eeeee":return n.day(a,{width:"narrow",context:"formatting"});case"eeeeee":return n.day(a,{width:"short",context:"formatting"});case"eeee":default:return n.day(a,{width:"wide",context:"formatting"})}},c:function(t,r,n,s){const a=t.getDay(),i=(a-s.weekStartsOn+8)%7||7;switch(r){case"c":return String(i);case"cc":return R(i,r.length);case"co":return n.ordinalNumber(i,{unit:"day"});case"ccc":return n.day(a,{width:"abbreviated",context:"standalone"});case"ccccc":return n.day(a,{width:"narrow",context:"standalone"});case"cccccc":return n.day(a,{width:"short",context:"standalone"});case"cccc":default:return n.day(a,{width:"wide",context:"standalone"})}},i:function(t,r,n){const s=t.getDay(),a=s===0?7:s;switch(r){case"i":return String(a);case"ii":return R(a,r.length);case"io":return n.ordinalNumber(a,{unit:"day"});case"iii":return n.day(s,{width:"abbreviated",context:"formatting"});case"iiiii":return n.day(s,{width:"narrow",context:"formatting"});case"iiiiii":return n.day(s,{width:"short",context:"formatting"});case"iiii":default:return n.day(s,{width:"wide",context:"formatting"})}},a:function(t,r,n){const a=t.getHours()/12>=1?"pm":"am";switch(r){case"a":case"aa":return n.dayPeriod(a,{width:"abbreviated",context:"formatting"});case"aaa":return n.dayPeriod(a,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return n.dayPeriod(a,{width:"narrow",context:"formatting"});case"aaaa":default:return n.dayPeriod(a,{width:"wide",context:"formatting"})}},b:function(t,r,n){const s=t.getHours();let a;switch(s===12?a=je.noon:s===0?a=je.midnight:a=s/12>=1?"pm":"am",r){case"b":case"bb":return n.dayPeriod(a,{width:"abbreviated",context:"formatting"});case"bbb":return n.dayPeriod(a,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return n.dayPeriod(a,{width:"narrow",context:"formatting"});case"bbbb":default:return n.dayPeriod(a,{width:"wide",context:"formatting"})}},B:function(t,r,n){const s=t.getHours();let a;switch(s>=17?a=je.evening:s>=12?a=je.afternoon:s>=4?a=je.morning:a=je.night,r){case"B":case"BB":case"BBB":return n.dayPeriod(a,{width:"abbreviated",context:"formatting"});case"BBBBB":return n.dayPeriod(a,{width:"narrow",context:"formatting"});case"BBBB":default:return n.dayPeriod(a,{width:"wide",context:"formatting"})}},h:function(t,r,n){if(r==="ho"){let s=t.getHours()%12;return s===0&&(s=12),n.ordinalNumber(s,{unit:"hour"})}return le.h(t,r)},H:function(t,r,n){return r==="Ho"?n.ordinalNumber(t.getHours(),{unit:"hour"}):le.H(t,r)},K:function(t,r,n){const s=t.getHours()%12;return r==="Ko"?n.ordinalNumber(s,{unit:"hour"}):R(s,r.length)},k:function(t,r,n){let s=t.getHours();return s===0&&(s=24),r==="ko"?n.ordinalNumber(s,{unit:"hour"}):R(s,r.length)},m:function(t,r,n){return r==="mo"?n.ordinalNumber(t.getMinutes(),{unit:"minute"}):le.m(t,r)},s:function(t,r,n){return r==="so"?n.ordinalNumber(t.getSeconds(),{unit:"second"}):le.s(t,r)},S:function(t,r){return le.S(t,r)},X:function(t,r,n){const s=t.getTimezoneOffset();if(s===0)return"Z";switch(r){case"X":return Wt(s);case"XXXX":case"XX":return me(s);case"XXXXX":case"XXX":default:return me(s,":")}},x:function(t,r,n){const s=t.getTimezoneOffset();switch(r){case"x":return Wt(s);case"xxxx":case"xx":return me(s);case"xxxxx":case"xxx":default:return me(s,":")}},O:function(t,r,n){const s=t.getTimezoneOffset();switch(r){case"O":case"OO":case"OOO":return"GMT"+Tt(s,":");case"OOOO":default:return"GMT"+me(s,":")}},z:function(t,r,n){const s=t.getTimezoneOffset();switch(r){case"z":case"zz":case"zzz":return"GMT"+Tt(s,":");case"zzzz":default:return"GMT"+me(s,":")}},t:function(t,r,n){const s=Math.trunc(+t/1e3);return R(s,r.length)},T:function(t,r,n){return R(+t,r.length)}};function Tt(t,r=""){const n=t>0?"-":"+",s=Math.abs(t),a=Math.trunc(s/60),i=s%60;return i===0?n+String(a):n+String(a)+r+R(i,2)}function Wt(t,r){return t%60===0?(t>0?"-":"+")+R(Math.abs(t)/60,2):me(t,r)}function me(t,r=""){const n=t>0?"-":"+",s=Math.abs(t),a=R(Math.trunc(s/60),2),i=R(s%60,2);return n+a+r+i}const Dt=(t,r)=>{switch(t){case"P":return r.date({width:"short"});case"PP":return r.date({width:"medium"});case"PPP":return r.date({width:"long"});case"PPPP":default:return r.date({width:"full"})}},Vt=(t,r)=>{switch(t){case"p":return r.time({width:"short"});case"pp":return r.time({width:"medium"});case"ppp":return r.time({width:"long"});case"pppp":default:return r.time({width:"full"})}},Jr=(t,r)=>{const n=t.match(/(P+)(p+)?/)||[],s=n[1],a=n[2];if(!a)return Dt(t,r);let i;switch(s){case"P":i=r.dateTime({width:"short"});break;case"PP":i=r.dateTime({width:"medium"});break;case"PPP":i=r.dateTime({width:"long"});break;case"PPPP":default:i=r.dateTime({width:"full"});break}return i.replace("{{date}}",Dt(s,r)).replace("{{time}}",Vt(a,r))},Vr={p:Vt,P:Jr},Xr=/^D+$/,Kr=/^Y+$/,Zr=["D","DD","YY","YYYY"];function es(t){return Xr.test(t)}function ts(t){return Kr.test(t)}function ns(t,r,n){const s=rs(t,r,n);if(console.warn(s),Zr.includes(t))throw new RangeError(s)}function rs(t,r,n){const s=t[0]==="Y"?"years":"days of the month";return`Use \`${t.toLowerCase()}\` instead of \`${t}\` (in \`${r}\`) for formatting ${s} to the input \`${n}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}const ss=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,as=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,is=/^'([^]*?)'?$/,os=/''/g,ls=/[a-zA-Z]/;function Ze(t,r,n){var o,w,_,m,g,C,S,O;const s=st(),a=(n==null?void 0:n.locale)??s.locale??Hr,i=(n==null?void 0:n.firstWeekContainsDate)??((w=(o=n==null?void 0:n.locale)==null?void 0:o.options)==null?void 0:w.firstWeekContainsDate)??s.firstWeekContainsDate??((m=(_=s.locale)==null?void 0:_.options)==null?void 0:m.firstWeekContainsDate)??1,l=(n==null?void 0:n.weekStartsOn)??((C=(g=n==null?void 0:n.locale)==null?void 0:g.options)==null?void 0:C.weekStartsOn)??s.weekStartsOn??((O=(S=s.locale)==null?void 0:S.options)==null?void 0:O.weekStartsOn)??0,d=J(t,n==null?void 0:n.in);if(!ur(d))throw new RangeError("Invalid time value");let f=r.match(as).map(y=>{const v=y[0];if(v==="p"||v==="P"){const k=Vr[v];return k(y,a.formatLong)}return y}).join("").match(ss).map(y=>{if(y==="''")return{isToken:!1,value:"'"};const v=y[0];if(v==="'")return{isToken:!1,value:cs(y)};if(Pt[v])return{isToken:!0,value:y};if(v.match(ls))throw new RangeError("Format string contains an unescaped latin alphabet character `"+v+"`");return{isToken:!1,value:y}});a.localize.preprocessor&&(f=a.localize.preprocessor(d,f));const b={firstWeekContainsDate:i,weekStartsOn:l,locale:a};return f.map(y=>{if(!y.isToken)return y.value;const v=y.value;(!(n!=null&&n.useAdditionalWeekYearTokens)&&ts(v)||!(n!=null&&n.useAdditionalDayOfYearTokens)&&es(v))&&ns(v,r,String(t));const k=Pt[v[0]];return k(d,v,a.localize,b)}).join("")}function cs(t){const r=t.match(is);return r?r[1].replace(os,"'"):t}const zt={lessThanXSeconds:{standalone:{one:"weniger als 1 Sekunde",other:"weniger als {{count}} Sekunden"},withPreposition:{one:"weniger als 1 Sekunde",other:"weniger als {{count}} Sekunden"}},xSeconds:{standalone:{one:"1 Sekunde",other:"{{count}} Sekunden"},withPreposition:{one:"1 Sekunde",other:"{{count}} Sekunden"}},halfAMinute:{standalone:"eine halbe Minute",withPreposition:"einer halben Minute"},lessThanXMinutes:{standalone:{one:"weniger als 1 Minute",other:"weniger als {{count}} Minuten"},withPreposition:{one:"weniger als 1 Minute",other:"weniger als {{count}} Minuten"}},xMinutes:{standalone:{one:"1 Minute",other:"{{count}} Minuten"},withPreposition:{one:"1 Minute",other:"{{count}} Minuten"}},aboutXHours:{standalone:{one:"etwa 1 Stunde",other:"etwa {{count}} Stunden"},withPreposition:{one:"etwa 1 Stunde",other:"etwa {{count}} Stunden"}},xHours:{standalone:{one:"1 Stunde",other:"{{count}} Stunden"},withPreposition:{one:"1 Stunde",other:"{{count}} Stunden"}},xDays:{standalone:{one:"1 Tag",other:"{{count}} Tage"},withPreposition:{one:"1 Tag",other:"{{count}} Tagen"}},aboutXWeeks:{standalone:{one:"etwa 1 Woche",other:"etwa {{count}} Wochen"},withPreposition:{one:"etwa 1 Woche",other:"etwa {{count}} Wochen"}},xWeeks:{standalone:{one:"1 Woche",other:"{{count}} Wochen"},withPreposition:{one:"1 Woche",other:"{{count}} Wochen"}},aboutXMonths:{standalone:{one:"etwa 1 Monat",other:"etwa {{count}} Monate"},withPreposition:{one:"etwa 1 Monat",other:"etwa {{count}} Monaten"}},xMonths:{standalone:{one:"1 Monat",other:"{{count}} Monate"},withPreposition:{one:"1 Monat",other:"{{count}} Monaten"}},aboutXYears:{standalone:{one:"etwa 1 Jahr",other:"etwa {{count}} Jahre"},withPreposition:{one:"etwa 1 Jahr",other:"etwa {{count}} Jahren"}},xYears:{standalone:{one:"1 Jahr",other:"{{count}} Jahre"},withPreposition:{one:"1 Jahr",other:"{{count}} Jahren"}},overXYears:{standalone:{one:"mehr als 1 Jahr",other:"mehr als {{count}} Jahre"},withPreposition:{one:"mehr als 1 Jahr",other:"mehr als {{count}} Jahren"}},almostXYears:{standalone:{one:"fast 1 Jahr",other:"fast {{count}} Jahre"},withPreposition:{one:"fast 1 Jahr",other:"fast {{count}} Jahren"}}},ds=(t,r,n)=>{let s;const a=n!=null&&n.addSuffix?zt[t].withPreposition:zt[t].standalone;return typeof a=="string"?s=a:r===1?s=a.one:s=a.other.replace("{{count}}",String(r)),n!=null&&n.addSuffix?n.comparison&&n.comparison>0?"in "+s:"vor "+s:s},us={full:"EEEE, do MMMM y",long:"do MMMM y",medium:"do MMM y",short:"dd.MM.y"},hs={full:"HH:mm:ss zzzz",long:"HH:mm:ss z",medium:"HH:mm:ss",short:"HH:mm"},ms={full:"{{date}} 'um' {{time}}",long:"{{date}} 'um' {{time}}",medium:"{{date}} {{time}}",short:"{{date}} {{time}}"},gs={date:Ce({formats:us,defaultWidth:"full"}),time:Ce({formats:hs,defaultWidth:"full"}),dateTime:Ce({formats:ms,defaultWidth:"full"})},fs={lastWeek:"'letzten' eeee 'um' p",yesterday:"'gestern um' p",today:"'heute um' p",tomorrow:"'morgen um' p",nextWeek:"eeee 'um' p",other:"P"},xs=(t,r,n,s)=>fs[t],ps={narrow:["v.Chr.","n.Chr."],abbreviated:["v.Chr.","n.Chr."],wide:["vor Christus","nach Christus"]},ys={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1. Quartal","2. Quartal","3. Quartal","4. Quartal"]},dt={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","MÃ¤r","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"],wide:["Januar","Februar","MÃ¤rz","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"]},bs={narrow:dt.narrow,abbreviated:["Jan.","Feb.","MÃ¤rz","Apr.","Mai","Juni","Juli","Aug.","Sep.","Okt.","Nov.","Dez."],wide:dt.wide},js={narrow:["S","M","D","M","D","F","S"],short:["So","Mo","Di","Mi","Do","Fr","Sa"],abbreviated:["So.","Mo.","Di.","Mi.","Do.","Fr.","Sa."],wide:["Sonntag","Montag","Dienstag","Mittwoch","Donnerstag","Freitag","Samstag"]},ws={narrow:{am:"vm.",pm:"nm.",midnight:"Mitternacht",noon:"Mittag",morning:"Morgen",afternoon:"Nachm.",evening:"Abend",night:"Nacht"},abbreviated:{am:"vorm.",pm:"nachm.",midnight:"Mitternacht",noon:"Mittag",morning:"Morgen",afternoon:"Nachmittag",evening:"Abend",night:"Nacht"},wide:{am:"vormittags",pm:"nachmittags",midnight:"Mitternacht",noon:"Mittag",morning:"Morgen",afternoon:"Nachmittag",evening:"Abend",night:"Nacht"}},vs={narrow:{am:"vm.",pm:"nm.",midnight:"Mitternacht",noon:"Mittag",morning:"morgens",afternoon:"nachm.",evening:"abends",night:"nachts"},abbreviated:{am:"vorm.",pm:"nachm.",midnight:"Mitternacht",noon:"Mittag",morning:"morgens",afternoon:"nachmittags",evening:"abends",night:"nachts"},wide:{am:"vormittags",pm:"nachmittags",midnight:"Mitternacht",noon:"Mittag",morning:"morgens",afternoon:"nachmittags",evening:"abends",night:"nachts"}},Cs=t=>Number(t)+".",Ss={ordinalNumber:Cs,era:Z({values:ps,defaultWidth:"wide"}),quarter:Z({values:ys,defaultWidth:"wide",argumentCallback:t=>t-1}),month:Z({values:dt,formattingValues:bs,defaultWidth:"wide"}),day:Z({values:js,defaultWidth:"wide"}),dayPeriod:Z({values:ws,defaultWidth:"wide",formattingValues:vs,defaultFormattingWidth:"wide"})},ks=/^(\d+)(\.)?/i,_s=/\d+/i,Ms={narrow:/^(v\.? ?Chr\.?|n\.? ?Chr\.?)/i,abbreviated:/^(v\.? ?Chr\.?|n\.? ?Chr\.?)/i,wide:/^(vor Christus|vor unserer Zeitrechnung|nach Christus|unserer Zeitrechnung)/i},Ps={any:[/^v/i,/^n/i]},Ts={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](\.)? Quartal/i},Ws={any:[/1/i,/2/i,/3/i,/4/i]},Ds={narrow:/^[jfmasond]/i,abbreviated:/^(j[aÃ¤]n|feb|mÃ¤r[z]?|apr|mai|jun[i]?|jul[i]?|aug|sep|okt|nov|dez)\.?/i,wide:/^(januar|februar|mÃ¤rz|april|mai|juni|juli|august|september|oktober|november|dezember)/i},zs={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^j[aÃ¤]/i,/^f/i,/^mÃ¤r/i,/^ap/i,/^mai/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},As={narrow:/^[smdmf]/i,short:/^(so|mo|di|mi|do|fr|sa)/i,abbreviated:/^(son?|mon?|die?|mit?|don?|fre?|sam?)\.?/i,wide:/^(sonntag|montag|dienstag|mittwoch|donnerstag|freitag|samstag)/i},Rs={any:[/^so/i,/^mo/i,/^di/i,/^mi/i,/^do/i,/^f/i,/^sa/i]},Os={narrow:/^(vm\.?|nm\.?|Mitternacht|Mittag|morgens|nachm\.?|abends|nachts)/i,abbreviated:/^(vorm\.?|nachm\.?|Mitternacht|Mittag|morgens|nachm\.?|abends|nachts)/i,wide:/^(vormittags|nachmittags|Mitternacht|Mittag|morgens|nachmittags|abends|nachts)/i},Es={any:{am:/^v/i,pm:/^n/i,midnight:/^Mitte/i,noon:/^Mitta/i,morning:/morgens/i,afternoon:/nachmittags/i,evening:/abends/i,night:/nachts/i}},Bs={ordinalNumber:Qt({matchPattern:ks,parsePattern:_s,valueCallback:t=>parseInt(t)}),era:ee({matchPatterns:Ms,defaultMatchWidth:"wide",parsePatterns:Ps,defaultParseWidth:"any"}),quarter:ee({matchPatterns:Ts,defaultMatchWidth:"wide",parsePatterns:Ws,defaultParseWidth:"any",valueCallback:t=>t+1}),month:ee({matchPatterns:Ds,defaultMatchWidth:"wide",parsePatterns:zs,defaultParseWidth:"any"}),day:ee({matchPatterns:As,defaultMatchWidth:"wide",parsePatterns:Rs,defaultParseWidth:"any"}),dayPeriod:ee({matchPatterns:Os,defaultMatchWidth:"wide",parsePatterns:Es,defaultParseWidth:"any"})},et={code:"de",formatDistance:ds,formatLong:gs,formatRelative:xs,localize:Ss,match:Bs,options:{weekStartsOn:1,firstWeekContainsDate:4}},Is=()=>{const t=We(),r=De(t.breakpoints.down("md")),{donations:n,loading:s,error:a,refresh:i,totalDonations:l,totalCredits:d}=sr(),[f,b]=h.useState(!1),o=async()=>{b(!0),await i(),b(!1)},w=g=>{switch(g){case"completed":return"success";case"pending":return"warning";case"failed":return"error";case"refunded":return"default";default:return"default"}},_=g=>g==="community_pot"?"Community-Topf":"PersÃ¶nliche Credits",m=g=>g==="community_pot"?"primary":"secondary";return s&&!f?e.jsx(j,{sx:{display:"flex",justifyContent:"center",py:8},children:e.jsx(ie,{})}):a?e.jsx(U,{severity:"error",sx:{mb:3},children:a}):e.jsxs(j,{children:[e.jsxs(j,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsx(u,{variant:"h5",fontWeight:700,children:"Spenden-Ãœbersicht"}),e.jsx(tt,{title:"Aktualisieren",children:e.jsx(pe,{onClick:o,disabled:f,children:e.jsx(Yt,{size:20,className:f?"animate-spin":""})})})]}),e.jsxs(Ft,{direction:{xs:"column",sm:"row"},spacing:2,sx:{mb:3},children:[e.jsx(se,{sx:{flex:1},children:e.jsxs(ae,{children:[e.jsxs(j,{sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:[e.jsx(mt,{size:20,color:t.palette.primary.main}),e.jsx(u,{variant:"body2",color:"text.secondary",children:"Gesamtspenden"})]}),e.jsx(u,{variant:"h4",fontWeight:700,children:ge(l)})]})}),e.jsx(se,{sx:{flex:1},children:e.jsxs(ae,{children:[e.jsxs(j,{sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:[e.jsx(kn,{size:20,color:t.palette.success.main}),e.jsx(u,{variant:"body2",color:"text.secondary",children:"Credits vergeben"})]}),e.jsx(u,{variant:"h4",fontWeight:700,children:L(d)})]})}),e.jsx(se,{sx:{flex:1},children:e.jsxs(ae,{children:[e.jsxs(j,{sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:[e.jsx(nt,{size:20,color:t.palette.info.main}),e.jsx(u,{variant:"body2",color:"text.secondary",children:"Anzahl Spenden"})]}),e.jsx(u,{variant:"h4",fontWeight:700,children:L(n.length)})]})})]}),n.length===0?e.jsx(U,{severity:"info",children:"Noch keine Spenden vorhanden."}):e.jsx($e,{component:Y,children:e.jsxs(Ie,{size:r?"small":"medium",children:[e.jsx(Le,{children:e.jsxs(q,{children:[e.jsx(x,{children:"Datum"}),!r&&e.jsx(x,{children:"Benutzer"}),e.jsx(x,{align:"right",children:"Betrag"}),e.jsx(x,{align:"center",children:"Credits"}),e.jsx(x,{align:"center",children:"Typ"}),e.jsx(x,{align:"center",children:"Status"})]})}),e.jsx(Fe,{children:n.map(g=>{var C,S;return e.jsxs(q,{hover:!0,children:[e.jsxs(x,{children:[e.jsx(u,{variant:"body2",children:Ze(new Date(g.created_at),"dd.MM.yyyy",{locale:et})}),e.jsxs(u,{variant:"caption",color:"text.secondary",children:[Ze(new Date(g.created_at),"HH:mm",{locale:et})," Uhr"]})]}),!r&&e.jsxs(x,{children:[e.jsx(u,{variant:"body2",children:((C=g.profiles)==null?void 0:C.full_name)||"Unbekannt"}),e.jsx(u,{variant:"caption",color:"text.secondary",children:(S=g.profiles)==null?void 0:S.email})]}),e.jsx(x,{align:"right",children:e.jsx(u,{variant:"body2",fontWeight:600,children:ge(Number(g.amount))})}),e.jsx(x,{align:"center",children:e.jsx(I,{label:L(g.credits_granted),size:"small",color:"success",variant:"outlined"})}),e.jsx(x,{align:"center",children:e.jsx(I,{label:_(g.donation_type),size:"small",color:m(g.donation_type)})}),e.jsx(x,{align:"center",children:e.jsx(I,{label:g.status,size:"small",color:w(g.status)})})]},g.id)})})]})})]})},Fs=()=>{const[t,r]=h.useState(!1),[n,s]=h.useState(null);return{grantPersonalCredits:async({userId:l,amount:d,euroAmount:f,pricePerUnit:b})=>{try{r(!0),s(null);const{data:o,error:w}=await A.from("profiles").select("personal_credits").eq("id",l).single();if(w)throw w;const _=(o.personal_credits||0)+d,{error:m}=await A.from("profiles").update({personal_credits:_,updated_at:new Date().toISOString()}).eq("id",l);if(m)throw m;const{error:g}=await A.from("donations").insert({user_id:l,amount:f,price_per_unit:b,donation_type:"personal_credits",credits_granted:d,status:"completed",stripe_payment_id:`admin_grant_${Date.now()}`});if(g)throw g;return{success:!0,newCredits:_}}catch(o){const w=o instanceof Error?o.message:"Failed to grant credits";throw s(w),console.error("Error granting personal credits:",o),o}finally{r(!1)}},addToCommunityPot:async({amount:l,euroAmount:d,pricePerUnit:f,reason:b,userId:o})=>{try{r(!0),s(null);const{data:w,error:_}=await A.from("credit_system_settings").select("setting_value").eq("setting_key","community_pot_balance").single();if(_)throw _;const g=parseInt(w.setting_value||"0")+l,{error:C}=await A.from("credit_system_settings").update({setting_value:g.toString(),updated_at:new Date().toISOString()}).eq("setting_key","community_pot_balance");if(C)throw C;if(o){const{error:O}=await A.from("donations").insert({user_id:o,amount:d,price_per_unit:f,donation_type:"community_pot",credits_granted:l,status:"completed",stripe_payment_id:`admin_community_${Date.now()}`});if(O)throw O}const{error:S}=await A.from("community_pot_transactions").insert({transaction_type:"adjustment",user_id:o||null,amount:l,balance_after:g,description:b||`Admin adjustment: +${l} credits`});if(S)throw S;return{success:!0,newBalance:g}}catch(w){const _=w instanceof Error?w.message:"Failed to add to community pot";throw s(_),console.error("Error adding to community pot:",w),w}finally{r(!1)}},loading:t,error:n}},$s=()=>{const{grantPersonalCredits:t,addToCommunityPot:r,loading:n}=Fs(),{settings:s,loading:a}=Nt(),[i,l]=h.useState("personal"),[d,f]=h.useState(null),[b,o]=h.useState([]),[w,_]=h.useState(!1),[m,g]=h.useState(5),[C,S]=h.useState(""),[O,y]=h.useState(null),k=(()=>{if(!s||m<=0)return 0;const z=i==="community"?s.costPerListing:s.powerUserCreditPrice;return Math.floor(m/z)})(),D=async z=>{if(!z||z.length<2){o([]);return}try{_(!0);const{data:H,error:V}=await A.from("profiles").select("id, email, full_name").or(`email.ilike.%${z}%,full_name.ilike.%${z}%`).limit(10);if(V)throw V;o(H||[])}catch(H){console.error("Error searching users:",H)}finally{_(!1)}},F=async()=>{if(y(null),i==="personal"&&!d){y({type:"error",text:"Bitte wÃ¤hle einen Benutzer aus."});return}if(m<=0){y({type:"error",text:"Betrag muss grÃ¶ÃŸer als 0 sein."});return}if(k<=0){y({type:"error",text:"Der eingegebene Betrag ergibt 0 Credits. Bitte erhÃ¶he den Betrag."});return}try{const z=i==="community"?s.costPerListing:s.powerUserCreditPrice;if(i==="personal")await t({userId:d.id,amount:k,euroAmount:m,pricePerUnit:z,reason:C||void 0}),y({type:"success",text:`Erfolgreich ${L(k)} Credits (${ge(m)}) an ${d.full_name||d.email} vergeben!`});else{await r({amount:k,euroAmount:m,pricePerUnit:z,reason:C||void 0,userId:(d==null?void 0:d.id)||void 0});const H=d?` von ${d.full_name||d.email}`:"";y({type:"success",text:`Erfolgreich ${L(k)} Inserate (${ge(m)})${H} zum Community-Topf hinzugefÃ¼gt!`})}g(5),S(""),f(null)}catch(z){y({type:"error",text:z instanceof Error?z.message:"Fehler beim Vergeben der Credits"})}};return e.jsxs(j,{children:[e.jsx(u,{variant:"h5",fontWeight:700,gutterBottom:!0,sx:{mb:3},children:"Manuelle Credit-Vergabe"}),e.jsxs(Y,{sx:{p:3},children:[O&&e.jsx(U,{severity:O.type,sx:{mb:3},onClose:()=>y(null),children:O.text}),e.jsxs(Ft,{spacing:3,children:[e.jsxs(j,{children:[e.jsx(on,{component:"legend",sx:{mb:1,fontWeight:600},children:"Vergabe-Typ"}),e.jsxs(_n,{row:!0,value:i,onChange:z=>l(z.target.value),children:[e.jsx(xt,{value:"personal",control:e.jsx(pt,{}),label:e.jsxs(j,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(ct,{size:18}),"PersÃ¶nliche Credits"]})}),e.jsx(xt,{value:"community",control:e.jsx(pt,{}),label:e.jsxs(j,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(mt,{size:18}),"Community-Topf"]})})]})]}),e.jsx(Ee,{}),e.jsx(ln,{options:b,loading:w,value:d,onChange:(z,H)=>f(H),onInputChange:(z,H)=>D(H),getOptionLabel:z=>`${z.full_name||"Kein Name"} (${z.email})`,renderInput:z=>e.jsx(N,{...z,label:i==="personal"?"Benutzer auswÃ¤hlen *":"Spender verknÃ¼pfen (optional)",placeholder:"Suche nach Name oder E-Mail...",helperText:i==="personal"?"Gib mindestens 2 Zeichen ein um zu suchen":"ðŸ’¡ Optional: VerknÃ¼pfe die Spende mit einem User fÃ¼r Dankesliste, Nominierungen & Marketing",InputProps:{...z.InputProps,endAdornment:e.jsxs(e.Fragment,{children:[w?e.jsx(ie,{size:20}):null,z.InputProps.endAdornment]})}})}),e.jsx(N,{fullWidth:!0,label:"Betrag in Euro",type:"number",value:m,onChange:z=>g(parseFloat(z.target.value)||0),helperText:"Gib den Euro-Betrag ein - die Credits werden automatisch berechnet",inputProps:{min:.01,step:.01},InputProps:{startAdornment:e.jsx(ce,{position:"start",children:"â‚¬"})}}),!a&&m>0&&e.jsx(se,{sx:{bgcolor:k>0?"success.main":"warning.main",color:"white",borderRadius:2,boxShadow:3},children:e.jsxs(ae,{sx:{py:2},children:[e.jsxs(j,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:1},children:[e.jsxs(j,{sx:{display:"flex",alignItems:"center",gap:1.5},children:[e.jsx($t,{size:24,strokeWidth:2.5}),e.jsxs(u,{variant:"h6",fontWeight:700,children:[L(k)," ",i==="community"?"Inserate":"Credits"]})]}),e.jsx(u,{variant:"body2",fontWeight:600,sx:{bgcolor:"rgba(255, 255, 255, 0.25)",px:1.5,py:.5,borderRadius:1},children:ge(m)})]}),e.jsxs(u,{variant:"body2",sx:{opacity:.95,fontWeight:500},children:["Berechnung: ",ge(m)," Ã· ",ge(i==="community"?(s==null?void 0:s.costPerListing)||0:(s==null?void 0:s.powerUserCreditPrice)||0)," = ",L(k)," ",i==="community"?"Inserate":"Credits",k===0&&e.jsx(j,{component:"span",sx:{bgcolor:"rgba(255, 255, 255, 0.9)",color:"warning.dark",fontWeight:700,ml:1,px:1,py:.25,borderRadius:.5},children:"âš ï¸ Betrag zu niedrig"})]})]})}),e.jsx(N,{fullWidth:!0,label:"Grund (optional)",multiline:!0,rows:3,value:C,onChange:z=>S(z.target.value),placeholder:"Z.B. Bonus fÃ¼r aktive Community-Teilnahme",helperText:"Optionale BegrÃ¼ndung fÃ¼r die Credit-Vergabe"}),e.jsx(j,{sx:{display:"flex",justifyContent:"flex-end",gap:2},children:e.jsx(K,{variant:"contained",size:"large",onClick:F,disabled:n||a||k<=0||i==="personal"&&!d,startIcon:n?e.jsx(ie,{size:20,color:"inherit"}):e.jsx(ct,{size:20}),children:n?"Vergebe Credits...":`${L(k)} ${i==="community"?"Inserate":"Credits"} vergeben`})})]})]})]})},Ls=(t={})=>{const{limit:r=100,transactionType:n,autoFetch:s=!0}=t,[a,i]=h.useState([]),[l,d]=h.useState(!0),[f,b]=h.useState(null),o=async()=>{try{d(!0),b(null);let m=A.from("community_pot_transactions").select(`
          *,
          user:profiles!user_id (
            id,
            full_name,
            email
          ),
          item:items!item_id (
            id,
            title
          )
        `).order("created_at",{ascending:!1}).limit(r);n&&(m=m.eq("transaction_type",n));const{data:g,error:C}=await m;if(C)throw C;i(g||[])}catch(m){const g=m instanceof Error?m.message:"Failed to load transactions";b(g),console.error("Error fetching community pot transactions:",m)}finally{d(!1)}};h.useEffect(()=>{s&&o()},[r,n,s]);const w=()=>a.filter(m=>m.transaction_type==="donation").reduce((m,g)=>m+g.amount,0),_=()=>Math.abs(a.filter(m=>m.transaction_type==="usage").reduce((m,g)=>m+g.amount,0));return{transactions:a,loading:l,error:f,refresh:o,totalDonations:w(),totalUsage:_()}},Ns=()=>{const t=We(),r=De(t.breakpoints.down("md")),[n,s]=h.useState("all"),[a,i]=h.useState(!1),{transactions:l,loading:d,error:f,refresh:b,totalDonations:o,totalUsage:w}=Ls({transactionType:n==="all"?void 0:n}),_=async()=>{i(!0),await b(),i(!1)},m=S=>{switch(S){case"donation":return"Spende";case"usage":return"Nutzung";case"adjustment":return"Anpassung";default:return S}},g=S=>{switch(S){case"donation":return"success";case"usage":return"error";case"adjustment":return"warning";default:return"default"}},C=S=>{switch(S){case"donation":return e.jsx($t,{size:16});case"usage":return e.jsx(tr,{size:16});case"adjustment":return e.jsx(Ht,{size:16});default:return}};return d&&!a?e.jsx(j,{sx:{display:"flex",justifyContent:"center",py:8},children:e.jsx(ie,{})}):f?e.jsx(U,{severity:"error",sx:{mb:3},children:f}):e.jsxs(j,{children:[e.jsxs(j,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3,flexDirection:{xs:"column",sm:"row"},gap:2},children:[e.jsx(u,{variant:"h5",fontWeight:700,children:"Community-Topf Transaktionen"}),e.jsx(tt,{title:"Aktualisieren",children:e.jsx(pe,{onClick:_,disabled:a,children:e.jsx(Yt,{size:20,className:a?"animate-spin":""})})})]}),e.jsx(j,{sx:{mb:3},children:e.jsxs(cn,{value:n,exclusive:!0,onChange:(S,O)=>{O!==null&&s(O)},size:"small",fullWidth:r,children:[e.jsx(Ye,{value:"all",children:"Alle"}),e.jsx(Ye,{value:"donation",children:"Spenden"}),e.jsx(Ye,{value:"usage",children:"Nutzung"}),e.jsx(Ye,{value:"adjustment",children:"Anpassungen"})]})}),e.jsxs(Y,{elevation:1,sx:{p:2,mb:3,display:"flex",gap:3,flexDirection:{xs:"column",sm:"row"}},children:[e.jsxs(j,{sx:{flex:1},children:[e.jsx(u,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:"Gesamte Spenden"}),e.jsxs(u,{variant:"h5",fontWeight:700,color:"success.main",children:["+",L(o)]})]}),e.jsxs(j,{sx:{flex:1},children:[e.jsx(u,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:"Gesamte Nutzung"}),e.jsxs(u,{variant:"h5",fontWeight:700,color:"error.main",children:["-",L(w)]})]}),e.jsxs(j,{sx:{flex:1},children:[e.jsx(u,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:"Netto"}),e.jsx(u,{variant:"h5",fontWeight:700,children:L(o-w)})]})]}),l.length===0?e.jsx(U,{severity:"info",children:"Keine Transaktionen vorhanden."}):e.jsx($e,{component:Y,children:e.jsxs(Ie,{size:r?"small":"medium",children:[e.jsx(Le,{children:e.jsxs(q,{children:[e.jsx(x,{children:"Datum"}),!r&&e.jsx(x,{children:"Benutzer"}),e.jsx(x,{align:"center",children:"Typ"}),e.jsx(x,{align:"right",children:"Betrag"}),e.jsx(x,{align:"right",children:"Saldo danach"}),!r&&e.jsx(x,{children:"Beschreibung"})]})}),e.jsx(Fe,{children:l.map(S=>{var O,y;return e.jsxs(q,{hover:!0,children:[e.jsxs(x,{children:[e.jsx(u,{variant:"body2",children:Ze(new Date(S.created_at),"dd.MM.yyyy",{locale:et})}),e.jsxs(u,{variant:"caption",color:"text.secondary",children:[Ze(new Date(S.created_at),"HH:mm",{locale:et})," Uhr"]})]}),!r&&e.jsxs(x,{children:[e.jsx(u,{variant:"body2",children:((O=S.profiles)==null?void 0:O.full_name)||"System"}),((y=S.profiles)==null?void 0:y.email)&&e.jsx(u,{variant:"caption",color:"text.secondary",children:S.profiles.email})]}),e.jsx(x,{align:"center",children:e.jsx(I,{icon:C(S.transaction_type),label:m(S.transaction_type),size:"small",color:g(S.transaction_type)})}),e.jsx(x,{align:"right",children:e.jsxs(u,{variant:"body2",fontWeight:600,color:S.amount>0?"success.main":S.amount<0?"error.main":"text.primary",children:[S.amount>0?"+":"",L(S.amount)]})}),e.jsx(x,{align:"right",children:e.jsx(I,{label:L(S.balance_after),size:"small",variant:"outlined"})}),!r&&e.jsxs(x,{children:[e.jsx(u,{variant:"body2",color:"text.secondary",children:S.description||"-"}),S.items&&e.jsxs(u,{variant:"caption",color:"text.secondary",children:["Inserat: ",S.items.title]})]})]},S.id)})})]})})]})},Us=()=>{const[t,r]=h.useState(0);return e.jsxs(j,{children:[e.jsx(Y,{sx:{mb:3},children:e.jsxs(lt,{value:t,onChange:(n,s)=>r(s),variant:"scrollable",scrollButtons:"auto",sx:{borderBottom:1,borderColor:"divider"},children:[e.jsx(X,{icon:e.jsx(dn,{size:18}),label:"Einstellungen",iconPosition:"start",sx:{textTransform:"none",minHeight:48}}),e.jsx(X,{icon:e.jsx(mt,{size:18}),label:"Spenden",iconPosition:"start",sx:{textTransform:"none",minHeight:48}}),e.jsx(X,{icon:e.jsx(ct,{size:18}),label:"Credits vergeben",iconPosition:"start",sx:{textTransform:"none",minHeight:48}}),e.jsx(X,{icon:e.jsx(un,{size:18}),label:"Transaktionen",iconPosition:"start",sx:{textTransform:"none",minHeight:48}})]})}),t===0&&e.jsx(Hs,{}),t===1&&e.jsx(Is,{}),t===2&&e.jsx($s,{}),t===3&&e.jsx(Ns,{})]})},Hs=()=>{const t=We(),r=De(t.breakpoints.down("md")),{settings:n,loading:s,error:a,updateSetting:i}=Nt(),[l,d]=h.useState(!1),[f,b]=h.useState(null),[o,w]=h.useState({dailyFreeListings:(n==null?void 0:n.dailyFreeListings)||5,costPerListing:(n==null?void 0:n.costPerListing)||.2,powerUserCreditPrice:(n==null?void 0:n.powerUserCreditPrice)||.2,minDonationAmount:(n==null?void 0:n.minDonationAmount)||5,powerUserMinPurchase:(n==null?void 0:n.powerUserMinPurchase)||10,lowPotWarningThreshold:(n==null?void 0:n.lowPotWarningThreshold)||100});h.useEffect(()=>{n&&w({dailyFreeListings:n.dailyFreeListings,costPerListing:n.costPerListing,powerUserCreditPrice:n.powerUserCreditPrice,minDonationAmount:n.minDonationAmount,powerUserMinPurchase:n.powerUserMinPurchase,lowPotWarningThreshold:n.lowPotWarningThreshold})},[n]);const _=async()=>{try{d(!0),b(null),await Promise.all([i({setting_key:"daily_free_listings",setting_value:o.dailyFreeListings}),i({setting_key:"cost_per_listing",setting_value:o.costPerListing}),i({setting_key:"power_user_credit_price",setting_value:o.powerUserCreditPrice}),i({setting_key:"min_donation_amount",setting_value:o.minDonationAmount}),i({setting_key:"power_user_min_purchase",setting_value:o.powerUserMinPurchase}),i({setting_key:"low_pot_warning_threshold",setting_value:o.lowPotWarningThreshold})]),b({type:"success",text:"Einstellungen erfolgreich gespeichert!"})}catch(C){b({type:"error",text:"Fehler beim Speichern der Einstellungen."}),console.error("Error saving settings:",C)}finally{d(!1)}};if(s)return e.jsx(j,{sx:{display:"flex",justifyContent:"center",py:8},children:e.jsx(ie,{})});if(a)return e.jsx(U,{severity:"error",sx:{mb:3},children:a});const m=r?j:Y,g=r?{}:{sx:{p:3}};return e.jsxs(j,{children:[e.jsx(u,{variant:"h5",fontWeight:700,gutterBottom:!0,sx:{mb:1,display:{xs:"none",md:"block"}},children:"Credit-System Einstellungen"}),e.jsx(u,{variant:"body2",color:"text.secondary",sx:{mb:{xs:2,md:4},display:{xs:"none",md:"block"}},children:"Konfiguriere das Community-Spendentopf & Power-User System"}),e.jsxs(U,{severity:"info",icon:e.jsx(hn,{size:20}),sx:{mb:3},children:[e.jsx(u,{variant:"body2",sx:{fontWeight:600,mb:.5},children:"Wie funktioniert das System?"}),e.jsxs(u,{variant:"body2",sx:{fontSize:"0.875rem"},children:[e.jsx("strong",{children:"Community-Topf"}),": Alle User spenden in einen gemeinsamen Topf",e.jsx("br",{}),e.jsx("strong",{children:"Gratis-User"}),": Bekommen tÃ¤glich X kostenlose Inserate (solange Topf nicht leer)",e.jsx("br",{}),e.jsx("strong",{children:"Power-User"}),": Kaufen eigene Credits fÃ¼r unbegrenzte Inserate"]})]}),e.jsx(Y,{elevation:1,sx:{p:{xs:2,md:3},mb:3,bgcolor:"primary.50",borderLeft:"4px solid",borderColor:"primary.main"},children:e.jsxs(j,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",flexDirection:{xs:"column",sm:"row"},gap:2,textAlign:{xs:"center",sm:"left"}},children:[e.jsxs(j,{children:[e.jsx(u,{variant:"body2",color:"text.secondary",sx:{mb:.5},children:"Aktueller Community-Topf"}),e.jsxs(u,{variant:"h4",sx:{fontWeight:700,color:"primary.main"},children:[L(n==null?void 0:n.communityPotBalance)," Inserate"]})]}),e.jsx(I,{icon:e.jsx(nt,{size:16}),label:(n==null?void 0:n.communityPotBalance)>(n==null?void 0:n.lowPotWarningThreshold)?"Gesund":"Niedrig",color:(n==null?void 0:n.communityPotBalance)>(n==null?void 0:n.lowPotWarningThreshold)?"success":"warning"})]})}),f&&e.jsx(U,{severity:f.type,sx:{mb:3},onClose:()=>b(null),children:f.text}),e.jsxs(m,{...g,children:[e.jsx(u,{variant:"h6",fontWeight:600,gutterBottom:!0,sx:{mb:2},children:"Gratis-Inserate Einstellungen"}),e.jsxs(E,{container:!0,spacing:{xs:2,md:3},sx:{mb:3},children:[e.jsx(E,{size:{xs:12,md:6},children:e.jsx(N,{fullWidth:!0,label:"Kostenlose Inserate pro Tag",type:"number",value:o.dailyFreeListings,onChange:C=>w({...o,dailyFreeListings:parseInt(C.target.value)}),helperText:"Anzahl der kostenlosen Inserate die jeder User pro Tag erstellen kann",InputProps:{endAdornment:e.jsx(ce,{position:"end",children:"Inserate/Tag"})}})}),e.jsx(E,{size:{xs:12,md:6},children:e.jsx(N,{fullWidth:!0,label:"Warnschwelle Community-Topf",type:"number",value:o.lowPotWarningThreshold,onChange:C=>w({...o,lowPotWarningThreshold:parseInt(C.target.value)}),helperText:"Bei wie vielen verbleibenden Inseraten soll gewarnt werden?",InputProps:{endAdornment:e.jsx(ce,{position:"end",children:"Inserate"})}})})]}),e.jsx(Ee,{sx:{my:3}}),e.jsx(u,{variant:"h6",fontWeight:600,gutterBottom:!0,sx:{mb:2},children:"Kosten & Preise"}),e.jsxs(E,{container:!0,spacing:{xs:2,md:3},sx:{mb:3},children:[e.jsx(E,{size:{xs:12,md:6},children:e.jsx(N,{fullWidth:!0,label:"Kosten pro Inserat",type:"number",inputProps:{step:.01},value:o.costPerListing,onChange:C=>w({...o,costPerListing:parseFloat(C.target.value)}),helperText:"TatsÃ¤chliche Kosten (Gemini API + Server) pro Inserat",InputProps:{endAdornment:e.jsx(ce,{position:"end",children:"EUR"})}})}),e.jsx(E,{size:{xs:12,md:6},children:e.jsx(N,{fullWidth:!0,label:"Power-User Credit Preis",type:"number",inputProps:{step:.01},value:o.powerUserCreditPrice,onChange:C=>w({...o,powerUserCreditPrice:parseFloat(C.target.value)}),helperText:"Preis pro Power-User Credit",InputProps:{endAdornment:e.jsx(ce,{position:"end",children:"EUR/Credit"})}})}),e.jsx(E,{size:{xs:12,md:6},children:e.jsx(N,{fullWidth:!0,label:"Minimale Spende",type:"number",inputProps:{step:.01},value:o.minDonationAmount,onChange:C=>w({...o,minDonationAmount:parseFloat(C.target.value)}),helperText:"Mindestbetrag fÃ¼r Community-Topf Spenden",InputProps:{endAdornment:e.jsx(ce,{position:"end",children:"EUR"})}})}),e.jsx(E,{size:{xs:12,md:6},children:e.jsx(N,{fullWidth:!0,label:"Minimaler Power-User Kauf",type:"number",inputProps:{step:.01},value:o.powerUserMinPurchase,onChange:C=>w({...o,powerUserMinPurchase:parseFloat(C.target.value)}),helperText:"Mindestbetrag fÃ¼r Power-User Credit Kauf",InputProps:{endAdornment:e.jsx(ce,{position:"end",children:"EUR"})}})})]}),e.jsx(Ee,{sx:{my:3}}),e.jsx(u,{variant:"h6",fontWeight:600,gutterBottom:!0,sx:{mb:2},children:"Aktuelle Berechnungen"}),e.jsxs(j,{sx:{bgcolor:"grey.100",p:{xs:2,md:3},borderRadius:1,mb:3},children:[e.jsxs(u,{variant:"body2",sx:{mb:1},children:["1 EUR Spende = ",e.jsxs("strong",{children:[L(Math.floor(1/o.costPerListing))," Inserate"]})," fÃ¼r Community-Topf"]}),e.jsxs(u,{variant:"body2",sx:{mb:1},children:["1 EUR Power-User = ",e.jsxs("strong",{children:[L(Math.floor(1/o.powerUserCreditPrice))," Credits"]})," persÃ¶nlich"]}),e.jsxs(u,{variant:"body2",sx:{mb:1},children:["Min. Spende ",o.minDonationAmount," EUR = ",e.jsxs("strong",{children:[L(Math.floor(o.minDonationAmount/o.costPerListing))," Inserate"]})]}),e.jsxs(u,{variant:"body2",children:["Min. Power-User ",o.powerUserMinPurchase," EUR = ",e.jsxs("strong",{children:[L(Math.floor(o.powerUserMinPurchase/o.powerUserCreditPrice))," Credits"]})]})]}),e.jsx(j,{sx:{display:"flex",justifyContent:"flex-end",gap:2},children:e.jsx(K,{variant:"contained",startIcon:l?e.jsx(ie,{size:20,color:"inherit"}):e.jsx(Mn,{size:20}),onClick:_,disabled:l,size:"large",children:l?"Speichern...":"Einstellungen speichern"})})]})]})},Ys=()=>{const t=Ot(),r=We(),n=De(r.breakpoints.down("md")),{isAdmin:s,loading:a}=ft(),[i,l]=h.useState("users"),[d,f]=h.useState(!1),[b,o]=h.useState(!1);if(h.useEffect(()=>{!a&&!s&&t("/")},[s,a,t]),a)return e.jsx(j,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"60vh"},children:e.jsx(ie,{})});if(!s)return null;const w=g=>{l(g),n&&o(!1)},_=()=>{switch(i){case"users":return e.jsx(St,{});case"roles":return e.jsx(nr,{});case"tasks":return e.jsx(rr,{});case"credits":return e.jsx(Us,{});default:return e.jsx(St,{})}},m=()=>{switch(i){case"users":return"Benutzerverwaltung";case"roles":return"Rollen & Rechte";case"tasks":return"Aufgaben";case"credits":return"Credit-System";default:return"Admin-Bereich"}};return e.jsxs(j,{sx:{display:"flex",flexDirection:"column",minHeight:"100vh"},children:[e.jsx(mn,{onNavigate:g=>{g==="items"?t("/"):g==="messages"?t("/messages"):g==="settings"&&t("/settings")},onLoginClick:()=>{},showSearch:!1}),e.jsxs(j,{sx:{display:"flex",flex:1},children:[!n&&e.jsx(Ct,{currentSection:i,onSectionChange:w,collapsed:d,onToggleCollapse:()=>f(!d)}),n&&e.jsxs(gn,{anchor:"left",open:b,onClose:()=>o(!1),sx:{"& .MuiDrawer-paper":{width:260,boxSizing:"border-box"}},children:[e.jsxs(j,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",p:2,borderBottom:1,borderColor:"divider"},children:[e.jsx(u,{variant:"h6",fontWeight:600,children:"Admin-Bereich"}),e.jsx(pe,{onClick:()=>o(!1),size:"small",children:e.jsx(fn,{size:20})})]}),e.jsx(Ct,{currentSection:i,onSectionChange:w,collapsed:!1,onToggleCollapse:()=>{},isMobile:!0})]}),e.jsx(j,{sx:{flex:1,overflow:"auto"},children:e.jsxs(xn,{maxWidth:"lg",sx:{py:4},children:[n&&e.jsxs(j,{sx:{display:"flex",alignItems:"center",gap:2,mb:3},children:[e.jsx(pe,{onClick:()=>o(!0),sx:{bgcolor:"action.hover","&:hover":{bgcolor:"action.selected"}},children:e.jsx(er,{size:20})}),e.jsx(u,{variant:"h5",sx:{fontWeight:600},children:m()})]}),!n&&e.jsx(u,{variant:"h4",sx:{mb:3,fontWeight:600},children:m()}),_()]})})]}),e.jsx(pn,{})]})},sa=Object.freeze(Object.defineProperty({__proto__:null,default:Ys},Symbol.toStringTag,{value:"Module"}));export{Ys as A,er as M,tr as T,$e as a,Ie as b,Le as c,q as d,x as e,Fe as f,sa as g,ft as u};
