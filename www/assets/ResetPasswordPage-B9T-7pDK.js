import{R as B,r as s,G as g,j as e,a2 as I,J as F,B as l,T as w,F as m,n as f,I as p,aK as P,aF as b,y as k}from"./index-Cr_aSuNE.js";const O=()=>{const S=B(),[a,y]=s.useState(""),[u,R]=s.useState(""),[i,j]=s.useState(!1),[d,v]=s.useState(!1),[c,n]=s.useState(""),[A,E]=s.useState(!1),[h,x]=s.useState(!1),[z,C]=s.useState(!1);s.useEffect(()=>{const{data:{subscription:r}}=g.auth.onAuthStateChange(async(o,t)=>{console.log("[Password Reset] Auth event:",o),console.log("[Password Reset] Session present:",!!t),o==="PASSWORD_RECOVERY"&&(console.log("[Password Reset] Password recovery event detected!"),t?(console.log("[Password Reset] Valid session found - ready to reset password"),C(!0)):(console.error("[Password Reset] No session found - password reset will fail"),n("Sitzung abgelaufen. Bitte fordern Sie einen neuen Reset-Link an.")))});return()=>{r.unsubscribe()}},[]);const W=async r=>{if(r.preventDefault(),n(""),!z){n("Keine gültige Sitzung gefunden. Bitte fordern Sie einen neuen Reset-Link an.");return}if(a.length<6){n("Passwort muss mindestens 6 Zeichen lang sein");return}if(a!==u){n("Passwörter stimmen nicht überein");return}x(!0);try{console.log("[Password Reset] Attempting to update password...");const{data:o,error:t}=await g.auth.updateUser({password:a});if(t)throw console.error("[Password Reset] Update error:",t),t;console.log("[Password Reset] Password updated successfully!"),E(!0),setTimeout(()=>{S("/")},3e3)}catch(o){console.error("[Password Reset] Error:",o);const t=o instanceof Error?o.message:"Ein Fehler ist aufgetreten";n(t)}finally{x(!1)}};return e.jsx(I,{maxWidth:"sm",sx:{py:8},children:e.jsxs(F,{elevation:2,sx:{p:4,borderRadius:3},children:[e.jsxs(l,{sx:{textAlign:"center",mb:4},children:[e.jsx(l,{component:"img",src:"/logo.png",alt:"HABDAWAS Logo",sx:{width:"auto",height:50,maxWidth:"250px",mx:"auto",display:"block",objectFit:"contain",mb:3}}),e.jsx(w,{variant:"h4",sx:{fontWeight:500,mb:1},children:"Neues Passwort setzen"}),e.jsx(w,{variant:"body2",color:"text.secondary",children:"Bitte geben Sie Ihr neues Passwort ein"})]}),A?e.jsx(m,{severity:"success",sx:{borderRadius:2},children:"Ihr Passwort wurde erfolgreich geändert! Sie werden weitergeleitet..."}):e.jsxs(e.Fragment,{children:[c&&e.jsx(m,{severity:"error",sx:{mb:3,borderRadius:2},children:c}),e.jsxs(l,{component:"form",onSubmit:W,children:[e.jsx(f,{fullWidth:!0,label:"Neues Passwort",type:i?"text":"password",value:a,onChange:r=>y(r.target.value),margin:"normal",required:!0,InputProps:{endAdornment:e.jsx(p,{onClick:()=>j(!i),edge:"end",size:"small",sx:{mr:.5},children:i?e.jsx(P,{size:20}):e.jsx(b,{size:20})})},sx:{"& .MuiOutlinedInput-root":{borderRadius:2}}}),e.jsx(f,{fullWidth:!0,label:"Passwort bestätigen",type:d?"text":"password",value:u,onChange:r=>R(r.target.value),margin:"normal",required:!0,InputProps:{endAdornment:e.jsx(p,{onClick:()=>v(!d),edge:"end",size:"small",sx:{mr:.5},children:d?e.jsx(P,{size:20}):e.jsx(b,{size:20})})},sx:{"& .MuiOutlinedInput-root":{borderRadius:2}}}),e.jsx(k,{type:"submit",fullWidth:!0,variant:"contained",disabled:h,sx:{mt:3,py:1.5,textTransform:"none",fontSize:"0.95rem",fontWeight:600,borderRadius:2,boxShadow:"none","&:hover":{boxShadow:1}},children:h?"Lädt...":"Passwort ändern"})]})]})]})})};export{O as ResetPasswordPage};
