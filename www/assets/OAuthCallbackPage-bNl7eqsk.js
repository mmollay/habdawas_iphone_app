import{x as w,r as g,j as e,B as a,T as r,H as C,f as O}from"./index-C2eq4YK2.js";const j=()=>{const l=w(),[f,c]=g.useState(null),[m,A]=g.useState(null);if(g.useEffect(()=>{(async()=>{try{const t=window.location.href,o=new URLSearchParams(window.location.search),b=o.get("platform")==="ios";if(console.log("[OAuth Callback] Processing URL:",t),console.log("[OAuth Callback] Platform:",b?"Native iOS (from URL param)":"Web"),console.log("[OAuth Callback] Document ready state:",document.readyState),console.log("[OAuth Callback] All URL parameters:"),o.forEach((n,i)=>{console.log(`  - ${i}: ${n}`)}),b){console.log("[OAuth Callback] Native iOS request detected!"),console.log("[OAuth Callback] âš ï¸ Page loaded in Safari - Universal Links did not trigger"),console.log("[OAuth Callback] ðŸ”„ Using Custom URL Scheme fallback...");const n=o.get("error"),i=o.get("error_description");if(n){console.error("[OAuth Callback] OAuth Error:",n),console.error("[OAuth Callback] Error Description:",i),c(`OAuth Fehler: ${i||n}`);return}const u=o.get("code");if(console.log("[OAuth Callback] Authorization code present:",!!u),u){console.log("[OAuth Callback] âœ… Authorization code found!"),console.log("[OAuth Callback] Creating Custom URL Scheme deep link...");const d=`habdawas://auth/callback?code=${encodeURIComponent(u)}`;console.log("[OAuth Callback] Deep link created:",d),A(d),console.log("[OAuth Callback] Waiting for user to click button...");return}const h=window.location.hash.substring(1);if(h&&new URLSearchParams(h).get("access_token")){console.log("[OAuth Callback] Found tokens in fragment (implicit flow)");const x=`habdawas://auth/callback#${h}`;console.log("[OAuth Callback] Redirecting to:",x),setTimeout(()=>{window.location.href=x},500);return}console.error("[OAuth Callback] No authorization code or tokens found in URL"),console.error("[OAuth Callback] Full URL:",window.location.href),c("Keine Authentifizierungsdaten gefunden. Bitte versuche es erneut.");return}console.log("[OAuth Callback] Web platform - exchanging code for session...");const{error:k}=await O.auth.exchangeCodeForSession(t);if(k){console.error("[OAuth Callback] Exchange error:",k),c("Anmeldung fehlgeschlagen. Bitte versuche es erneut."),setTimeout(()=>l("/"),3e3);return}console.log("[OAuth Callback] Success! Redirecting to home..."),l("/",{replace:!0})}catch(t){console.error("[OAuth Callback] Error:",t),c("Ein Fehler ist aufgetreten. Du wirst weitergeleitet..."),setTimeout(()=>l("/"),3e3)}})()},[l]),f){const p=new URLSearchParams(window.location.search),t=[];return p.forEach((o,s)=>{t.push(`${s}: ${o}`)}),e.jsxs(a,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:"100vh",gap:2,p:3},children:[e.jsx(r,{variant:"h6",color:"error",children:f}),t.length>0&&e.jsxs(a,{sx:{mt:2,p:2,bgcolor:"#f5f5f5",borderRadius:1,width:"100%",maxWidth:500},children:[e.jsx(r,{variant:"subtitle2",sx:{mb:1,fontWeight:"bold"},children:"Debug Info:"}),t.map((o,s)=>e.jsx(r,{variant:"body2",sx:{fontFamily:"monospace",fontSize:"0.8rem"},children:o},s))]})]})}return m?e.jsxs(a,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:"100vh",gap:2,p:3},children:[e.jsx(C,{size:60}),e.jsx(r,{variant:"h6",children:"App wird geÃ¶ffnet..."}),e.jsx(r,{variant:"body2",color:"text.secondary",align:"center",sx:{mt:2,fontWeight:"bold"},children:"Tippe auf den Button um zur App zu wechseln:"}),e.jsx(a,{component:"button",onClick:()=>{console.log("[OAuth Callback] Button clicked! Opening app..."),window.location.href=m},sx:{mt:2,px:4,py:2,bgcolor:"primary.main",color:"white",borderRadius:2,border:"none",fontSize:"1.1rem",fontWeight:"bold",cursor:"pointer",boxShadow:"0 4px 6px rgba(0, 0, 0, 0.1)","&:hover":{bgcolor:"primary.dark"},"&:active":{transform:"scale(0.98)"}},children:"Zur App wechseln"})]}):e.jsxs(a,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:"100vh",gap:2},children:[e.jsx(C,{size:60}),e.jsx(r,{variant:"h6",children:"Anmeldung wird verarbeitet..."})]})};export{j as OAuthCallbackPage};
