import{n as rs,r as t,f as b,j as e,T as c,B as o,K as W,$ as Oe,a4 as ge,a3 as Ve,ad as he,a5 as V,ab as se,ae as He,ah as Ze,ai as Je,L,t as pe,x as Os,aj as Vs,h as Hs,i as Zs,R as Js,A as Qe,w as Qs,X as Xs,S as te,P as Xe,I as Ye,ak as Ue,l as ie,H as ue,a6 as es,al as ss}from"./index-kFPCxDRP.js";import{M as ts,B as Ys,D as Us}from"./MultiImageUpload-BRj9FKrX.js";import{A as me,a as fe,b as xe}from"./AccordionSummary-B1G0oEVo.js";import{P as is}from"./phone-CejtCjZ6.js";import{G as et}from"./gift-DYT4blHw.js";import{C as ns}from"./calendar-nw68jU7U.js";import{C as st}from"./Collapse-DFeOGY6k.js";import{S as tt}from"./save-Vqc6iNuh.js";import"./star-DCz9K0pi.js";const it=()=>{const{user:l}=rs(),[p,j]=t.useState(!1),B=t.useCallback(async()=>{var I,v;if(!l)return{canCreate:!1,source:null,reason:"not_authenticated",message:"Bitte melde dich an, um Inserate zu erstellen."};try{j(!0);const{data:n,error:_}=await b.from("credit_system_settings").select("setting_key, setting_value").in("setting_key",["daily_free_listings","community_pot_balance"]);if(_)throw _;const d=parseInt(((I=n==null?void 0:n.find(u=>u.setting_key==="daily_free_listings"))==null?void 0:I.setting_value)||"5"),r=parseInt(((v=n==null?void 0:n.find(u=>u.setting_key==="community_pot_balance"))==null?void 0:v.setting_value)||"0"),{data:C,error:g}=await b.from("profiles").select("daily_listings_used, last_listing_date, personal_credits").eq("id",l.id).single();if(g)throw g;const E=parseInt(C.daily_listings_used)||0,S=C.last_listing_date,w=parseInt(C.personal_credits)||0,K=new Date().toISOString().split("T")[0],A=S!==K?0:E;return A<d&&r>0?{canCreate:!0,source:"community_pot",message:`Du kannst noch ${d-A} kostenlose Inserate heute erstellen.`,remainingDailyListings:d-A,communityPotBalance:r}:A<d&&r===0?w>0?{canCreate:!0,source:"personal_credits",message:`Community-Topf ist leer. Du verwendest deine pers√∂nlichen Credits (${w} verf√ºgbar).`,personalCredits:w}:{canCreate:!1,source:null,reason:"community_pot_empty",message:"Der Community-Topf ist leer. Bitte spende oder kaufe pers√∂nliche Credits.",communityPotBalance:0}:A>=d?w>0?{canCreate:!0,source:"personal_credits",message:`Tageslimit erreicht. Du verwendest deine pers√∂nlichen Credits (${w} verf√ºgbar).`,personalCredits:w}:{canCreate:!1,source:null,reason:"no_credits",message:"Tageslimit erreicht und keine pers√∂nlichen Credits verf√ºgbar. Bitte spende oder kaufe Credits.",remainingDailyListings:0,personalCredits:0}:{canCreate:!1,source:null,reason:"unknown",message:"Fehler beim √úberpr√ºfen der Credits."}}catch(n){return console.error("Error checking credits:",n),{canCreate:!1,source:null,reason:"error",message:"Fehler beim √úberpr√ºfen der Credits."}}finally{j(!1)}},[l]),F=t.useCallback(async(I,v)=>{if(!l)return!1;try{if(I==="community_pot"){const{data:n}=await b.from("profiles").select("daily_listings_used, last_listing_date").eq("id",l.id).single(),_=new Date().toISOString().split("T")[0],r=(n==null?void 0:n.last_listing_date)!==_?0:parseInt(n==null?void 0:n.daily_listings_used)||0,{error:C}=await b.from("profiles").update({daily_listings_used:r+1,last_listing_date:_}).eq("id",l.id);if(C)throw C;const{error:g}=await b.rpc("update_community_pot_balance",{delta:-1});if(g)throw g;const{data:E}=await b.rpc("get_community_pot_balance");await b.from("community_pot_transactions").insert({transaction_type:"usage",user_id:l.id,amount:-1,balance_after:E||0,description:"Inserat erstellt (kostenlos)",item_id:v||null})}else if(I==="personal_credits"){const{data:n}=await b.from("profiles").select("personal_credits").eq("id",l.id).single(),_=parseInt(n==null?void 0:n.personal_credits)||0;if(_<=0)throw new Error("Keine pers√∂nlichen Credits verf√ºgbar");const{error:d}=await b.from("profiles").update({personal_credits:_-1}).eq("id",l.id);if(d)throw d}return!0}catch(n){return console.error("Error consuming credit:",n),!1}},[l]);return{checkCredit:B,consumeCredit:F,loading:p}},nt=()=>{const[l,p]=t.useState(null),[j,B]=t.useState(!0);t.useEffect(()=>{F()},[]);const F=async()=>{try{const{data:n,error:_}=await b.from("token_conversion_settings").select("setting_key, setting_value");if(_)throw _;const d={geminiTokensPerCredit:250,manualListingCost:0,minCreditsForAI:1};n==null||n.forEach(r=>{const C=parseInt(r.setting_value);r.setting_key==="gemini_tokens_per_credit"?d.geminiTokensPerCredit=C:r.setting_key==="manual_listing_cost"?d.manualListingCost=C:r.setting_key==="min_credits_for_ai"&&(d.minCreditsForAI=C)}),p(d)}catch(n){console.error("Error fetching token conversion settings:",n),p({geminiTokensPerCredit:250,manualListingCost:0,minCreditsForAI:1})}finally{B(!1)}},I=t.useCallback(n=>{if(!l)return{geminiTokens:0,estimatedCredits:0,isFree:!0};if(n===0)return{geminiTokens:0,estimatedCredits:l.manualListingCost,isFree:l.manualListingCost===0};const _=Math.ceil(n/l.geminiTokensPerCredit),d=Math.max(_,l.minCreditsForAI);return{geminiTokens:n,estimatedCredits:d,isFree:!1}},[l]),v=t.useCallback(async(n,_,d,r,C)=>{try{const{data:g,error:E}=await b.rpc("deduct_credits_for_ai",{p_user_id:n,p_item_id:_,p_gemini_input_tokens:d,p_gemini_output_tokens:r,p_description:C});if(E)throw E;const S=(g==null?void 0:g[0])||g;if(!S)throw new Error("No result from deduct_credits_for_ai function");return{success:S.success,newBalance:S.new_balance,creditsUsed:S.credits_used,error:S.error_message||void 0}}catch(g){return console.error("Error deducting credits:",g),{success:!1,newBalance:0,creditsUsed:0,error:g instanceof Error?g.message:"Failed to deduct credits"}}},[]);return{settings:l,loading:j,calculateCreditsFromTokens:I,deductCreditsForAI:v,refetch:F}},rt=({pickupAddress:l,shippingEnabled:p,shippingCostType:j,shippingCostFixed:B,shippingDescription:F,priceNegotiable:I,isFree:v,duration:n,onShippingEnabledChange:_,onShippingCostTypeChange:d,onShippingCostFixedChange:r,onShippingDescriptionChange:C,onPriceNegotiableChange:g,onIsFreeChange:E,onDurationChange:S,pickupEnabled:w,onPickupEnabledChange:K,phoneVisible:$=!1})=>{const A=()=>p?j==="free"?"Kostenlos":j==="fixed"?`‚Ç¨${B.toFixed(2)}`:"KI-berechnet":"Nicht verf√ºgbar";return e.jsxs(me,{sx:{mt:3,border:"1px solid",borderColor:"divider",borderRadius:2,"&:before":{display:"none"},boxShadow:"none"},children:[e.jsxs(fe,{expandIcon:e.jsx(he,{size:20}),sx:{"& .MuiAccordionSummary-content":{display:"flex",flexDirection:"column",gap:1.5}},children:[e.jsx(c,{variant:"subtitle2",sx:{fontWeight:600,mb:.5},children:"Artikel-Einstellungen"}),e.jsxs(o,{sx:{display:"flex",gap:1,flexWrap:"wrap"},children:[w&&e.jsx(W,{icon:e.jsx(Oe,{size:14}),label:l?`Abholung: ${l}`:"Abholung m√∂glich",size:"small",sx:{fontSize:"0.75rem"}}),w&&$&&e.jsx(W,{icon:e.jsx(is,{size:14}),label:"Tel. sichtbar",size:"small",color:"info",sx:{fontSize:"0.75rem"}}),e.jsx(W,{icon:e.jsx(ge,{size:14}),label:`Versand: ${A()}`,size:"small",color:p?"primary":"default",sx:{fontSize:"0.75rem"}}),v&&e.jsx(W,{icon:e.jsx(et,{size:14}),label:"Zu verschenken",size:"small",color:"success",sx:{fontSize:"0.75rem"}}),!v&&I&&e.jsx(W,{icon:e.jsx(Ve,{size:14}),label:"VB",size:"small",sx:{fontSize:"0.75rem",fontWeight:700,bgcolor:"warning.main",color:"white"}}),e.jsx(W,{icon:e.jsx(ns,{size:14}),label:`${n} Tage`,size:"small",sx:{fontSize:"0.75rem"}})]})]}),e.jsx(xe,{sx:{pt:2,borderTop:"1px solid",borderColor:"divider"},children:e.jsxs(o,{sx:{display:"flex",flexDirection:"column",gap:3},children:[e.jsxs(o,{children:[e.jsxs(c,{variant:"subtitle2",sx:{fontWeight:600,mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(Oe,{size:16}),"Abholung"]}),e.jsx(V,{control:e.jsx(se,{checked:w,onChange:u=>K(u.target.checked),size:"small"}),label:"Abholung aktivieren"}),w&&e.jsxs(o,{sx:{mt:1,ml:4},children:[e.jsxs(c,{variant:"caption",color:"text.secondary",sx:{display:"block"},children:["üìç ",l||"Keine Adresse ausgew√§hlt"]}),$&&e.jsxs(c,{variant:"caption",color:"info.main",sx:{display:"flex",alignItems:"center",gap:.5,mt:.5},children:[e.jsx(is,{size:12})," Telefonnummer wird im Inserat angezeigt"]}),!$&&l&&e.jsx(c,{variant:"caption",color:"text.secondary",sx:{display:"block",mt:.5},children:"üîí Telefonnummer wird nicht angezeigt"})]})]}),e.jsxs(o,{children:[e.jsxs(c,{variant:"subtitle2",sx:{fontWeight:600,mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(ge,{size:16}),"Versand"]}),e.jsx(V,{control:e.jsx(se,{checked:p,onChange:u=>_(u.target.checked),size:"small"}),label:"Versand aktivieren",sx:{mb:2}}),p&&e.jsxs(o,{sx:{ml:4,display:"flex",flexDirection:"column",gap:2},children:[e.jsxs(He,{fullWidth:!0,size:"small",children:[e.jsx(Ze,{children:"Versandkosten"}),e.jsxs(Je,{value:j,label:"Versandkosten",onChange:u=>d(u.target.value),children:[e.jsx(L,{value:"ai_calculated",children:"KI-berechnet"}),e.jsx(L,{value:"fixed",children:"Festpreis"}),e.jsx(L,{value:"free",children:"Kostenlos"})]})]}),(j==="fixed"||j==="ai_calculated")&&e.jsx(pe,{fullWidth:!0,size:"small",type:"number",label:j==="ai_calculated"?"Versandkosten (‚Ç¨) - Manuell festlegen":"Versandkosten (‚Ç¨)",value:B,onChange:u=>r(Number(u.target.value)),inputProps:{min:0,step:.5},helperText:j==="ai_calculated"?"Im manuellen Modus wird keine KI-Berechnung durchgef√ºhrt":void 0}),C&&e.jsx(pe,{fullWidth:!0,size:"small",multiline:!0,rows:2,label:"Versandinformationen (optional)",value:F||"",onChange:u=>C(u.target.value),placeholder:"z.B. Versand mit DHL, 1-3 Werktage"})]})]}),e.jsxs(o,{children:[e.jsxs(c,{variant:"subtitle2",sx:{fontWeight:600,mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(Ve,{size:16}),"Preis"]}),e.jsxs(o,{sx:{display:"flex",flexDirection:"column",gap:1.5},children:[e.jsx(V,{control:e.jsx(se,{checked:v,onChange:u=>{E(u.target.checked),u.target.checked&&g(!1)},size:"small"}),label:e.jsxs(o,{children:[e.jsx(c,{variant:"body2",children:"Zu verschenken"}),e.jsx(c,{variant:"caption",color:"text.secondary",children:"Artikel kostenlos abgeben"})]})}),!v&&e.jsx(V,{control:e.jsx(se,{checked:I,onChange:u=>g(u.target.checked),size:"small"}),label:e.jsxs(o,{children:[e.jsx(c,{variant:"body2",children:"Verhandlungsbasis (VB)"}),e.jsx(c,{variant:"caption",color:"text.secondary",children:"Preis ist verhandelbar"})]})})]})]}),e.jsxs(o,{children:[e.jsxs(c,{variant:"subtitle2",sx:{fontWeight:600,mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(ns,{size:16}),"Laufzeit"]}),e.jsxs(He,{fullWidth:!0,size:"small",children:[e.jsx(Ze,{children:"Anzeigedauer"}),e.jsxs(Je,{value:n,label:"Anzeigedauer",onChange:u=>S(Number(u.target.value)),children:[e.jsx(L,{value:7,children:"7 Tage"}),e.jsx(L,{value:14,children:"14 Tage"}),e.jsx(L,{value:30,children:"30 Tage"}),e.jsx(L,{value:60,children:"60 Tage"}),e.jsx(L,{value:90,children:"90 Tage"})]})]}),e.jsx(c,{variant:"caption",color:"text.secondary",sx:{display:"block",mt:1},children:"Das Inserat wird nach Ablauf automatisch deaktiviert"})]})]})})]})},xt=()=>{var Te;const l=Os(),{user:p}=rs(),{personalCredits:j}=Vs(),{checkCredit:B,consumeCredit:F}=it(),{calculateCreditsFromTokens:I,deductCreditsForAI:v,settings:n}=nt(),_=Hs(),d=Zs(_.breakpoints.down("sm")),[r,C]=t.useState([]),[g,E]=t.useState("upload"),[S,w]=t.useState(!1),[K,$]=t.useState(""),[A,u]=t.useState(!1),[ne,_e]=t.useState(!1),[be,os]=t.useState(!1),[re,Ce]=t.useState(30),[T,ye]=t.useState(!1),[oe,je]=t.useState(!1),[G,as]=t.useState(null),[ke,R]=t.useState(""),[ae,Se]=t.useState(0),[X,ls]=t.useState([]),[H,cs]=t.useState(""),[q,ds]=t.useState(null),[we,Ie]=t.useState(!1),[us,gs]=t.useState(!1),[le,ve]=t.useState(""),[ce,ze]=t.useState(""),[de,Ee]=t.useState(""),[hs,ps]=t.useState(""),[ms,fs]=t.useState(""),[xs,_s]=t.useState(""),[bs,Cs]=t.useState([]),[ys,js]=t.useState(""),[ks,Ss]=t.useState(""),[ws,Is]=t.useState(""),[vs,zs]=t.useState(""),[Es,As]=t.useState(""),[Ps,Ws]=t.useState(""),[Bs,Fs]=t.useState([]),[Ds,Ms]=t.useState(""),[Ls,Rs]=t.useState(""),[Ae,Pe]=t.useState(!1),[We,Be]=t.useState("free"),[Fe,De]=t.useState(0),[Me,Le]=t.useState(""),[Re,Ne]=t.useState(!1),[Ns,Ks]=t.useState(!1),[ot,$s]=t.useState("");t.useEffect(()=>{if(!p){l("/");return}(async()=>{try{const[x,a,P]=await Promise.all([b.from("addresses").select("*").eq("user_id",p.id).order("is_default_shipping",{ascending:!1}),b.from("profiles").select("shipping_enabled, shipping_cost, shipping_cost_type, shipping_description, pickup_enabled, show_location_publicly, location_description, ai_analyze_all_images").eq("id",p.id).maybeSingle(),b.from("items").select("id",{count:"exact",head:!0}).eq("user_id",p.id)]);if(x.data){ls(x.data);const h=x.data.filter(z=>z.address_type==="pickup_only"||z.address_type==="both"),D=h.find(z=>z.is_default_shipping)||h[0];D&&cs(D.id)}a.data&&(ds(a.data),a.data.shipping_enabled&&Pe(a.data.shipping_enabled),a.data.shipping_cost_type&&Be(a.data.shipping_cost_type),a.data.shipping_cost&&De(a.data.shipping_cost),a.data.shipping_description&&Le(a.data.shipping_description),a.data.pickup_enabled&&Ne(a.data.pickup_enabled),a.data.show_location_publicly!==void 0&&Ks(a.data.show_location_publicly),a.data.location_description&&$s(a.data.location_description));const m=(P.count||0)===0;gs(m),Ie(m)}catch(x){console.error("Error loading data:",x)}})()},[p,l]),t.useEffect(()=>{r.length>0&&g==="upload"&&E("choose")},[r,g]),t.useEffect(()=>{var i;if(n&&G){const x=((i=G.tokenUsage)==null?void 0:i.totalTokens)||0,a=I(x);Se(a.estimatedCredits)}else Se(0)},[G,n,I]);const Ts=async(i,x,a)=>{const{data:{session:P}}=await b.auth.getSession(),k=P==null?void 0:P.access_token;if(!k)throw new Error("Keine Authentifizierung vorhanden");const h={Deutschland:"DE",√ñsterreich:"AT",Schweiz:"CH",Frankreich:"FR",Italien:"IT",Spanien:"ES",Niederlande:"NL",Belgien:"BE",Polen:"PL",Tschechien:"CZ"}[x]||"DE",D=await fetch("https://hsbjflixgavjqxvnkivi.supabase.co/functions/v1/analyze-image",{method:"POST",headers:{Authorization:`Bearer ${k}`,"Content-Type":"application/json"},body:JSON.stringify({imageData:i,shippingCountry:h,additionalNotes:a})}),z=await D.json();if(!D.ok)throw z.insufficientTokens?new Error(`Nicht gen√ºgend Tokens. Du hast ${z.currentBalance} Tokens, ben√∂tigt wird ${z.required}.`):new Error(z.error||"Analyse fehlgeschlagen");return z},Ke=async()=>{if(!(r.length===0||!p)){ye(!0),R("");try{console.log("Starting AI analysis...");const i=X.find(h=>h.id===H),x=(i==null?void 0:i.country)||ss(),P=(q==null?void 0:q.ai_analyze_all_images)??!1?r:[r.find(h=>h.isPrimary)||r[0]];console.log("Analyzing images:",P.length);const k=await Promise.all(P.map(h=>Ts(h.preview,x,K)));console.log("Analysis complete:",k);const m=k[0];k.length>1&&k.slice(1).forEach(h=>{h.features&&(m.features=[...m.features||[],...h.features]),h.colors&&(m.colors=[...new Set([...m.colors||[],...h.colors])]),h.accessories&&(m.accessories=[...m.accessories||[],...h.accessories]),h.tags&&(m.tags=[...new Set([...m.tags||[],...h.tags])])}),as(m),ve(m.title),ze(m.description),Ee(m.price.toString()),console.log("Publishing item with data:",m),await $e(m),console.log("Item published successfully")}catch(i){console.error("Error in handleAIGenerate:",i),R(i instanceof Error?i.message:"Analyse fehlgeschlagen")}finally{ye(!1)}}},$e=async i=>{var m,h,D,z,Ge;if(!p)return;const x=(i==null?void 0:i.title)||le,a=(i==null?void 0:i.description)||ce,P=(i==null?void 0:i.price)||parseFloat(de);if(!x||!a||!P)return;if(!p.email_confirmed_at){R("Bitte best√§tigen Sie zuerst Ihre E-Mail-Adresse.");return}console.log("[Credit Check] Checking credits before listing creation...");const k=await B();if(console.log("[Credit Check] Result:",k),!k.canCreate){R(k.message||"Du kannst derzeit kein Inserat erstellen. Bitte spende oder kaufe Credits.");return}je(!0),R("");try{const M=[];for(const y of r){const Y=y.file.name.split(".").pop(),U=`${p.id}/${Date.now()}-${y.id}.${Y}`,{error:O}=await b.storage.from("item-images").upload(U,y.file);if(O)throw O;const{data:{publicUrl:ee}}=b.storage.from("item-images").getPublicUrl(U);M.push(ee)}const f=X.find(y=>y.id===H),Gs={Deutschland:"DE",√ñsterreich:"AT",Schweiz:"CH",Frankreich:"FR",Italien:"IT",Spanien:"ES",Niederlande:"NL",Belgien:"BE",Polen:"PL",Tschechien:"CZ"}[(f==null?void 0:f.country)||ss()]||"DE",qs=M[r.findIndex(y=>y.isPrimary)]||M[0],s=i||G,Z=((m=s==null?void 0:s.tokenUsage)==null?void 0:m.inputTokens)||0,J=((h=s==null?void 0:s.tokenUsage)==null?void 0:h.outputTokens)||0,Q=Z+J;console.log("[Item Insert] Gemini Tokens:",{input:Z,output:J,total:Q,hasTokenUsage:!!(s!=null&&s.tokenUsage)});const{data:N,error:qe}=await b.from("items").insert({user_id:p.id,title:x,description:a,price:P,image_url:qs,status:S?"published":"draft",ai_generated:s!==null,category:s==null?void 0:s.category,subcategory:s==null?void 0:s.subcategory,condition:s==null?void 0:s.condition,brand:s==null?void 0:s.brand,size:s==null?void 0:s.size,weight:s==null?void 0:s.weight,dimensions_length:(D=s==null?void 0:s.dimensions)==null?void 0:D.length,dimensions_width:(z=s==null?void 0:s.dimensions)==null?void 0:z.width,dimensions_height:(Ge=s==null?void 0:s.dimensions)==null?void 0:Ge.height,material:s==null?void 0:s.material,colors:s==null?void 0:s.colors,style:s==null?void 0:s.style,serial_number:s==null?void 0:s.serialNumber,features:s==null?void 0:s.features,accessories:s==null?void 0:s.accessories,tags:s==null?void 0:s.tags,postal_code:f==null?void 0:f.postal_code,location:f==null?void 0:f.city,estimated_weight_kg:s==null?void 0:s.estimated_weight_kg,package_dimensions:s==null?void 0:s.package_dimensions,ai_shipping_domestic:s==null?void 0:s.ai_shipping_domestic,ai_shipping_international:s==null?void 0:s.ai_shipping_international,selected_address_id:H||null,shipping_from_country:Gs,snapshot_shipping_enabled:Ae,snapshot_shipping_cost:Fe,snapshot_shipping_cost_type:We,snapshot_shipping_description:Me||null,snapshot_pickup_enabled:Re,snapshot_show_location_publicly:Ns,price_negotiable:A,is_free:ne,price_on_request:be,duration_days:re,snapshot_pickup_address:f==null?void 0:f.address,snapshot_pickup_postal_code:f==null?void 0:f.postal_code,snapshot_pickup_city:f==null?void 0:f.city,snapshot_pickup_country:f==null?void 0:f.country,snapshot_location_description:(q==null?void 0:q.location_description)||null,gemini_input_tokens:Z,gemini_output_tokens:J,gemini_tokens_used:Q}).select().single();if(qe)throw qe;if(console.log("Item created:",N),M.length>0&&N){const y=M.map((U,O)=>{var ee;return{item_id:N.id,image_url:U,display_order:O,is_primary:((ee=r[O])==null?void 0:ee.isPrimary)||O===0}});console.log("Inserting item images:",y.length);const{error:Y}=await b.from("item_images").insert(y);if(Y)throw Y;console.log("Images inserted successfully")}if(console.log("[Credit Check] Processing credit deduction...",{creditSource:k.source,geminiTokens:Q,aiGenerated:s!==null}),Q>0){console.log("[Credit Check] AI listing detected - deducting credits based on Gemini tokens...");const y=await v(p.id,N.id,Z,J,`AI listing creation: ${x}`);if(!y.success){console.error("[Credit Check] Failed to deduct credits:",y.error),R(y.error||"Fehler beim Abziehen der Credits");return}console.log("[Credit Check] Credits deducted successfully:",{creditsUsed:y.creditsUsed,newBalance:y.newBalance,geminiInputTokens:Z,geminiOutputTokens:J,totalTokens:Q})}else k.source==="community_pot"?(console.log("[Credit Check] Manual listing using community pot (free listing)"),await F(k.source,N.id)||console.error("[Credit Check] Failed to consume community pot credit")):console.log("[Credit Check] Manual listing with personal credits - FREE (0 credits)");console.log("Navigating to:",`/item/${N.id}`),l(`/item/${N.id}`)}catch(M){R(M instanceof Error?M.message:"Upload fehlgeschlagen")}finally{je(!1)}};return e.jsxs(Js,{maxWidth:"md",sx:{py:4,pb:12},children:[e.jsxs(o,{sx:{mb:5,textAlign:"center"},children:[e.jsx(c,{variant:"h4",sx:{fontWeight:700,color:"primary.main",fontSize:{xs:"1.75rem",md:"2.25rem"},letterSpacing:"-0.02em",mb:1},children:"Artikel erstellen"}),e.jsx(c,{variant:"body2",sx:{color:"text.secondary",fontSize:"0.95rem",maxWidth:"500px",mx:"auto"},children:"Lade deine Bilder hoch und lass die KI die Arbeit machen"})]}),ke&&e.jsx(Qe,{severity:"error",sx:{mb:3},children:ke}),we&&us&&e.jsx(st,{in:we,children:e.jsx(Qe,{severity:"info",icon:e.jsx(te,{size:20}),action:e.jsx(Qs,{size:"small",onClick:()=>Ie(!1),sx:{color:"inherit"},children:e.jsx(Xs,{size:18})}),sx:{mb:3,backgroundColor:"rgba(16, 185, 129, 0.08)",borderColor:"#10b981",border:"1px solid","& .MuiAlert-icon":{color:"#10b981"}},children:e.jsxs(o,{children:[e.jsx(c,{variant:"subtitle2",sx:{fontWeight:600,mb:.5,color:"#047857"},children:"üí° Willkommen! Ihr erster Artikel"}),e.jsx(c,{variant:"body2",sx:{color:"text.secondary",mb:1},children:"Laden Sie einfach Fotos hoch - unser KI-Assistent analysiert die Bilder automatisch und schl√§gt Titel, Beschreibung, Preis und weitere Details vor."}),e.jsxs(c,{variant:"caption",sx:{color:"text.secondary",display:"block"},children:["Sie k√∂nnen die KI-Einstellungen jederzeit unter ",e.jsx("strong",{children:"Profil ‚Üí Einstellungen ‚Üí KI-Assistent"})," anpassen."]})]})})}),r.length===0?e.jsx(ts,{images:r,onImagesChange:C}):e.jsxs(Xe,{sx:{p:{xs:2,md:3},borderRadius:3,mb:3},children:[e.jsx(ts,{images:r,onImagesChange:C}),r.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs(o,{sx:{mt:3,p:2.5,border:"2px solid",borderColor:"primary.main",borderRadius:2,bgcolor:"rgba(25, 118, 210, 0.02)"},children:[e.jsxs(o,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:1.5,flexWrap:"wrap",gap:1},children:[e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(te,{size:18,style:{color:"#1976d2"}}),e.jsx(c,{variant:"subtitle2",sx:{fontWeight:600,color:"primary.main"},children:"KI-Unterst√ºtzung"})]}),e.jsxs(o,{sx:{display:"flex",gap:1,flexWrap:"wrap"},children:[G&&e.jsx(W,{icon:e.jsx(Ye,{size:14}),label:`${((Te=G.tokenUsage)==null?void 0:Te.totalTokens)||0} Gemini Tokens`,size:"small",variant:"outlined",color:"info",sx:{fontWeight:600}}),ae>0?e.jsx(W,{icon:e.jsx(Ue,{size:14}),label:`‚âà${ae} Credits`,size:"small",variant:"outlined",color:"warning",sx:{fontWeight:600}}):e.jsx(W,{label:"Manuell = KOSTENLOS",size:"small",color:"success",sx:{fontWeight:600}}),e.jsx(W,{icon:e.jsx(Ue,{size:16}),label:`${j} Credits verf√ºgbar`,size:"small",color:j>=ae?"primary":"error",sx:{fontWeight:600}})]})]}),e.jsx(pe,{fullWidth:!0,multiline:!0,rows:3,label:"Zus√§tzliche Informationen f√ºr die KI (optional)",placeholder:"z.B. Erbst√ºck, Notverkauf, versteckte M√§ngel, besondere Merkmale, die auf dem Bild nicht sichtbar sind...",value:K,onChange:i=>$(i.target.value),helperText:"Diese Informationen helfen der KI, eine bessere Beschreibung und einen realistischeren Preis zu erstellen",sx:{"& .MuiOutlinedInput-root":{backgroundColor:"white"}}})]}),e.jsx(rt,{pickupAddress:(()=>{const i=X.find(a=>a.id===H);return i?[i.address,i.postal_code,i.city].filter(Boolean).join(", "):""})(),shippingEnabled:Ae,shippingCostType:We,shippingCostFixed:Fe,shippingDescription:Me,priceNegotiable:A,isFree:ne,duration:re,onShippingEnabledChange:Pe,onShippingCostTypeChange:Be,onShippingCostFixedChange:De,onShippingDescriptionChange:Le,onPriceNegotiableChange:u,onIsFreeChange:_e,onDurationChange:Ce,pickupEnabled:Re,onPickupEnabledChange:Ne,phoneVisible:(()=>{const i=X.find(x=>x.id===H);return(i==null?void 0:i.show_phone_publicly)||!1})()})]}),g==="choose"&&r.length>0&&e.jsxs(o,{sx:{mt:4},children:[e.jsxs(o,{sx:{display:"flex",gap:2,flexDirection:{xs:"column",sm:"row"}},children:[e.jsx(ie,{fullWidth:!0,variant:"outlined",size:"large",onClick:()=>E("manual"),sx:{py:1.5,textTransform:"none",fontSize:"0.95rem",fontWeight:500,borderRadius:2},children:"Manuell weitermachen"}),e.jsx(ie,{fullWidth:!0,variant:"contained",size:"large",onClick:Ke,disabled:T||j<1,startIcon:T?e.jsx(ue,{size:18,color:"inherit"}):e.jsx(te,{size:18}),sx:{py:1.5,textTransform:"none",fontSize:"0.95rem",fontWeight:600,borderRadius:2,boxShadow:2},children:T?"Generiere mit KI...":"Mit KI erzeugen"})]}),e.jsx(o,{sx:{mt:2,p:1.5,bgcolor:"rgba(25, 118, 210, 0.04)",borderRadius:1,border:"1px solid",borderColor:"rgba(25, 118, 210, 0.2)"},children:e.jsx(V,{control:e.jsx(es,{checked:S,onChange:i=>w(i.target.checked),size:"small"}),label:e.jsxs(o,{children:[e.jsx(c,{variant:"body2",sx:{fontWeight:500},children:"Gleich ver√∂ffentlichen"}),e.jsx(c,{variant:"caption",color:"text.secondary",children:"Nach KI-Generierung direkt ver√∂ffentlichen"})]}),sx:{m:0}})})]})]}),g==="manual"&&e.jsxs(Xe,{sx:{borderRadius:3,overflow:"hidden"},children:[e.jsxs(o,{sx:{p:3},children:[e.jsx(c,{variant:"h6",fontWeight:600,gutterBottom:!0,sx:{mb:3},children:"Artikelinformationen"}),e.jsxs(o,{sx:{display:"flex",flexDirection:"column",gap:3},children:[e.jsxs(me,{defaultExpanded:!0,elevation:0,sx:{border:"1px solid",borderColor:"divider","&:before":{display:"none"}},children:[e.jsx(fe,{expandIcon:e.jsx(he,{size:20}),sx:{bgcolor:"rgba(25, 118, 210, 0.04)","&:hover":{bgcolor:"rgba(25, 118, 210, 0.08)"}},children:e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:1.5},children:[e.jsx(Ye,{size:20,color:"#1976d2"}),e.jsx(c,{fontWeight:600,children:"Grundinformationen"})]})}),e.jsx(xe,{sx:{p:3},children:e.jsx(Ys,{title:le,description:ce,price:de,category:hs,brand:ms,condition:xs,tags:bs,priceNegotiable:A,isFree:ne,priceOnRequest:be,duration:re,onTitleChange:ve,onDescriptionChange:ze,onPriceChange:Ee,onCategoryChange:ps,onBrandChange:fs,onConditionChange:_s,onTagsChange:Cs,onPriceNegotiableChange:u,onIsFreeChange:_e,onPriceOnRequestChange:os,onDurationChange:Ce,isMobile:d,hideExtendedSettings:!0})})]}),e.jsxs(me,{elevation:0,sx:{border:"1px solid",borderColor:"divider","&:before":{display:"none"}},children:[e.jsx(fe,{expandIcon:e.jsx(he,{size:20}),sx:{bgcolor:"rgba(156, 39, 176, 0.04)","&:hover":{bgcolor:"rgba(156, 39, 176, 0.08)"}},children:e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:1.5},children:[e.jsx(ge,{size:20,color:"#9c27b0"}),e.jsx(c,{fontWeight:600,children:"Details (Optional)"})]})}),e.jsx(xe,{sx:{p:3},children:e.jsx(Us,{size:ys,weight:ks,dimensionsLength:ws,dimensionsWidth:vs,dimensionsHeight:Es,material:Ps,colors:Bs,style:Ds,serialNumber:Ls,onSizeChange:js,onWeightChange:Ss,onDimensionsChange:(i,x,a)=>{Is(i),zs(x),As(a)},onMaterialChange:Ws,onColorsChange:Fs,onStyleChange:Ms,onSerialNumberChange:Rs,isMobile:d})})]})]})]}),e.jsxs(o,{sx:{p:3,pt:0},children:[e.jsx(o,{sx:{mb:2,p:1.5,bgcolor:"rgba(25, 118, 210, 0.04)",borderRadius:1,border:"1px solid",borderColor:"rgba(25, 118, 210, 0.2)"},children:e.jsx(V,{control:e.jsx(es,{checked:S,onChange:i=>w(i.target.checked),size:"small"}),label:e.jsxs(o,{children:[e.jsx(c,{variant:"body2",sx:{fontWeight:500},children:"Gleich ver√∂ffentlichen"}),e.jsx(c,{variant:"caption",color:"text.secondary",children:"Inserat direkt online stellen (sonst als Entwurf speichern)"})]}),sx:{m:0}})}),e.jsxs(o,{sx:{display:"flex",gap:2,flexDirection:{xs:"column",sm:"row"}},children:[e.jsx(ie,{fullWidth:!0,variant:"outlined",size:"large",onClick:Ke,disabled:T,startIcon:T?e.jsx(ue,{size:18,color:"inherit"}):e.jsx(te,{size:18}),sx:{py:1.5,textTransform:"none",fontSize:"0.95rem",fontWeight:500,borderRadius:2},children:T?"Generiere mit KI...":"Mit KI erzeugen"}),e.jsx(ie,{fullWidth:!0,variant:"contained",size:"large",onClick:()=>$e(),disabled:oe||!le||!ce||!de,startIcon:oe?e.jsx(ue,{size:18,color:"inherit"}):e.jsx(tt,{size:18}),sx:{py:1.5,textTransform:"none",fontSize:"0.95rem",fontWeight:600,borderRadius:2},children:oe?"Speichere...":S?"Ver√∂ffentlichen":"Als Entwurf speichern"})]})]})]})]})};export{xt as ItemCreatePage};
