import{R as K,bb as Y,H as G,bh as J,az as V,r as h,a6 as p,bi as q,bj as _,j as e,B as s,bk as Q,E as X,a3 as B,y as I,T as t,F as ee,ag as re,n as se,b5 as T,bl as te,ax as H,a2 as P,O as L,bm as oe,N as ne,a0 as k,ba as ie,G as ae}from"./index-DGPOwJJr.js";import{f as c,a as g}from"./formatNumber-DRkU0_R_.js";import{A as le}from"./arrow-left-Dg_Vpcc7.js";const he=()=>{const j=K(),[z]=Y(),{user:D}=G(),{settings:n,loading:w}=J(),y=V(),[o,v]=h.useState(0),[C,F]=h.useState(null),[m,E]=h.useState(10),[d,R]=h.useState(!1),[A,a]=h.useState(null),[M,$]=h.useState(z.get("canceled")==="true");h.useEffect(()=>{const r=z.get("tab");v(r==="community"?1:0)},[z]);const b=r=>n?Math.floor(r/n.powerUserCreditPrice):0,u=r=>n?Math.floor(r/n.costPerListing):0,O=n?[{id:"STARTER",credits:b(5),price:5,bonus:0,features:["1 Inserat = 1 Basic-Inserat","Premium-Features kosten zusätzlich","Keine monatlichen Limits","Inserate verfallen nicht"]},{id:"POPULAR",credits:b(10),price:10,bonus:Math.floor(b(10)*.1),popular:!0,features:["1 Inserat = 1 Basic-Inserat","Premium-Features kosten zusätzlich","10% Bonus Inserate","Keine monatlichen Limits","Inserate verfallen nicht"]},{id:"PRO",credits:b(20),price:20,bonus:Math.floor(b(20)*.15),bestValue:!0,features:["1 Inserat = 1 Basic-Inserat","Premium-Features kosten zusätzlich","15% Bonus Inserate","Beste Preis-Leistung","Keine monatlichen Limits","Inserate verfallen nicht"]}]:[],U=n?[{id:"SUPPORTER",amount:5,impact:`~${c(u(5))} kostenlose Inserate`,icon:p,color:"#e91e63"},{id:"CONTRIBUTOR",amount:10,impact:`~${c(u(10))} kostenlose Inserate`,icon:q,color:"#9c27b0",popular:!0},{id:"CHAMPION",amount:25,impact:`~${c(u(25))} kostenlose Inserate`,icon:_,color:"#ff9800"}]:[],W=async(r,x)=>{if(!D){a("Bitte melde dich an, um fortzufahren.");return}F(r),R(!0),a(null);try{const{data:{session:i}}=await ae.auth.getSession(),l=i==null?void 0:i.access_token;if(!l){a("Bitte melde dich an, um fortzufahren.");return}const S=await fetch("https://hsbjflixgavjqxvnkivi.supabase.co/functions/v1/create-checkout-session",{method:"POST",headers:{Authorization:`Bearer ${l}`,"Content-Type":"application/json"},body:JSON.stringify({packageId:r.toLowerCase(),type:x,amount:x==="community"?m:void 0})}),f=await S.json();if(!S.ok){f.needsConfig?a("Zahlungssystem ist noch nicht konfiguriert. Bitte kontaktiere den Administrator."):a(f.error||"Fehler beim Erstellen der Checkout-Session");return}f.url?window.location.href=f.url:a("Keine Checkout-URL erhalten")}catch(i){console.error("Error creating checkout session:",i),a(i instanceof Error?i.message:"Ein Fehler ist aufgetreten")}finally{R(!1)}},N=r=>{const x=r.credits+r.bonus,i=(r.price/x).toFixed(2),l=r.popular||r.bestValue;return e.jsxs(H,{sx:{position:"relative",border:l?"2px solid":"1px solid",borderColor:l?"primary.main":"divider",borderRadius:3,bgcolor:"white",overflow:"visible",transition:"all 0.3s ease",display:"flex",flexDirection:"column",boxShadow:l?3:0,"&:hover":{transform:"translateY(-4px)",boxShadow:6}},children:[l&&e.jsx(P,{icon:r.popular?e.jsx(L,{size:14}):e.jsx(oe,{size:14}),label:r.popular?"Beliebt":"Beste Wahl",size:"small",sx:{position:"absolute",top:-12,right:20,bgcolor:r.popular?"primary.main":"#ff9800",color:"white",fontWeight:700,fontSize:"0.75rem",height:26,px:1,"& .MuiChip-icon":{color:"white"},boxShadow:2}}),e.jsxs(s,{sx:{p:3,display:"flex",flexDirection:"column",flexGrow:1},children:[e.jsx(t,{variant:"overline",sx:{fontWeight:700,fontSize:"0.8rem",color:"primary.main",letterSpacing:"0.12em",lineHeight:1,mb:2},children:r.id}),e.jsxs(s,{sx:{mb:2},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"baseline",gap:1},children:[e.jsx(t,{variant:"h2",sx:{fontWeight:800,fontSize:{xs:"2.5rem",sm:"3rem"},lineHeight:1,color:"text.primary"},children:x}),e.jsx(t,{variant:"body1",color:"text.secondary",sx:{fontWeight:600},children:"Inserate"})]}),r.bonus>0&&e.jsx(P,{label:`+${r.bonus} Bonus`,size:"small",sx:{mt:1,bgcolor:"success.light",color:"success.dark",fontWeight:700}})]}),e.jsx(s,{sx:{display:"flex",alignItems:"baseline",gap:.5,mb:1,py:2,borderTop:"1px solid",borderBottom:"1px solid",borderColor:"divider"},children:e.jsx(t,{variant:"h3",sx:{fontWeight:800,fontSize:{xs:"2rem",sm:"2.25rem"},lineHeight:1,color:"text.primary"},children:g(r.price)})}),e.jsxs(t,{variant:"caption",color:"text.secondary",sx:{mb:3},children:[g(parseFloat(i))," pro Inserat"]}),e.jsx(s,{sx:{mb:3,flexGrow:1},children:r.features.map((S,f)=>e.jsxs(s,{sx:{display:"flex",alignItems:"flex-start",gap:1.5,py:.75},children:[e.jsx(ne,{size:18,style:{color:"#4caf50",flexShrink:0,marginTop:"2px"}}),e.jsx(t,{variant:"body2",color:"text.secondary",sx:{fontSize:"0.875rem",lineHeight:1.6},children:S})]},f))}),e.jsx(I,{fullWidth:!0,variant:l?"contained":"outlined",size:"large",startIcon:d&&C===r.id?e.jsx(k,{size:18,color:"inherit"}):e.jsx(ie,{size:18}),onClick:()=>W(r.id,"personal"),disabled:d||w,sx:{textTransform:"none",fontWeight:700,py:1.75,fontSize:"1rem",mt:"auto",borderRadius:2},children:d&&C===r.id?"Laden...":"Inserate kaufen"})]})]},r.id)},Z=r=>{const x=r.icon,i=u(r.amount);return e.jsxs(H,{sx:{position:"relative",border:r.popular?"2px solid":"1px solid",borderColor:r.popular?r.color:"divider",borderRadius:3,bgcolor:"white",overflow:"visible",transition:"all 0.3s ease",boxShadow:r.popular?3:0,"&:hover":{transform:"translateY(-4px)",boxShadow:6}},children:[r.popular&&e.jsx(P,{icon:e.jsx(L,{size:14}),label:"Beliebt",size:"small",sx:{position:"absolute",top:-12,right:20,bgcolor:r.color,color:"white",fontWeight:700,fontSize:"0.75rem",height:26,px:1,"& .MuiChip-icon":{color:"white"},boxShadow:2}}),e.jsxs(s,{sx:{p:3,display:"flex",flexDirection:"column"},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:[e.jsx(s,{sx:{width:48,height:48,borderRadius:2,bgcolor:`${r.color}15`,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(x,{size:24,style:{color:r.color}})}),e.jsx(t,{variant:"h6",sx:{fontWeight:700,color:"text.primary"},children:r.id})]}),e.jsxs(s,{sx:{mb:2},children:[e.jsx(s,{sx:{display:"flex",alignItems:"baseline",gap:1},children:e.jsx(t,{variant:"h3",sx:{fontWeight:800,fontSize:"2.5rem",lineHeight:1,color:"text.primary"},children:g(r.amount)})}),e.jsxs(t,{variant:"body2",sx:{color:r.color,fontWeight:600,mt:1},children:["= ",c(i)," kostenlose Inserate"]})]}),e.jsxs(s,{sx:{bgcolor:`${r.color}10`,borderRadius:2,p:2,mb:3,border:"1px solid",borderColor:`${r.color}30`},children:[e.jsx(t,{variant:"body2",sx:{fontWeight:600,color:"text.primary",mb:.5},children:"Impact:"}),e.jsxs(t,{variant:"body2",color:"text.secondary",children:[r.impact," für die Community"]})]}),e.jsx(I,{fullWidth:!0,variant:"contained",size:"large",startIcon:d&&C===r.id?e.jsx(k,{size:18,color:"inherit"}):e.jsx(p,{size:18}),onClick:()=>W(r.id,"community"),disabled:d||w,sx:{textTransform:"none",fontWeight:700,py:1.75,fontSize:"1rem",borderRadius:2,bgcolor:r.color,"&:hover":{bgcolor:r.color,filter:"brightness(0.9)"}},children:d&&C===r.id?"Laden...":"Jetzt spenden"})]})]},r.id)};return e.jsxs(s,{sx:{display:"flex",flexDirection:"column",minHeight:"100vh"},children:[e.jsx(Q,{onNavigate:r=>{r==="items"?j("/"):r==="messages"?j("/messages"):r==="settings"&&j("/settings")},onLoginClick:()=>{},showSearch:!1}),e.jsxs(s,{sx:{flex:1,bgcolor:"#fafafa"},children:[e.jsx(X,{open:M,autoHideDuration:6e3,onClose:()=>$(!1),message:"Zahlung abgebrochen"}),e.jsx(s,{sx:{bgcolor:"white",borderBottom:"1px solid",borderColor:"divider",py:2},children:e.jsx(B,{maxWidth:"lg",children:e.jsx(I,{startIcon:e.jsx(le,{size:18}),onClick:()=>j(-1),sx:{textTransform:"none",fontWeight:500,color:"text.secondary"},children:"Zurück"})})}),e.jsxs(B,{maxWidth:"lg",sx:{py:6},children:[e.jsxs(s,{sx:{mb:5,textAlign:"center"},children:[e.jsx(t,{variant:"h3",sx:{fontWeight:800,mb:2,color:"text.primary",fontSize:{xs:"2rem",sm:"2.5rem",md:"3rem"}},children:"HabDaWas Inserate"}),e.jsx(t,{variant:"body1",color:"text.secondary",sx:{maxWidth:600,mx:"auto",lineHeight:1.6},children:"Inserate für Power-User • Spenden für die Community"})]}),A&&e.jsx(ee,{severity:"error",onClose:()=>a(null),sx:{mb:4,maxWidth:900,mx:"auto"},children:A}),e.jsx(s,{sx:{mb:4,display:"flex",justifyContent:"center"},children:e.jsxs(s,{sx:{display:"inline-flex",gap:1.5,p:.75,bgcolor:"#f8f9fa",borderRadius:2,border:"1px solid #e8eaed"},children:[e.jsxs(s,{onClick:()=>v(0),sx:{display:"flex",alignItems:"center",gap:1,px:{xs:2,sm:2.5},py:{xs:1,sm:1.25},borderRadius:1.5,cursor:"pointer",transition:"all 0.2s ease",bgcolor:o===0?"#e8f0fe":"transparent",border:"2px solid",borderColor:o===0?"#1a73e8":"transparent","&:hover":{bgcolor:o===0?"#e8f0fe":"rgba(26, 115, 232, 0.08)",transform:"translateY(-1px)"}},children:[e.jsx(s,{sx:{width:{xs:28,sm:32},height:{xs:28,sm:32},borderRadius:1.5,bgcolor:o===0?"#1a73e8":"#e8eaed",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s ease"},children:e.jsx(re,{size:o===0?16:14,style:{color:o===0?"white":"#5f6368"}})}),e.jsxs(s,{children:[e.jsx(t,{variant:"body2",sx:{fontWeight:700,fontSize:{xs:"0.8rem",sm:"0.95rem"},color:o===0?"#1a73e8":"#5f6368",lineHeight:1.2,display:{xs:"none",sm:"block"}},children:"Personal Inserate"}),e.jsx(t,{variant:"body2",sx:{fontWeight:700,fontSize:"0.8rem",color:o===0?"#1a73e8":"#5f6368",lineHeight:1.2,display:{xs:"block",sm:"none"}},children:"Inserate"}),e.jsx(t,{variant:"caption",sx:{color:o===0?"#1a73e8":"#5f6368",fontSize:{xs:"0.6rem",sm:"0.7rem"},fontWeight:700},children:y.loading?"...":`${c(y.personalCredits)} Inserate`})]})]}),e.jsxs(s,{onClick:()=>v(1),sx:{display:"flex",alignItems:"center",gap:1,px:{xs:2,sm:2.5},py:{xs:1,sm:1.25},borderRadius:1.5,cursor:"pointer",transition:"all 0.2s ease",bgcolor:o===1?"#fef7ff":"transparent",border:"2px solid",borderColor:o===1?"#c51162":"transparent","&:hover":{bgcolor:o===1?"#fef7ff":"rgba(197, 17, 98, 0.08)",transform:"translateY(-1px)"}},children:[e.jsx(s,{sx:{width:{xs:28,sm:32},height:{xs:28,sm:32},borderRadius:1.5,bgcolor:o===1?"#c51162":"#e8eaed",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s ease"},children:e.jsx(p,{size:o===1?16:14,style:{color:o===1?"white":"#5f6368"}})}),e.jsxs(s,{children:[e.jsx(t,{variant:"body2",sx:{fontWeight:700,fontSize:{xs:"0.8rem",sm:"0.95rem"},color:o===1?"#c51162":"#5f6368",lineHeight:1.2,display:{xs:"none",sm:"block"}},children:"Community Spenden"}),e.jsx(t,{variant:"body2",sx:{fontWeight:700,fontSize:"0.8rem",color:o===1?"#c51162":"#5f6368",lineHeight:1.2,display:{xs:"block",sm:"none"}},children:"Spenden"}),e.jsx(t,{variant:"caption",sx:{color:o===1?"#c51162":"#5f6368",fontSize:{xs:"0.6rem",sm:"0.7rem"},fontWeight:700},children:y.loading?"...":`${c(y.communityPotBalance)} Inserate`})]})]})]})}),o===0&&e.jsxs(s,{children:[e.jsxs(s,{sx:{textAlign:"center",mb:4},children:[e.jsx(t,{variant:"h5",sx:{fontWeight:700,mb:1},children:"Personal Inserate kaufen"}),e.jsx(t,{variant:"body2",color:"text.secondary",sx:{maxWidth:700,mx:"auto"},children:"Für Power-User, die unbegrenzte Inserate benötigen. Inserate verfallen nicht und können jederzeit verwendet werden."})]}),e.jsx(s,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",md:"repeat(3, 1fr)"},gap:3,maxWidth:1200,mx:"auto"},children:O.map(N)}),e.jsx(s,{sx:{mt:4,p:3,borderRadius:2,bgcolor:"rgba(25, 118, 210, 0.05)",border:"1px solid rgba(25, 118, 210, 0.1)",maxWidth:900,mx:"auto"},children:e.jsxs(t,{variant:"body2",color:"text.secondary",sx:{textAlign:"center"},children:["💡 ",e.jsx("strong",{children:"So funktionieren Inserate:"})," 1 Inserat = 1 Basic-Inserat. Premium-Features (z.B. Hervorhebung, Top-Platzierung) kosten zusätzliche Inserate. Inserate verfallen nie!"]})})]}),o===1&&e.jsxs(s,{children:[e.jsxs(s,{sx:{textAlign:"center",mb:4},children:[e.jsxs(t,{variant:"h5",sx:{fontWeight:700,mb:1,display:"flex",alignItems:"center",justifyContent:"center",gap:1},children:[e.jsx(p,{size:22,style:{color:"#e91e63"}}),"Community unterstützen"]}),e.jsx(t,{variant:"body2",color:"text.secondary",sx:{maxWidth:700,mx:"auto",mb:2},children:"Mit deiner Spende ermöglichst du kostenlosen Zugang für alle! Deine Spende füllt den Community-Topf und ermöglicht kostenlose Inserate für die Allgemeinheit."}),e.jsx(t,{variant:"body2",sx:{fontWeight:600,color:"#e91e63"},children:"🏆 Top-Spender werden in unserer Hall of Fame geehrt!"})]}),e.jsx(s,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",md:"repeat(3, 1fr)"},gap:3,maxWidth:1200,mx:"auto",mb:4},children:U.map(Z)}),e.jsxs(s,{sx:{maxWidth:600,mx:"auto",p:4,borderRadius:3,bgcolor:"white",border:"2px dashed",borderColor:"divider"},children:[e.jsx(t,{variant:"h6",sx:{fontWeight:700,mb:2,textAlign:"center"},children:"Eigener Betrag"}),e.jsx(se,{fullWidth:!0,type:"number",value:m,onChange:r=>E(parseFloat(r.target.value)||0),InputProps:{startAdornment:e.jsx(T,{position:"start",children:"€"}),endAdornment:e.jsx(T,{position:"end",children:e.jsxs(t,{variant:"caption",color:"text.secondary",children:["= ",c(u(m))," Inserate"]})})},inputProps:{min:(n==null?void 0:n.minDonationAmount)||5,step:1},sx:{mb:2}}),e.jsxs(I,{fullWidth:!0,variant:"contained",size:"large",startIcon:e.jsx(p,{size:18}),onClick:()=>W("CUSTOM","community"),disabled:d||m<((n==null?void 0:n.minDonationAmount)||5)||w,sx:{textTransform:"none",fontWeight:700,py:1.75,fontSize:"1rem",borderRadius:2,bgcolor:"#e91e63","&:hover":{bgcolor:"#c2185b"}},children:[g(m)," spenden"]}),m<((n==null?void 0:n.minDonationAmount)||5)&&e.jsxs(t,{variant:"caption",color:"error",sx:{mt:1,display:"block",textAlign:"center"},children:["Mindestbetrag: ",g((n==null?void 0:n.minDonationAmount)||5)]})]}),e.jsx(s,{sx:{mt:4,p:3,borderRadius:2,bgcolor:"rgba(233, 30, 99, 0.05)",border:"1px solid rgba(233, 30, 99, 0.1)",maxWidth:900,mx:"auto"},children:e.jsxs(t,{variant:"body2",color:"text.secondary",sx:{textAlign:"center"},children:["🌟 ",e.jsx("strong",{children:"So funktioniert's:"})," Jeder gespendete Euro wird 1:1 in kostenlose Inserate umgewandelt. Mit 10€ ermöglichst du ",c(u(10))," kostenlose Inserate für die Community!"]})})]})]})]}),e.jsx(te,{})]})};export{he as CreditPurchasePage};
